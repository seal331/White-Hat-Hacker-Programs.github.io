!function(e){function t(t){for(var r,a,n=t[0],l=t[1],c=t[2],h=0,u=[];h<n.length;h++)a=n[h],i[a]&&u.push(i[a][0]),i[a]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(d&&d(t);u.length;)u.shift()();return o.push.apply(o,c||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],r=!0,n=1;n<s.length;n++){var l=s[n];0!==i[l]&&(r=!1)}r&&(o.splice(t--,1),e=a(a.s=s[0]))}return e}var r={},i={"web/stories":0},o=[];function a(t){if(r[t])return r[t].exports;var s=r[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=r,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(s,r,function(t){return e[t]}.bind(null,r));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/js/cmodules/";var n=window.webpackJsonp=window.webpackJsonp||[],l=n.push.bind(n);n.push=t,n=n.slice();for(var c=0;c<n.length;c++)t(n[c]);var d=l;o.push([219,"bundles/audioplayer","bundles/common","bundles/vendors"]),s()}({"+/AQ":function(e,t,s){"use strict";s.r(t),s.d(t,"getNativeOption",function(){return i}),s.d(t,"setNativeOption",function(){return o}),s.d(t,"createScroll",function(){return c});var r=s("ofcU");function i(e,t){return bodyNode[e]||document.documentElement[e]}function o(e,t,s){"scrollTop"===e&&window.scrollTo(0,t)}class a{constructor(e,t){this.el=e,this.opts=t,this.module=Object(r.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return i("scrollTop",this.el);o("scrollTop",e,this.el)}contHeight(){return i("scrollHeight")}smoothScroll(e){scrollToY(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();var t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){var t=()=>{Date.now()-s<500&&this.scrollBottom(e),window.removeEventListener("scroll",t)},s=Date.now();window.addEventListener("scroll",t),this.scrollBottom(e)}onScroll(e){var t=this.scrollTop(),s=t-this.prevScroll,r=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-s,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&r-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){Object(r.destroyModule)(this.module)}}class n{constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{var s=this.scrollTop(),r=this.prevTop-s;this.prevTop=s,t.scrollChange&&t.scrollChange(s),t.onScroll&&t.onScroll(r,this)}})}update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){var t=Date.now();this.scroll.emitter.addOnceListener("resize",()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)}),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}}class l{constructor(e,t){this.el=e}update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}}function c(e,t){return t.noScroll?new l(e):t.nativeScroll?new a(e,t):new n(e,t)}},"0Rlc":function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return n});s("91GP"),s("ioFf"),s("rGqo"),s("Btvt");var r=s("q1tI"),i=(s("17x9"),s("pemR"));function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var s,r,i=function(e,t){if(null==e)return{};var s,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}class n extends r.Component{constructor(){super(...arguments),this.onChange=e=>{this.props.onChange&&this.props.onChange(this.props.name,e.target.checked,e)}}render(){var e=this.props,t=e.children,s=e.checked,n=e.disabled,l=e.indeterminate,c=e.name,d=e.id,h=a(e,["children","checked","disabled","indeterminate","name","id"]),u=Object(i.classNames)("CheckBox",h.className,{"CheckBox--disabled":n,"CheckBox--indeterminate":l});return r.createElement("label",{className:u},r.createElement("input",o({},h,{className:"CheckBox__input",id:d,type:"checkbox",checked:s,name:c,disabled:n,onChange:this.onChange})),r.createElement("span",{className:"CheckBox__indicator","aria-hidden":!0}),t)}}},"0toi":function(e,t,s){"use strict";s.r(t);s("91GP");var r=s("q1tI"),i=(s("17x9"),s("r7nW")),o=s("6aSF"),a=s("pemR");function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}var l=e=>{var t=e.title,s=e.onClose,i=e.appearance,o=Object(a.classNames)("Modal__header",`Modal__header--${i}`);return r.createElement("div",{className:o},r.createElement("div",{className:"Modal__headerInner"},r.createElement("h1",{className:"Modal__headerTitle"},t),r.createElement("button",{className:"Modal__headerCross",type:"button",onClick:s},"Закрыть")))};l.defaultProps={appearance:"white"};var c=e=>r.createElement(o.default,{className:"Modal__body"},e.children);c.defaultProps={children:null};var d=e=>{var t=e.className,s=e.appearance,o=e.title,l=e.actionButtons,c=e.onClose,h=e.children,u=e.footerHint,p=Object(a.classNames)("Modal",`Modal--${s}`,t);return r.createElement(i.default,n({},e,{className:p}),r.createElement(d.Header,{title:o,onClose:c,appearance:s}),Boolean(h)&&r.createElement(d.Body,null,h),r.createElement(d.Footer,{actionButtons:l,hint:u}))};d.Header=l,d.Body=c,d.Footer=e=>{var t=e.actionButtons,s=e.hint;return r.createElement("div",{className:"Modal__footer"},r.createElement("div",{className:"Modal__footerInner"},s&&r.createElement("div",{className:"Modal__footerHint"},s),t))},d.defaultProps=n({},i.default.defaultProps,{appearance:"white"}),t.default=d},"16Al":function(e,t,s){"use strict";var r=s("WbBG");function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,s,i,o,a){if(a!==r){var n=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw n.name="Invariant Violation",n}}function t(){return e}e.isRequired=e;var s={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return s.PropTypes=s,s}},"17x9":function(e,t,s){e.exports=s("16Al")()},219:function(e,t,s){e.exports=s("EJ7F")},"22MJ":function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return l});s("91GP"),s("ioFf"),s("rGqo"),s("Btvt");var r=s("q1tI"),i=s("pemR"),o=s("dLHM");function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var s,r,i=function(e,t){if(null==e)return{};var s,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}class l extends r.Component{constructor(){super(...arguments),this.getRef=e=>{this.element=e&&e.element}}render(){var e=this.props,t=e.className,s=n(e,["className"]);return r.createElement(o.default,a({},s,{className:Object(i.classNames)(t,"BlockSearchInput"),ref:this.getRef}))}}l.defaultProps=o.default.defaultProps},"6aSF":function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return l});s("91GP"),s("ioFf"),s("rGqo"),s("Btvt");var r=s("q1tI"),i=(s("17x9"),s("+/AQ")),o=s("pemR");function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var s,r,i=function(e,t){if(null==e)return{};var s,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}class l extends r.Component{constructor(){super(...arguments),this.getWrapperRef=e=>{this.wrapper=e}}componentDidMount(){var e=this.props,t=e.isNative,s=e.isShadows,r=e.neverHide,o=e.onScroll;this.scroller||(this.scroller=Object(i.createScroll)(this.wrapper,{shadows:s,nativeScroll:t,hidden:!r,onScroll:o}))}componentDidUpdate(){this.scroller.update()}componentWillUnmount(){this.scroller.destroy(),this.scroller=null}render(){var e=this.props,t=e.children,s=(e.isNative,e.isShadows,e.neverHide,e.className),i=void 0===s?"":s,l=n(e,["children","isNative","isShadows","neverHide","className"]);return r.createElement("div",a({},l,{className:Object(o.classNames)("Scroll",i),ref:this.getWrapperRef}),t)}}l.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},"6raB":function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return c});s("91GP"),s("ioFf"),s("rGqo"),s("Btvt");var r=s("q1tI"),i=(s("17x9"),s("pemR")),o=s("KFTi"),a=s("Hx9h");function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function l(e,t){if(null==e)return{};var s,r,i=function(e,t){if(null==e)return{};var s,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}class c extends r.Component{constructor(e){super(e),this.needRecalcSize=!1,this.state={}}render(){var e=this.props,t=e.className,s=e.loading,c=e.children,d=l(e,["className","loading","children"]),h=Object(i.classNames)("ButtonWithProgress",{"ButtonWithProgress--loading":s},t);return r.createElement(a.default,n({},d,{className:h}),r.createElement("span",{className:"ButtonWithProgress__content"},c),s&&r.createElement(o.default,{inverted:"primary"===e.appearance,className:"ButtonWithProgress__progress"}))}}c.defaultProps={appearance:"primary",size:"m",wide:!1,loading:!1}},As6E:function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return d});s("91GP"),s("rGqo"),s("Btvt");var r=s("q1tI"),i=s("i8i4"),o=(s("17x9"),s("pemR")),a=s("clTp"),n=80,l=250,c=()=>"undefined"!=typeof window;class d extends r.Component{constructor(e){super(e),this.onClick=()=>{if(!this.state.dropdown||this.state.dropdown.removed){var e=this.props,t=e.text,s=e.position,r=e.align,i=e.marginTop,o=e.marginLeft,n=Object(a.default)(this.el);this.update({text:t,position:s,align:r,rect:n,marginTop:i,marginLeft:o})}else this.update()},this.onMouseEnter=e=>{this.callerHovered=!0,this.timeouts.appear=setTimeout(()=>{if(this.el&&this.callerHovered){var e=this.props,t=e.position,s=e.align,r=e.marginTop,i=e.marginLeft,o=Object(a.default)(this.el);this.update({position:t,align:s,rect:o,marginTop:r,marginLeft:i})}},n)},this.onMouseLeave=e=>{this.callerHovered=!1,this.timeouts.callerDisappear=setTimeout(()=>{this.callerHovered||this.hovered||this.update()},l)},this.onDropdownMouseEnter=()=>{"hover"===this.props.trigger&&(this.hovered=!0)},this.onDropdownMouseLeave=e=>{"hover"===this.props.trigger&&(this.hovered=!1,this.timeouts.disappear=setTimeout(()=>{this.callerHovered||this.hovered||this.update()},l))},this.onDocumentClick=e=>{!this.state.dropdown||this.state.dropdown.removed||this.el.contains(e.target)||this.update()},this.onResize=e=>{if(this.state.dropdown&&!this.state.dropdown.removed){var t=this.props,s=t.text,r=t.position,i=t.align,o=t.marginTop,n=t.marginLeft,l=Object(a.default)(this.el);this.update({text:s,position:r,align:i,rect:l,marginTop:o,marginLeft:n})}},this.onTransitionEnd=e=>{"visibility"===e.propertyName&&this.state.dropdown&&this.state.dropdown.removed&&this.setState({dropdown:void 0})},this.onItemClick=(e,t)=>{t.separator||(this.update(),t.onClick(e))},this.state={},this.timeouts={}}componentDidMount(){this.el=i.findDOMNode(this),"click"===this.props.trigger?(this.el.addEventListener("click",this.onClick),document.addEventListener("mousedown",this.onDocumentClick),window.addEventListener("resize",this.onResize)):(this.el.addEventListener("mouseenter",this.onMouseEnter),this.el.addEventListener("mouseleave",this.onMouseLeave))}componentWillUnmount(){Object.keys(this.timeouts).forEach(e=>{clearTimeout(this.timeouts[e])}),"click"===this.props.trigger?(this.el.removeEventListener("click",this.onClick),document.removeEventListener("mousedown",this.onDocumentClick),window.removeEventListener("resize",this.onResize)):(this.el.removeEventListener("mouseenter",this.onMouseEnter),this.el.removeEventListener("mouseleave",this.onMouseLeave)),this.defaultNode&&(this.defaultNode.parentNode.removeChild(this.defaultNode),delete this.defaultNode)}update(e){if(!e)return this.setState({dropdown:Object.assign({},this.state.dropdown,{removed:!0})});var t=e.position,s=e.align,r=e.rect,i=e.marginTop,o=e.marginLeft,a=r.left,n=r.top;switch(t){case"t":a+=.5*r.width;break;case"r":a+=r.width,n+=.5*r.height;break;case"b":a+=.5*r.width,n+=r.height;break;case"l":n+=.5*r.height}a=Math.round(a+o),n=Math.round(n+i),this.setState({dropdown:{position:t,align:s,x:a,y:n}})}renderDropdown(){if(!this.state.dropdown)return null;var e=this.state.dropdown,t=e.x,s=e.y,i=e.position,a=e.align,n=e.removed,l=Object(o.classNames)("Dropdown",`Dropdown--${i}`,{"Dropdown--removed":!!n,[`Dropdown--align-${a}`]:"t"===i||"b"===i},this.props.className);return r.createElement("div",{className:l,style:{top:s,left:t},onTransitionEnd:e=>this.onTransitionEnd(e),onMouseEnter:this.onDropdownMouseEnter,onMouseLeave:this.onDropdownMouseLeave},r.createElement("ul",{className:"Dropdown__in"},this.props.data.map((e,t)=>r.createElement("li",{className:Object(o.classNames)("Dropdown__item",{Dropdown__item_separator:e.separator}),onClick:t=>this.onItemClick(t,e),key:void 0!==e.id?e.id:t},e.text))))}render(){var e=this.renderDropdown();return e?(!this.defaultNode&&c()&&(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),r.createElement(r.Fragment,null,this.props.children,i.createPortal(e,this.defaultNode))):this.props.children}}d.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,trigger:"click",className:""}},"BN/X":function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return n});s("91GP"),s("ioFf"),s("rGqo"),s("Btvt");var r=s("q1tI"),i=(s("17x9"),s("pemR"));function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var s,r,i=function(e,t){if(null==e)return{};var s,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}class n extends r.Component{render(){var e=this.props,t=e.hovered,s=e.className,n=e.children,l=a(e,["hovered","className","children"]),c=Object(i.classNames)("Link",{"Link--hovered":!!t},s);return this.props.href?r.createElement("a",o({},l,{className:c}),n):r.createElement("span",o({},l,{className:c}),n)}}n.defaultProps={href:void 0,hovered:!1}},EJ7F:function(e,t,s){"use strict";s.r(t);s("a1Th"),s("rE2o"),s("ioFf"),s("pIFo"),s("Oyvg"),s("OG14"),s("rGqo"),s("Btvt"),s("KKXr"),s("SRfc"),s("91GP"),s("VRzm");var r=s("q1tI"),i=s("i8i4"),o=s("E2g8"),a=o.Promise,n={},l={},c=[],d=!1,h=!1;function u(e,t,s){var r=l[e];if(r)for(var i=0;i<r.length;i++){var o=r[i];t?o.resolve(s):o.reject(),r.splice(i,1),i--}}function p(e,t){d.postMessage({cmd:"load",url:e})}function _(e){return d||((d=new Worker("/js/cmodules/workers/stories_loader_worker.js")).onmessage=e=>{var t=e.data;switch(t.type){case"loaded":n[t.url]=t.data,u(t.url,!0,t.data);break;case"error":u(t.url,!1);break;case"inited":h=!0;for(var s=0;s<c.length;s++)p(c[s])}}),new a((t,s)=>{if(e||t(""),n[e])return t(n[e]);switch(function(e){return e.match(/\.mp4/)?"video":e.match(/\.(png|jpg|jpeg|gif)/)?"image":void 0}(e)){case"video":case"image":l[e]||(l[e]=[]);var r=0===l[e].length;if(l[e].push({resolve:t,reject:s}),!r)return;h?p(e):c.push(e);break;default:vk.dev&&console.error("wrong media url")}})}var v=!1;function m(e){var t;return v||(t=function(e){try{return e.contentDocument?e.contentDocument:e.contentWindow&&e.contentWindow.document?e.contentWindow.document:e.document}catch(e){}return!1}(utilsNode.appendChild(ce("iframe"))),v=t&&t.body?t.body:utilsNode.appendChild(ce("div",{},{display:"none"}))),e.match(/\.mp4/)?function(e){return new a((t,s)=>{var r=ce("video");r.oncanplay=()=>{t(),re(r)},r.onerror=()=>{s(),re(r)},v.appendChild(r),r.src=e})}(e):function(e){return new a((t,s)=>{var r=vkImage();r.onload=()=>{t(),re(r)},r.onerror=()=>{s(),re(r)},v.appendChild(r),r.src=e})}(e)}function y(){var e=ls.get("video_volume");return"number"==typeof e?Math.min(1,Math.max(0,e)):1}function g(e){ls.set("video_volume",e)}function f(){var e=[];return[...arguments].forEach(t=>{if(t)switch(typeof t){case"string":e.push(t);break;case"object":Object.keys(t).forEach(s=>{t[s]&&e.push(s)});break;default:e.push(""+t)}}),e.join(" ")}var D=s("ErRf");function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var S=[];function w(e,t){var s=arguments;cur.storyLayer&&cur.storyLayer.pauseLayer(),ge("stories_layers_background")||(bodyNode.appendChild(ce("div",{id:"stories_layers_background",className:"stories_layers_background"})),layerQueue.hide(),layerQueue.push(),layers.fullhide=E,addEvent(window,"visibilitychange",j.visibilitychange,void 0,void 0,!0),addEvent(window,"resize",j.resize),addEvent(document,"keydown",j.keydown),addEvent(document,"keyup",j.keyup)),cur.storyLayer=e,e.animateStory("expand",t.fromEl),S.push(e),e.length>1&&addClass(e.layerEl,"no_fill_bg"),addClass(bodyNode,"stories_layer_shown"),Object(D.cancelStackPush)("stories_layer_close"+S.length,function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=b(t,1),i=r[0],o=s[0]&&s[0].isCloseBtnClick;i?e._sendNavigationStatEvents("close_auto_by_time"):e._sendNavigationStatEvents("close_tap"),S.length>1&&!o?e.back(!0):(e.hideAllLayers=o,e.hide(!1,!0))})}function C(){S.length>1?S[S.length-2].setLayerVisibility(!0):setStyle("stories_layers_background","opacity",0)}function E(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=0;s<S.length;s++)S[s].hide(!0);if(layers.fullhide=!1,removeClass(bodyNode,"stories_layer_shown"),re("stories_layers_background"),removeEvent(window,"visibilitychange",j.visibilitychange),removeEvent(window,"resize",j.resize),removeEvent(document,"keydown",j.keydown),removeEvent(document,"keyup",j.keyup),t){var r=nav.objLoc;delete r.w,nav.setLoc(r)}cur.needUpdateFeedStories&&Stories.updateFeedStories(),S=[]}function k(){return S[S.length-2]}function O(e){for(var t=0;t<S.length;t++)S[t].onReplyDeleted(e)}window.LayersX=S;var j={visibilitychange:e=>{cur.storyLayer&&cur.storyLayer.onVisibilityChange(e)},resize:e=>{cur.storyLayer&&cur.storyLayer.onResize(e)},keydown:e=>{cur.storyLayer&&cur.storyLayer.onKeyDown(e)},keyup:e=>{cur.storyLayer&&cur.storyLayer.onKeyUp(e)}},L=(s("tUrg"),s("17x9"),s("T/g7"));function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function F(e){var t=e.story,s=t.getCurStoryData().hide_settings,i=window.uiActionsMenu;if(s)return null;var o,a,n=function(e){var t=[],s=e.getCurStoryData(),r=s.raw_id,i=s.can_hide_reply,o=s.report_hash,a=s.can_remove,n=s.can_share,l=s.narrative,c=s.is_ads,d=e.data.can_blacklist,h=B(r.split("_").map(e=>intval(e)),1)[0],u=l&&!l.is_cover;!d||u||c||t.push({label:Object(L.getLang)("stories_add_blacklist_button"),onClick:()=>e._addToBlacklist()});i&&t.push({label:Object(L.getLang)("stories_hide_reply_button"),onClick:()=>e._hideReply()});l&&t.push({label:l.is_bookmarked?Object(L.getLang)("stories_narrative_remove_bookmark_button"):Object(L.getLang)("stories_narrative_add_bookmark_button"),onClick:()=>e._sendNarrativeBookmarkButtonDidPress()});n&&t.push({label:Object(L.getLang)("stories_share"),onClick:()=>e.shareBox()});l&&l.can_edit&&t.push({label:Object(L.getLang)("stories_narrative_edit_button"),onClick:()=>e._sendNarrativeEditButtonDidPress()});a&&e.getOwnerId()<0&&t.push({label:l?Object(L.getLang)("global_narrative_delete"):Object(L.getLang)("global_delete"),onClick:()=>l?e.removeNarrativeBox():e.removeStoryBox()});o&&t.push({label:Object(L.getLang)("stories_report"),onClick:()=>e.report()});h===vk.id||u||t.push({label:Object(L.getLang)("stories_settings"),onClick:()=>window.Stories.showBlackList()});return t}(t);if(0===n.length)return null;return r.createElement("div",{className:"stories_button more ui_actions_menu_wrap _ui_menu_wrap ui_actions_menu_top stories_actions",onMouseEnter:e=>{clearTimeout(o),t.pauseStory(),i.show(a,e)},onMouseLeave:()=>{i.hide(a),clearTimeout(o),o=setTimeout(()=>t.autoResumeStory(),300)},ref:e=>{a=e}},r.createElement("div",{className:"ui_actions_menu _ui_menu"},n.map(e=>{var t=e.label,s=(e.className,e.onClick);return r.createElement("div",{key:t,className:"ui_actions_menu_item",onClick:s},t)})))}function T(e){var t=e.story,s=t.getReplies(),i=t.getViews()||"",o=t.getCurStoryData(),a=o.can_manage,n=o.narrative,l=o.isNewQuestions,c=s.count||"",d=n&&!n.is_cover,h=!(!a||!i),u=t.isActiveLive();if(d||u||!i&&!c)return null;var p="stories_button views _views_button"+(l?" stories_button_new_questions":"");return r.createElement("div",{className:p,onClick:e=>{t._hideTooltip(),t.showFeedbackTooltip(),e.stopPropagation()}},c&&r.createElement("div",{className:"stories_button_replies",dangerouslySetInnerHTML:{__html:langNumeric(c,"%s",!0)}}),h&&r.createElement("div",{className:"stories_button_views"},i))}var x=s("UuS6"),N=s("pemR");var M=class extends r.Component{constructor(e){super(e),this.onMouseEnterSticker=e=>{x.StickersAnimation.loadAndPlaySticker(e.currentTarget)},this.state={}}render(){return r.createElement("div",{className:Object(N.classNames)("ReactionsPanel",this.props.className)},r.createElement("div",{className:"ReactionsPanel__container"},r.createElement("div",{className:"ReactionsPanel__title"},Object(L.getLang)("stories_reactions_title")),r.createElement("div",{className:"ReactionsPanel__items"},this.props.stickers.map((e,t)=>this.getStickerItemEl(e,t)))))}getStickerItemEl(e,t){var s=!!e.animationUrl?"sticker_img":"";return r.createElement("div",{className:"ReactionsPanel__item","data-pack-id":e.packId,"data-sticker-id":e.id,"data-uniq-id":e.uniqId,"data-animation-path":e.animationUrl,onMouseDown:()=>this.props.onStickerClick(e.id,t),onMouseEnter:this.onMouseEnterSticker,key:e.id},r.createElement("div",{className:Object(N.classNames)("ReactionsPanel__itemImage",s),style:{backgroundImage:`url(${e.imageUrl})`}}))}},A="stories_manage",P=200,I={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,app:13},R=[{code:"f09f9882",name:"face_with_tears_of_happiness"},{code:"f09f988d",name:"smiling_face_with_heart_eyes"},{code:"f09f918df09f8fbf",name:"thumbs_up"},{code:"f09f98ad",name:"loud_crying_face"},{code:"f09f98b1",name:"face_screaming_in_fear"},{code:"e298ba",name:"smiling_face"}],H={PUBLIC:0,AUTHOR_ONLY:1,ANONYMOUS:3},$=s("TxR4"),W=s("t7n3"),q=s("W9Tc"),G=s("zxIV"),U=window,V=U.getLang,K=U.showTooltip,z=U.trim,Q=U.addEvent,X=U.removeEvent,Y=U.cancelEvent,J=U.isObject,Z=U.showNarrative;class ee extends r.Component{constructor(e){super(e),this._onReactionClick=(e,t)=>{this._sendMessage([["sticker",e,""]],{sticker_referrer:"story_reaction"},{reactionName:R[t].name})},this.emojiId=!1,this.state={story:e.story,sendFormHasText:!1,sendFormFocused:!1,linkObjectAudioPlaying:!1,isReactionsPanelShow:!1,reactionStickers:this._getReactionsStickers()}}componentDidMount(){this.emojiInit()}componentWillUnmount(){this.emojiId&&(Emoji.destroy(this.emojiId),delete this.emojiId,clearTimeout(cur.reactionFeatureTooltipTimeoutId),cur.reactionFeatureTooltipTimeoutId=null)}componentDidUpdate(){this.emojiInit()}render(){var e=this.props.story;if(!e.story||!this.props.story.getCurStoryData())return"";var t={left_side_empty:this._leftSideIsEmpty()},s=this.state.reactionStickers;return r.createElement(r.Fragment,null,this.state.isReactionsPanelShow&&s.length>0&&r.createElement(M,{className:"stories_story_reactions",stickers:s,onStickerClick:this._onReactionClick}),r.createElement("div",{className:f("stories_story_bottom",t)},r.createElement("div",{className:"stories_story_bottom_controls",ref:"controls"},r.createElement(T,{story:e}),this._renderMessageForm(),this._renderLink(),this._renderMask(),this._renderShare(),this._renderRemove(),r.createElement(F,{story:e}))))}_renderLink(){var e=this.props.story.getCurStoryData().link;if(!J(e))return"";var t="stories_link";return e.object_type&&(t+=` story_link_object_${e.object_type}`),this.state.linkObjectAudioPlaying&&(t+=" story_link_object_audio_playing"),r.createElement("div",{className:"stories_link_wrap"},r.createElement("a",{target:"_blank",rel:"noopener",className:t,href:e.url,title:e.text,onClick:t=>{this._linkDidPress(t,e)}},r.createElement("span",{className:"stories_link__inner",dangerouslySetInnerHTML:{__html:e.text}})))}_renderMask(){return this.props.story.getCurStoryData().mask_id?r.createElement("div",{className:"stories_button mask _mask_button",onMouseOver:e=>K(e.target,{black:1,center:1,shift:[1,13,0],text:V("stories_mask_tooltip")}),onClick:this._maskButtonDidPress.bind(this)}):""}_renderShare(){return!0!==this.props.story.getCurStoryData().can_share?"":r.createElement("div",{className:"stories_button share _share_button",onMouseOver:e=>K(e.target,{black:1,center:1,shift:[1,13,0],text:V("stories_share")}),onClick:this._shareButtonDidPress.bind(this)})}_renderRemove(){var e=this.props.story;return!e.getCurStoryData().can_remove||e.getOwnerId()<0?"":r.createElement("div",{className:"stories_button remove _remove_button",onMouseOver:e=>K(e.target,{black:1,center:1,shift:[1,13,0],text:V("global_delete")}),onClick:this._removeButtonDidPress.bind(this)})}_canMessage(){var e=this.props.story.getCurStoryData(),t=e.link,s=e.can_comment;return!(J(t)||!s||this.props.story.isLiveEnded())}_renderMessageForm(){var e=this.props.story;if(this._canMessage())return r.createElement("div",{ref:"sendForm",className:"stories_send_form _emoji_field_wrap emoji_rpointer"},r.createElement("div",{className:"stories_send_form_text_wrap"},r.createElement("div",{contentEditable:!0,ref:"messageInput",className:"stories_send_form_text",placeholder:V("stories_answer_placeholder"),onFocus:this._sendFormDidFocus.bind(this),onBlur:this._sendFormDidBlur.bind(this),onInput:this._checkReactionsPanel.bind(this),onKeyUp:()=>e._onSendFormKeyUp()})),r.createElement("div",{className:"stories_send_form_helper"},r.createElement("div",{className:f("stories_send_form_buttons _emoji_wrap",{shown:this.state.sendFormFocused||this.state.sendFormHasText})},r.createElement("div",{ref:"smileButton",className:"stories_send_form_button smile _emoji_btn emoji_smile",onMouseEnter:e=>{Emoji.clearSizeCached(this.refs.smileButton),Emoji.show(this.refs.smileButton,e.nativeEvent)},onMouseLeave:e=>Emoji.hide(this.refs.smileButton,e.nativeEvent),onMouseDown:e=>Y(e.nativeEvent)}),r.createElement("div",{className:f("stories_send_form_button send",{active:this.state.sendFormHasText}),onClick:this._onSendMessageButtonCLick.bind(this)}))))}_isReactionAvailable(){return Object(q.partConfigEnabled)("story_reactions_web")&&!this.props.story.isActiveLive()}_onChangeReactionsPanelVisibility(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._isReactionAvailable()&&this.setState({isReactionsPanelShow:e})}emojiInit(){if(!this.emojiId&&this.refs.messageInput){var e=this._isReactionAvailable();if(this.emojiId=Emoji.init(this.refs.messageInput,{ttDiff:29,ref:"stories",ttWrap:this.refs.controls,checkEditable:()=>{this.props.story.isActiveLive()&&VideoChat.checkTextLen(this.refs.messageInput)},noStickers:!e,noStickersStore:!e,onSend:()=>this._sendMessage(),onStickerSend:(e,t,s)=>{this._sendMessage([["sticker",e,s]],{sticker_referrer:t})},forceUp:!0,controlsCont:this.refs.sendForm,onKeyAction:()=>this._emojiDidKeyAction(),onEmojiAdded:()=>this._emojiDidKeyAction(),onStoreHide:()=>{this._updateReactionStickers(),this.props.story.autoResumeStory()}}),Q(this.refs.smileButton,"click",Y),placeholderInit(this.refs.messageInput,{editable:!0}),!this._checkLoadedStickers()){var t=Object(W.isRetina)()?"256b":"128b";Emoji.emojiLoadMore(this.emojiId,{sizes:{[t]:!0}},()=>{this._updateReactionStickers()})}}else this.emojiId&&!this.refs.messageInput&&(X(this.refs.smileButton,"click",Y),Emoji.destroy(this.emojiId),delete this.emojiId)}_checkLoadedStickers(){return!(this._getReactionsStickers().length<R.length)}_leftSideIsEmpty(){var e=this.props.story,t=this.props.story.getCurStoryData(),s=t.can_manage,r=t.link,i=t.can_comment,o=t.narrative,a=e.getReplies(),n=e.getViews();return!(n&&0!==parseInt(n)&&!o)&&(!a.count||!s)&&!J(r)&&!i||e.isLiveEnded()}_sendFormDidFocus(){var e=this.props.story;this.setState({sendFormFocused:!0}),this._isReactionAvailable()&&this._checkReactionsPanel(),e._onSendFormFocus(),e.layer._sendNavigationStatEvents("comment_tap")}_sendFormDidBlur(){this.props.story._onSendFormBlur(),this.setState({sendFormFocused:!1}),this._isReactionAvailable()&&this._hideReactionPanel(),this._emojiDidKeyAction()}_emojiDidKeyAction(){var e=z(Emoji.editableVal(this.refs.messageInput));this.setState({sendFormHasText:e.length>0}),this.refs.messageInput.check()}_hideReactionPanel(){this._onChangeReactionsPanelVisibility(!1)}_showReactionPanel(){this._onChangeReactionsPanelVisibility(!0)}_checkReactionsPanel(){this._isReactionAvailable()&&(this.props.story._getSendText().length?this._hideReactionPanel():this._showReactionPanel())}_viewsButtonDidPress(e){this.props.story.showFeedbackTooltip(),e.stopPropagation()}_shareButtonDidPress(){this.props.story.shareBox()}_removeButtonDidPress(){this.props.story.removeStoryBox()}_maskButtonDidPress(){this.props.story.sendMask()}_linkDidPress(e,t){if(t){var s=t.object_type,r=t.object,i=t.url.match(/\/narrative(-?\d+_\d+)/);if(i){e.preventDefault();var o=i[1];o&&(this.props.story.pauseStory(),Z(o,{fromEl:this.props.story.wrapEl,isOpenNarrativeFromFeed:!0,source:"narrative_story"}))}else this.props.story._sendStatEvent("url_view");switch(s){case"audio":this.state.linkObjectAudioPlaying?(getAudioPlayer().pause(),this.state.story.audioPlaying=!1,cur.storyLayer.resumeLayer()):(getAudioPlayer().playAudio(r),this.state.story.audioPlaying=!0,cur.storyLayer.pauseLayer()),this.setState({linkObjectAudioPlaying:!this.state.linkObjectAudioPlaying}),e.preventDefault()}}}_updateReactionStickers(){this.setState({reactionStickers:this._getReactionsStickers()})}_getReactionsStickers(){var e=[];if(window.stickersKeywords&&Emoji.stickersById){var t=Emoji.stickersById,s=Object(W.isRetina)()?"256b":"128b",r={};R.forEach(i=>{var o=window.stickersKeywords[Object($.emojiRemoveSkinToneModifiers)(Emoji.codeToChr(i.code))],a=o&&Emoji.sortStickersHints(o),n={};a&&a.every(e=>!(e>0&&t[e]&&t[e].sticker&&!r[e])||(n=t[e].sticker,!1)),n[6]&&n[6][s]&&(e.push({id:n[0],packId:0,uniqId:irand(0,1e5),imageUrl:n[6][s],animationUrl:n[3]}),r[n[0]]=!0)})}return e}_hideStickerHints(){var e=Object(G.geByClass1)("_sticker_hints",domPN(this.refs.messageInput));e&&Emoji.stickersHintsHide(e,Emoji.opts[this.emojiId],100)}_onSendMessageButtonCLick(){this._sendMessage()}_sendMessage(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e.length;this._hideStickerHints(),this.props.story._onAnswerSend(()=>{this._emojiDidKeyAction(),r&&this._updateReactionStickers()},e,t,s)}}var te=s("0toi"),ie=s("Hx9h"),oe=s("6raB"),ae=s("As6E"),ne=s("PjZB"),le=s("TBLV"),de=s("nAFc");class he extends r.Component{constructor(e){super(e),this.componentDidMount=()=>{var e=this.questionTextEl.current;e&&this.adjustQuestionTextSize(e)},this.componentDidUpdate=()=>{this.replyTextareaEl.current&&this.replyTextareaEl.current.focus()},this.render=()=>{var e=this.state,t=e.isOpenReplyModal,s=e.replyText,i=e.isOpenReportModal,o=e.reportReasons,a=this.props,n=a.question,l=a.storyUrl,c=n.author,d=n.canAnswer,h=n.text,u=Object(de.decodeHTMLEntities)(h),p=Object(N.classNames)("StoryQuestion__title",{"StoryQuestion__title--free":!d});return r.createElement("div",{className:"StoryQuestion"},r.createElement("div",{className:"StoryQuestion__content"},this.renderAuthor(),r.createElement("span",{className:p,title:u,ref:this.questionTextEl},u)),r.createElement("div",{className:"StoryQuestion__controls"},d&&r.createElement(ie.default,{className:"StoryQuestion__reply",appearance:n.isPublished?"secondary":"primary",size:"s",wide:!0,onClick:this.openReplyModal},Object(L.getLang)("stories_question_reply"))),t&&r.createElement(te.default,{title:Object(L.getLang)("stories_question_reply_box_title").replace("{name}",Object(de.decodeHTMLEntities)(c.nameDat)),actionButtons:this.getReplyModalActions(),className:"StoryQuestion__replyModal",onClose:this.closeReplyModal,appearance:"blue"},r.createElement("div",{className:"StoryQuestion__inner"},r.createElement("textarea",{ref:this.replyTextareaEl,className:"StoryQuestion__textarea",placeholder:Object(L.getLang)("stories_question_reply_placeholder"),onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:s}),r.createElement("img",{srcSet:l,className:"StoryQuestion__image"}))),i&&r.createElement(te.default,{title:Object(L.getLang)("stories_question_report_title"),actionButtons:this.getReportModalActions(),className:"StoryQuestionReportForm",onClose:this.closeReportModal,appearance:"blue"},r.createElement("div",{className:"StoryQuestionReportForm__content"},r.createElement("h4",{className:"StoryQuestionReportForm__title"},Object(L.getLang)("stories_question_report_reason")),r.createElement("div",{className:"StoryQuestionReportForm__items"},!o&&r.createElement(ne.default,{size:15}),o&&o.map((e,t)=>r.createElement(le.default,{key:e[0],name:"questionReport",value:e[0],defaultChecked:!t,onChange:()=>this.handleReason(e[0])},e[1]))))))},this.renderAuthor=()=>{var e=this.props.question,t=e.id,s=e.isAnonymous,i=e.author,o=Object(de.decodeHTMLEntities)(i.name);return r.createElement("div",{className:"StoryQuestion__header"},s&&r.createElement("span",{className:"StoryQuestion__author"},o),!s&&r.createElement("a",{href:i.link,className:"StoryQuestion__author",onClick:()=>cur.storyLayer._sendNavigationStatEvents("question_go_to_author",!0,{questionId:t})},o),r.createElement(ae.default,{position:"b",align:"right",trigger:"hover",data:this.getActions()},r.createElement("a",{className:"StoryQuestion__actions"})))},this.getActions=()=>{var e=this.props.question,t=this.state.isAuthorBan,s=[{text:Object(L.getLang)("stories_question_delete"),onClick:()=>this.props.removeQuestion(e)}];return e.canBlocked&&(t?s.push({text:Object(L.getLang)("stories_question_author_unban"),onClick:this.unbanAuthor}):s.push({text:Object(L.getLang)("stories_question_author_ban"),onClick:this.banAuthor}),s.push({text:Object(L.getLang)("stories_question_author_report"),onClick:this.openReportModal})),s},this.adjustQuestionTextSize=e=>{if(e.scrollHeight>e.offsetHeight){var t=getComputedStyle(e),s=parseInt(t.fontSize)-.5,r=s+2.5,i=Math.floor(parseInt(t.height)/r);s>10&&(e.setAttribute("style",`font-size: ${s}px; line-height: ${r}px; -webkit-line-clamp: ${i};`),setTimeout(()=>{this.adjustQuestionTextSize(e)},0))}},this.getReplyModalActions=()=>{var e=this.state,t=e.isReplyButtonLoading,s=e.replyText;return[r.createElement(ie.default,{key:"closeReplyModal",appearance:"tertiary",onClick:this.closeReplyModal},Object(L.getLang)("global_cancel")),r.createElement(oe.default,{key:"replySend",loading:t,disabled:!Object(W.trim)(s),onClick:this.sendReply},Object(L.getLang)("stories_question_reply_send"))]},this.openReplyModal=()=>{this.setState({isOpenReplyModal:!0})},this.closeReplyModal=()=>{this.setState({isOpenReplyModal:!1})},this.handleChange=e=>{this.setState({replyText:e.target.value})},this.handleKeyDown=e=>{var t=this.state.replyText;Object(W.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==KEY.RETURN&&this.sendReply()},this.resetReplyText=()=>{this.setState({replyText:""})},this.sendReply=()=>{var e=this.state.replyText,t=this.props,s=t.question,r=t.showMessage,i=s.text,o=s.id,a=s.ownerId,n=s.storyOwnerId,l=s.storyId,c=s.sendHash,d=`${e}\n\n🗣 ${Object(W.unclean)(i)}`,h=`story:${n}_${l}`;ajax.post("al_im.php",{act:"a_send",msg:d,hash:c,media:h,to:a},{onDone:()=>{this.closeReplyModal(),this.resetReplyText(),r(Object(L.getLang)("stories_answer_sent")),cur.storyLayer._sendNavigationStatEvents("question_send_message",!0,{questionId:o})},onFail:e=>(this.closeReplyModal(),this.resetReplyText(),r(e),!0),showProgress:()=>this.setState({isReplyButtonLoading:!0}),hideProgress:()=>this.setState({isReplyButtonLoading:!1})})},this.banAuthor=()=>{var e=this.props,t=e.question,s=e.showMessage,r=t.storyOwnerId,i=t.storyId,o=t.id,a=t.banHash,n=t.isAnonymous;ajax.post("al_stories.php",{act:"ban_author_question",story_owner_id:r,story_id:i,question_id:o,ban_hash:a},{onDone:()=>{this.setState({isAuthorBan:!0}),s(Object(L.getLang)("stories_question_author_blocked"));var e="question_ban_author";n&&(e="question_ban_anonymous_author"),cur.storyLayer._sendNavigationStatEvents(e,!0,{questionId:o})},onFail:e=>(s(e),!0)})},this.unbanAuthor=()=>{var e=this.props,t=e.question,s=e.showMessage,r=t.storyOwnerId,i=t.storyId,o=t.id,a=t.banHash;ajax.post("al_stories.php",{act:"unban_author_question",story_owner_id:r,story_id:i,question_id:o,ban_hash:a},{onDone:()=>{this.setState({isAuthorBan:!1}),s(Object(L.getLang)("stories_question_author_unblocked"))},onFail:e=>(s(e),!0)})},this.getReportModalActions=()=>{var e=this.state,t=e.isReportButtonLoading,s=e.reportReasons;return[r.createElement(ie.default,{key:"closeReplyModal",appearance:"tertiary",onClick:this.closeReportModal},Object(L.getLang)("global_cancel")),r.createElement(oe.default,{key:"reportSend",disabled:!s,loading:t,onClick:this.sendReport},Object(L.getLang)("stories_question_report_send"))]},this.openReportModal=()=>{this.setState({isOpenReportModal:!0}),this.props.getReportReasons().then(e=>{this.setState({reportReasons:e})},e=>{this.closeReportModal(),this.props.showMessage(e)})},this.closeReportModal=()=>{this.setState({isOpenReportModal:!1})},this.handleReason=e=>{this.setState({selectReasons:e})},this.sendReport=()=>{var e=this.props.question,t=e.storyOwnerId,s=e.id,r=e.reportHash;ajax.post("al_stories.php",{act:"question_report",story_owner_id:t,question_id:s,reason:this.state.selectReasons,report_hash:r},{onDone:()=>{this.closeReportModal(),this.props.showMessage(Object(L.getLang)("stories_report_sent")),this.closeReportModal()},onFail:e=>(this.props.showMessage(e),this.closeReportModal(),!0),showProgress:()=>this.setState({isReportButtonLoading:!0}),hideProgress:()=>this.setState({isReportButtonLoading:!1})})},this.state={isAuthorBan:e.question.isOwnerBlocked,replyText:"",isOpenReplyModal:!1,isReplyButtonLoading:!1,isOpenReportModal:!1,isReportButtonLoading:!1,reportReasons:null,selectReasons:0},this.replyTextareaEl=r.createRef(),this.questionTextEl=r.createRef()}}function ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class pe extends r.Component{constructor(e){super(e),this.componentDidMount=()=>{this.scrollElement.current.addEventListener(browserFeatures.wheelEvent,this.questionsMouseWheel)},this.componentWillUnmount=()=>{this.positionElement.current.removeEventListener(browserFeatures.wheelEvent,this.questionsMouseWheel)},this.render=()=>{var e=this.state,t=e.questions,s=e.scrollBlockPosition;return r.createElement("div",{className:"stories_feedback_questions_wrap",ref:this.scrollElement},r.createElement("div",{className:"stories_feedback_questions_items",style:{transform:`translateX(-${s}px)`},ref:this.positionElement},t.map((e,t)=>r.createElement(he,{question:e,storyUrl:this.props.storyUrl,showMessage:this.props.showMessage,removeQuestion:this.removeQuestion,getReportReasons:this.getReportReasons,key:t}))))},this.questionsMouseWheel=e=>{e.preventDefault(),this.state.questions.length<=1||this.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},this.setPosition=e=>{var t=this.positionElement.current,s=this.state.scrollBlockPosition,r=ue(Object(G.getSize)(t),1)[0],i=Math.max(0,Math.min(s+e,t.scrollWidth-r));this.setState({scrollBlockPosition:i})},this.removeQuestion=e=>{var t=e.storyOwnerId,s=e.storyId,r=e.id,i=e.removeHash;ajax.post("al_stories.php",{act:"remove_question",story_owner_id:t,story_id:s,question_id:r,remove_hash:i},{onDone:()=>{this.props.sendNavigationStatEvents("question_delete",!0,{question_id:r}),this.setState({questions:this.state.questions.filter(e=>e.id!==r)}),this.state.questions.length?this.setPosition(0):this.props.destroyCallback()}})},this.getReportReasons=()=>new Promise((e,t)=>{this.reportReasons.length?e(this.reportReasons):ajax.post("al_stories.php",{act:"question_report_box"},{onDone:t=>(this.reportReasons=t,e(this.reportReasons),!0),onFail:e=>(t(e),!0)})}),this.state={questions:this.props.questions,scrollBlockPosition:0},this.reportReasons=[],this.scrollElement=r.createRef(),this.positionElement=r.createRef()}}var _e=s("/PiP"),ve=s("pp2G"),me=s("rEJs"),ye=s("EasH");function fe(){return(fe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function De(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class be extends r.Component{constructor(e){super(e),this.componentDidMount=()=>{var e=this.props,t=e.sticker,s=e.story;t.audioRestriction&&s.data.needMute&&s.video&&(s.video.muted=!0),this.playlist.on(this,me.events.ADDED,()=>{this.props.showMessage(Object(L.getLang)("stories_audio_added")),this.props.playStory()}),this.playlist.on(this,me.events.REMOVED,()=>{this.props.showMessage(Object(L.getLang)("stories_audio_deleted")),this.props.playStory()})},this.componentWillUnmount=()=>{this.playlist.off(this)},this.render=()=>{var e=this.props,t=e.story,s=e.sticker,i=t.data.needMute,o=s.audioRestriction;return r.createElement(r.Fragment,null,r.createElement("div",{className:"StorySticker",style:this.getStickerStyle(),onClick:this.handleClick}),o&&i&&this.renderRestriction())},this.renderRestriction=()=>{var e=this.props.sticker.audioRestriction;return r.createElement("div",{className:"StoryRestriction"},r.createElement("div",{className:"StoryRestriction__inner"},r.createElement("span",{className:"StoryRestriction__title"},e.title),e.buttonUrl&&r.createElement("a",{className:"StoryRestriction__link",href:e.buttonUrl},e.buttonText)))},this.getStickerStyle=()=>{var e=this.props,t=e.sticker,s=e.originalWidth,r=e.originalHeight,i=e.widthViewBox,o=e.heightViewBox,a=i,n=o;return o/i>1.77?a=s*o/r:n=r*i/s,{top:t.top*n-(n-o)/2,left:t.left*a-(a-i)/2,width:t.width*a,height:t.height*n,transform:`rotate(${t.rotate}deg)`}},this.handleClick=e=>{switch(this.props.sticker.type){case I.hashtag:this.handleClickHashtag(e);break;case I.mention:this.handleClickMention(e);break;case I.question:this.handleClickQuestion();break;case I.place:this.handleClickPlace(e);break;case I.music:this.handleClickMusic(e);break;case I.marketItem:this.handleClickMarketItem(e);break;case I.storyReply:this.handleClickStoryReply(e);break;case I.owner:this.handleClickOwner(e);break;case I.link:this.handleClickLink(e);break;case I.post:this.handleClickPost(e);break;case I.app:this.handleClickApp()}},this.handleClickHashtag=e=>{var t=this.props.sticker.hashtag.replace("#","%23"),s=Object(L.getLang)("stories_show_hashtag_link"),i=r.createElement("a",{href:`/feed?q=${t}&section=search`,target:"_blank",className:"StoriesTooltip__link"},s);this.props.toggleTooltip(e,i)},this.handleClickMention=e=>{var t=De(this.props.sticker.mention.slice(1,-1).split("|"),1)[0],s=t.startsWith("id")?Object(L.getLang)("stories_go_to_profile"):Object(L.getLang)("stories_go_to_group"),i=r.createElement("a",{href:`/${t}`,target:"_blank",className:"StoriesTooltip__link"},s);this.props.toggleTooltip(e,i)},this.handleClickQuestion=()=>{this.props.showQuestionModal()},this.handleClickPlace=e=>{var t=this.props,s=t.sticker,i=t.list,o=s.placeId,a=Object(L.getLang)("stories_go_to_place");if(layerQueue.count()||i.includes("archive")){var n="/feed?section=search&w=place"+o,l=r.createElement("a",{href:`${n}`,target:"_blank",className:"StoriesTooltip__link"},a);this.props.toggleTooltip(e,l)}else{var c=r.createElement("div",{className:"StoriesTooltip__link",onClick:()=>{layerQueue.count()?layerQueue.pop():layerQueue.push(),Object(_e.showWiki)({w:"place"+o})}},a);this.props.toggleTooltip(e,c)}},this.handleClickMusic=e=>{var t=this.props,s=t.story,i=t.sticker,o=s.data.needMute,a=i.audioId,n=i.audioData;if(i.audioRestriction)o||ve.AudioUtils.showAudioRestriction(JSON.parse(n),{onShow:()=>{this.props.pauseStory()},onHide:()=>{this.props.playStory()}});else{var l="added"===(ve.AudioUtils.getAddRestoreInfo()[a]||{}).state?"stories_audio_delete":"stories_audio_add",c=r.createElement("ul",{className:"StoriesTooltipActions _audio_row","data-audio":n},r.createElement("li",{className:"StoriesTooltipActions__item",onClick:this.addAudio},Object(L.getLang)(l)),r.createElement("li",{className:"StoriesTooltipActions__item",onClick:this.setNext},Object(L.getLang)("stories_audio_next_audio")));this.props.toggleTooltip(e,c,"b")}},this.handleClickMarketItem=e=>{var t=this.props.sticker,s=t.photoUrl,i=t.link,o=t.isRestricted,a=o?{onClick:()=>Object(ye.showFastBox)(Object(L.getLang)("stories_market_access_error_title"),Object(L.getLang)("stories_market_access_error_text"))}:{href:i},n=r.createElement("a",fe({},a,{target:"_blank",className:"StoriesTooltip__link"}),s&&!o?r.createElement("img",{className:"StoriesTooltip__marketItemThumb",src:s}):r.createElement("div",{className:"StoriesTooltip__marketItemThumb StoriesTooltip__marketItemThumb--stub"}),r.createElement("span",{className:"StoriesTooltip__marketItemText"},Object(L.getLang)("stories_go_to_market_item")));this.props.toggleTooltip(e,n)},this.handleClickStoryReply=e=>{var t=this.props,s=t.sticker,i=t.story,o=s.ownerId,a=s.storyId;if((i.data.reply_to||{}).is_expired)this.handleClickOwner(e);else{var n=r.createElement("a",{className:"StoriesTooltip__link",onClick:()=>window.showStory(`story${o}_${a}`)},Object(L.getLang)("stories_go_to_story"));this.props.toggleTooltip(e,n)}},this.handleClickOwner=e=>{var t=this.props.sticker,s=t.ownerId,i=t.link,o=s>0?Object(L.getLang)("stories_go_to_profile"):Object(L.getLang)("stories_go_to_group"),a=r.createElement("a",{href:i,target:"_blank",className:"StoriesTooltip__link"},o);this.props.toggleTooltip(e,a)},this.handleClickLink=e=>{var t=this.props.sticker,s=t.link,i=t.tooltipText,o=r.createElement("a",{href:s,target:"_blank",className:"StoriesTooltip__link"},i);this.props.toggleTooltip(e,o)},this.handleClickPost=e=>{var t=this.props.sticker,s=t.postOwnerId,i=t.postId,o=Object(L.getLang)("stories_go_to_post"),a=r.createElement("a",{href:`/wall${s}_${i}`,target:"_blank",className:"StoriesTooltip__link"},o);this.props.toggleTooltip(e,a)},this.handleClickApp=()=>{this.props.sticker.appId&&window.open(`/app${this.props.sticker.appId}`)},this.addAudio=e=>{ve.AudioUtils.addAudio(e.target),this.props.hideTooltip()},this.setNext=e=>{var t=JSON.parse(this.props.sticker.audioData||"{}"),s=ve.AudioUtils.asObject(t);this.playlist.setNext(e.target.parentNode,s,t),this.playlist.pause(),this.props.hideTooltip(),this.props.playStory()},this.playlist=Object(_e.getAudioPlayer)()}}class Se extends r.Component{constructor(e){super(e),this.render=()=>{var e=this.props,t=e.clientX,s=void 0===t?0:t,o=e.clientY,a=void 0===o?0:o,n=e.layerEl,l=e.position,c=Object(N.classNames)("StoriesTooltip",`StoriesTooltip--${l}`);return r.createElement(r.Fragment,null,i.createPortal(r.createElement("div",{className:c,style:{top:a,left:s}},this.props.children),n))}}}Se.defaultProps={position:"t"};var we=s("mSoV");function Ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class Ee extends r.Component{constructor(e){var t;super(e),t=this,this.componentDidMount=()=>{window.addEventListener("resize",this.handleResize)},this.componentWillUnmount=()=>{window.removeEventListener("resize",this.handleResize)},this.componentDidUpdate=()=>{this.askTextarea.current&&this.askTextarea.current.focus()},this.onDisableAreaMouseDown=e=>{this.props.onMouseDownHandle(e.target)},this.onDisableAreaMouseUp=e=>{this.props.onMouseUpHandle(e.target)},this.render=()=>{var e=this.props,t=e.story,s=e.storyData,i=e.author,o=e.layerEl,a=e.showMessage,n=e.playStory,l=e.pauseStory,c=e.list,d=s.clickable_stickers,h=d.stickers,u=d.original_width,p=d.original_height,_=this.state,v=_.widthViewBox,m=_.heightViewBox,y=_.showTooltip,g=_.position,f=_.tooltipContent,D=_.showQuestionModal,b=_.clientX,S=_.clientY;return r.createElement("div",{className:"StoryStickers"},r.createElement("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--left",onMouseDown:this.onDisableAreaMouseDown,onMouseUp:this.onDisableAreaMouseUp}),r.createElement("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--right",onMouseDown:this.onDisableAreaMouseDown,onMouseUp:this.onDisableAreaMouseUp}),h.map((e,s)=>r.createElement(be,{story:t,sticker:e,originalWidth:u,originalHeight:p,widthViewBox:v,heightViewBox:m,toggleTooltip:this.toggleTooltip,hideTooltip:this.hideTooltip,showQuestionModal:this.showQuestionModal,showMessage:a,playStory:n,pauseStory:l,list:c,key:s})),y&&r.createElement(Se,{clientX:b,clientY:S,layerEl:o,position:g},f),D&&r.createElement(te.default,{title:Object(L.getLang)("stories_question_ask_box_title").replace("{name}",Object(de.decodeHTMLEntities)(i.name_get)),actionButtons:this.getQuestionModalActions(),className:"StoryQuestionAskForm",onClose:this.closeQuestionModal,appearance:"blue"},r.createElement("div",{className:"StoryQuestionAskForm__inner"},r.createElement("textarea",{ref:this.askTextarea,className:"StoryQuestionAskForm__textarea",maxLength:"80",placeholder:Object(L.getLang)("stories_question_ask_placeholder"),onChange:this.handleChange,onKeyDown:this.handleKeyDown}))))},this.handleResize=()=>{var e=Ce(Object(G.getSize)(this.props.el),2),t=e[0],s=e[1];this.setState({widthViewBox:t,heightViewBox:s,showTooltip:!1})},this.toggleTooltip=function(e,s){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"t";e.preventDefault(),e.stopPropagation();var i=e.clientX,o=e.clientY,a=t.props,n=a.pauseStory,l=a.playStory,c=a.hideFeedbackTooltip,d=a.sendNavigationStatEvents;c(),t.setState({showTooltip:!t.state.showTooltip,tooltipContent:s,clientX:i,clientY:o,position:r}),setTimeout(()=>{t.state.showTooltip?(d("click_on_clickable_sticker"),n()):l()},0)},this.hideTooltip=()=>{this.setState({showTooltip:!1})},this.isShownTooltip=()=>this.state.showTooltip||this.state.showQuestionModal,this.showQuestionModal=()=>{var e=this.props,t=e.storyData,s=e.showMessage,r=e.pauseStory,i=e.onModalShownChange;if(!t.can_ask)return s(Object(L.getLang)("stories_question_forbidden"));this.setState({showQuestionModal:!0}),this.hideTooltip(),i(!0),r()},this.closeQuestionModal=()=>{var e=this.props,t=e.playStory,s=e.onModalShownChange;this.setState({showQuestionModal:!1}),s(!1),t()},this.handleChange=e=>{this.setState({questionText:e.target.value})},this.handleKeyDown=e=>{var t=this.state.questionText;Object(W.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==KEY.RETURN&&this.sendQuestion()},this.resetAskText=()=>{this.setState({questionText:""})},this.getQuestionModalActions=()=>{var e=this.props.storyData.can_ask_anonymous,t=this.state,s=t.isQuestionButtonLoading,i=t.questionText,o=[{value:H.PUBLIC,label:Object(L.getLang)("stories_question_select_public")},{value:H.AUTHOR_ONLY,label:Object(L.getLang)("stories_question_select_author_only")}];return e&&o.push({value:H.ANONYMOUS,label:Object(L.getLang)("stories_question_select_anonymous")}),r.createElement("div",{className:"StoryQuestionAskForm__footer"},r.createElement("div",{className:"StoryQuestionAskForm__cell StoryQuestionAskForm__cell--select"},r.createElement(we.default,{value:this.state.selected,options:o,onChange:this.onSelectChange,onShow:this.onSelectShow,onHide:this.onSelectHide})),r.createElement("div",{className:"StoryQuestionAskForm__cell"},r.createElement(ie.default,{key:"b",appearance:"tertiary",onClick:this.closeQuestionModal},Object(L.getLang)("global_cancel")),r.createElement(oe.default,{key:"s",loading:s,disabled:!Object(W.trim)(i),onClick:this.sendQuestion},Object(L.getLang)("stories_question_reply_send"))))},this.onSelectChange=e=>{this.setState({selected:e.selected.value})},this.onSelectShow=()=>{var e=this.props,t=e.storyData,s=e.author,r=t.can_ask_anonymous,i=document.querySelector(".StoryQuestionAskForm__cell--select"),o=r?"stories_question_about_user_tooltip":"stories_question_about_user_tooltip_without_anon",a=r?"stories_question_about_group_tooltip":"stories_question_about_group_tooltip_without_anon",n="";n=s.id>0?Object(L.getLang)(o).replace(/{name}/g,Object(de.decodeHTMLEntities)(s.firstName)):Object(L.getLang)(a),showTooltip(i,{text:n,width:350,slideX:15,className:"",nohide:!0,asrtl:!0,shift:[350,-15],dir:"left",showdt:1e3})},this.onSelectHide=()=>{var e=document.querySelector(".StoryQuestionAskForm__cell--select");e&&e.tt&&e.tt.destroy()},this.sendQuestion=()=>{var e=this.state.questionText,t=this.props,s=t.showMessage,r=t.storyData,i=t.author,o=t.sendNavigationStatEvents,a=r.raw_id,n=r.askQuestionHash,l=r.accessKey,c=Ce(a.split("_"),2),d=c[0],h=c[1],u=!1,p=!1;this.state.selected===H.PUBLIC?u=!0:this.state.selected===H.ANONYMOUS&&(p=!0),ajax.post("al_stories.php",{act:"ask_question",story_owner_id:d,story_id:h,question_text:e,is_anonymous:+p,with_mention:+u,hash:n,access_key:l},{onDone:()=>{switch(this.closeQuestionModal(),this.resetAskText(),s(Object(L.getLang)("stories_question_sent").replace("{name}",i.first_name_ins)),this.state.selected){case H.PUBLIC:o("question_reply_publish");break;case H.AUTHOR_ONLY:o("question_reply");break;case H.ANONYMOUS:o("question_reply_anonymous")}},onFail:e=>(this.closeQuestionModal(),this.resetAskText(),s(e),!0),showProgress:()=>this.setState({isQuestionButtonLoading:!0}),hideProgress:()=>this.setState({isQuestionButtonLoading:!1})})};var s=Ce(Object(G.getSize)(this.props.el),2),i=s[0],o=s[1];this.askTextarea=r.createRef(),this.state={widthViewBox:i,heightViewBox:o,clientX:0,clientY:0,showTooltip:!1,tooltipContent:"",position:"t",showQuestionModal:!1,isQuestionButtonLoading:!1,selected:H.PUBLIC,questionText:""}}}var ke=s("Egk5");class Oe{constructor(e,t){this.data=e,this.opts=t,this.paused=!0,this.loaded=!1,this.elems={},this.startTs=0,this.isPausedByMetaScroll=!1;var s=e.is_expired,r=e.is_deleted,i=e.can_view_deleted,o=e.is_private,a=e.narrative;i||(s?this._error("expired"):r?a?this._error("deleted-narrative"):this._error("deleted"):o&&(a?this._error("private-narrative"):this._error("private")),(s||r||o)&&(this.failed=!0))}render(){this._isFailed()&&this.isNarrativeMetaStory||this.isGroupsMetaStory||this.isAppsMetaStory||(this.longLoadingTimer=setTimeout(()=>{this.isLoaded()||this.opts.onLongLoading()},1e3),this.opts.onLoadingStart())}renderNarrativeCover(){var e=this.data,t=e.narrative,s=e.photo_url,r=t&&t.views?winToUtf(` · ${t.views}`):"";return this.NarrativeCover=se(`\n      <div class="stories_narrative_cover">\n        <div class="stories_narrative_cover_photo" id="stories_narrative_cover_photo" style="background-image: url(${G.data})"></div>\n        <div class="stories_narrative_cover__info">\n          <span class="stories_narrative_cover__label">${getLang("global_type_narrative")}</span>\n          <span class="stories_narrative_cover__views">${r}</span>\n        </div>\n        <div class="stories_narrative_cover__title">${t.title}</div>\n        <div class="stories_narrative_cover__author">${t.owner_name}</div>\n      </div>\n    `),_(s).then(e=>{var t=geByClass1("stories_narrative_cover_photo");t&&Object(G.setStyle)(t,"backgroundImage","url("+e+")")}),this.NarrativeCover}renderAppsMetaStory(){var e=Object(G.ce)("div",{className:"MetaStory"}),t=Stories._getList("apps");if(t){this.coverItems=t,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.elems.recBlock=Object(G.ce)("div",{className:"MetaStory__rec"}),this.elems.recInner=Object(G.ce)("div",{className:"MetaStory__rec-inner"}),this.elems.recItems=Object(G.ce)("div",{className:"MetaStory__rec-items"}),this.elemOffset=286,this.scrollOffset=0,this.metaStoryGridMarginTop=this.elemOffset;var s=Object(G.ce)("div",{className:"MetaStory__infoWrapper"}),r=Object(G.ce)("div",{className:"MetaStory__info"}),i=Object(G.ce)("a",{className:"MetaStory__appWrapper",href:this.data.app.url,target:"_blank"});i.appendChild(Object(G.ce)("div",{className:"MetaStory__appIcon"},{backgroundImage:`url(${this.data.app.photoUrl})`})),i.appendChild(Object(G.ce)("div",{className:"MetaStory__appName",innerHTML:this.data.app.name})),i.appendChild(Object(G.ce)("span",{className:"MetaStory__appLink",innerHTML:getLang("stories_go_to_app")})),r.appendChild(i),s.appendChild(r),Object(G.setStyle)(s,{paddingBottom:`${this.elemOffset}px`}),Object(G.setStyle)(this.elems.recItems,{minHeight:`calc(100% - ${this.elemOffset}px`}),e.appendChild(s);var o=Object(G.ce)("div",{className:"MetaStory__navigationBtn MetaStory__backBtn"}),a=Object(G.ce)("div",{className:"MetaStory__navigationBtn MetaStory__nextBtn"}),n=Object(G.ce)("div",{className:"MetaStory__clickableArea"});n.appendChild(o),n.appendChild(a),Object(ke.addEvent)(n,"mousedown",this.handleGridInfoWrapperMouseDown.bind(this)),Object(ke.addEvent)(n,"mouseup",this.handleGridInfoWrapperMouseUp.bind(this)),this.coverItems.forEach(e=>{var t=e.items.filter(e=>e.unread),s=!!t.length,r=e.items[0];s&&(r=t[0]);var i=Object(G.ce)("span",{className:"GridStoryPreview"+("live"===r.type?" GridStoryPreview--live":""),onclick:t=>{var s=t.target;Stories.show(`${cur.storyLayer.getBlockKey(e)}/apps`,{fromEl:s})}}),o=Object(G.ce)("div",{className:"GridStoryPreview__inner",innerHTML:`\n            <a href="${e.author.href}" data-author-id="${e.author.id}" class="GridStoryPreview__author${s?" GridStoryPreview__author--unread":""}" style="background-image: url('${e.author.photo}')"></a>\n            <span class="GridStoryPreview__title">${e.author.name}</span>\n          `},{backgroundImage:`url('${r.preview_url}')`}),a=new Image;a.src=r.small_preview,a.onload=()=>{Object(G.setStyle)(o,{backgroundImage:`url('${r.small_preview}')`})},i.appendChild(o),this.elems.recItems.appendChild(i)}),Object(ke.addEvent)(this.elems.recInner,"scroll",this.handleRecommendationsScroll.bind(this)),this.elems.recInner.appendChild(n),this.elems.recInner.appendChild(this.elems.recItems),this.elems.recBlock.appendChild(this.elems.recInner),e.appendChild(this.elems.recBlock)}return e}renderGroupsMetaStory(){var e=Object(G.ce)("div",{className:"MetaStory"}),t=Stories._getList("groups");if(t){this.coverItems=t,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.elems.recBlock=Object(G.ce)("div",{className:"MetaStory__rec"}),this.elems.recInner=Object(G.ce)("div",{className:"MetaStory__rec-inner"}),this.elems.recItems=Object(G.ce)("div",{className:"MetaStory__rec-items"}),this.elemOffset=286,this.scrollOffset=0,this.metaStoryGridMarginTop=this.elemOffset;var s=Object(G.ce)("div",{className:"MetaStory__infoWrapper"}),r=Object(G.ce)("div",{className:"MetaStory__info"});r.appendChild(Object(G.ce)("div",{className:"MetaStory__infoTitle",innerHTML:getLang("stories_groups_grid_title")})),r.appendChild(Object(G.ce)("div",{className:"MetaStory__infoDescription",innerHTML:getLang("stories_groups_grid_text")})),s.appendChild(r),Object(G.setStyle)(s,{paddingBottom:`${this.elemOffset}px`}),Object(G.setStyle)(this.elems.recItems,{minHeight:`calc(100% - ${this.elemOffset}px`}),e.appendChild(s);var i=Object(G.ce)("div",{className:"MetaStory__navigationBtn MetaStory__backBtn"}),o=Object(G.ce)("div",{className:"MetaStory__navigationBtn MetaStory__nextBtn"}),a=Object(G.ce)("div",{className:"MetaStory__clickableArea"});a.appendChild(i),a.appendChild(o),Object(ke.addEvent)(a,"mousedown",this.handleGridInfoWrapperMouseDown.bind(this)),Object(ke.addEvent)(a,"mouseup",this.handleGridInfoWrapperMouseUp.bind(this)),this.coverItems.forEach(e=>{var t=e.items.filter(e=>e.unread),s=!!t.length,r=e.items[0];s&&(r=t[0]);var i=Object(G.ce)("span",{className:"GridStoryPreview"+("live"===r.type?" GridStoryPreview--live":""),onclick:t=>{var s=t.target;Stories.show(`${cur.storyLayer.getBlockKey(e)}/groups`,{fromEl:s})}}),o=Object(G.ce)("div",{className:"GridStoryPreview__inner",innerHTML:`\n            <a href="${e.author.href}" data-author-id="${e.author.id}" class="GridStoryPreview__author${s?" GridStoryPreview__author--unread":""}" style="background-image: url('${e.author.photo}')"></a>\n            <span class="GridStoryPreview__title">${e.author.name}</span>\n          `},{backgroundImage:`url('${r.preview_url}')`}),a=new Image;a.src=r.small_preview,a.onload=()=>{Object(G.setStyle)(o,{backgroundImage:`url('${r.small_preview}')`})},i.appendChild(o),this.elems.recItems.appendChild(i)}),Object(ke.addEvent)(this.elems.recInner,"scroll",this.handleRecommendationsScroll.bind(this)),this.elems.recInner.appendChild(a),this.elems.recInner.appendChild(this.elems.recItems),this.elems.recBlock.appendChild(this.elems.recInner),e.appendChild(this.elems.recBlock)}return e}renderNarrativeMetaStory(){var e=!(!cur.storyLayer||!cur.storyLayer.isOpenNarrativeFromFeed),t=cur.storyLayer.list,s=`${t}_recommendations`,r=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=Object(G.ce)("div",{className:"MetaStory"}),o=Object(G.ce)("div",{className:"MetaStory__buttons"});o.appendChild(this.renderNarrativeButton("replay",()=>{cur.storyLayer._sendNavigationStatEvents("narrative_replay",!1),cur.storyLayer.changeStory(0)})),e&&o.appendChild(this.renderNarrativeButton("go_to_stories",()=>{cur.storyLayer._sendNavigationStatEvents("narrative_go_to_stories",!1),cur.storyLayer.nextStory()})),i.appendChild(o);var a=Stories._getList(s);return t.match(/narrative-?\d+_\d+$/)&&a&&(this.coverItems=a.map(e=>e.narrative_cover),this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.elems.recBlock=Object(G.ce)("div",{className:"MetaStory__rec"}),this.elems.recInner=Object(G.ce)("div",{className:"MetaStory__rec-inner"}),this.elems.recItems=Object(G.ce)("div",{className:"MetaStory__rec-items"}),this.elems.recTitle=Object(G.ce)("div",{className:"MetaStory__rec-title",innerHTML:getLang("stories_narrative_more")}),this.elemOffset=0,1===this.coverRowsCount?this.elemOffset=26.4:this.coverRowsCount>1&&(this.elemOffset=26.4*1.5),this.scrollOffset=r/100*this.elemOffset+53,Object(G.setStyle)(o,{paddingBottom:`${this.elemOffset}vh`}),Object(G.setStyle)(this.elems.recTitle,{marginTop:`calc(100vh - ${this.elemOffset}vh - 53px - 70px)`}),this.coverItems.forEach(e=>{var t=Object(G.ce)("span",{className:"GridStoryPreview",onclick:t=>{var r=t.target;Stories.show(`${cur.storyLayer.getBlockKey(e)}/${s}`,{fromEl:r,narrativeId:e.narrative.id,source:"narrative_recommendations"})}},{backgroundImage:`url('${e.preview_url}')`}),r=Object(G.ce)("div",{className:"GridStoryPreview__inner",innerHTML:`\n            <a href="${a[0].author.href}" class="GridStoryPreview__author" style="background-image: url('${a[0].author.photo}')"></a>\n            <span class="GridStoryPreview__title">${e.narrative.title}</span>\n          `},{backgroundImage:`url('${e.small_preview}')`});t.appendChild(r),this.elems.recItems.appendChild(t)}),Object(ke.addEvent)(this.elems.recBlock,"scroll wheel touchmove",this.handleRecommendationsScroll.bind(this)),this.elems.recInner.appendChild(this.elems.recTitle),this.elems.recInner.appendChild(this.elems.recItems),this.elems.recBlock.appendChild(this.elems.recInner),i.appendChild(this.elems.recBlock)),i}renderNarrativeButton(e,t){if(!e)return"";var s="",r="";switch(t=isFunction(t)?t:()=>{},e){case"replay":s="replay",r=getLang("stories_narrative_repeat_bottom");break;case"go_to_stories":s="back",r=getLang("stories_narrative_back_bottom")}var i=Object(G.ce)("div",{className:`narrative-meta-button__circle narrative-meta-button__circle_${s}`,onclick:t}),o=Object(G.ce)("div",{className:"narrative-meta-button__text",innerHTML:r}),a=Object(G.ce)("div",{className:"narrative-meta-button"});return a.appendChild(i),a.appendChild(o),a}handleRecommendationsScroll(){var e=Math.min(this.elems.recInner.scrollTop/(this.scrollOffset/100),70)/100;Object(G.setStyle)(this.elems.recBlock,{backgroundColor:`rgba(0, 0, 0, ${e})`}),this.elems.recInner.scrollTop?(this.isPausedByMetaScroll=!0,Object(G.addClass)(this.elems.recBlock,"scroll"),this.pause()):(this.isPausedByMetaScroll=!1,this.play(),Object(G.removeClass)(this.elems.recBlock,"scroll"),Object(G.setStyle)(this.elems.recBlock,{backgroundColor:"rgba(0, 0, 0, 0)"})),(this.data.is_groups_meta_story||this.data.is_apps_meta_story)&&(this.elems.blockHeader||(this.elems.blockHeader=cur.storyLayer.activeStory.authorButtons.querySelector(".stories_groups_settings_text")),this.elems.recInner.scrollTop&&Object(G.removeClass)(cur.storyLayer.activeStory.wrapEl,"paused"),this.elems.recInner.scrollTop>this.metaStoryGridMarginTop?(Object(G.removeClass)(cur.storyLayer.activeStory.wrapEl,"paused"),Object(G.removeClass)(this.elems.blockHeader,"stories_groups_settings_text_hide")):Object(G.addClass)(this.elems.blockHeader,"stories_groups_settings_text_hide"))}handleGridInfoWrapperMouseDown(e){this.downTs=vkNow(),this.longTapTimer=setTimeout(this.longTapInfoWrapper.bind(this),P)}handleGridInfoWrapperMouseUp(e){if(cur.storyLayer.activeStory){clearTimeout(this.longTapTimer);var t=!(vkNow()-this.downTs<P);if(hasClass(e.target,"MetaStory__backBtn")&&!t)return cur.storyLayer.activeStory.prevStory();t?cur.storyLayer.activeStory.isPaused()&&cur.storyLayer.activeStory.playStory(!1,!!this.downTs):cur.storyLayer.activeStory._onPlayEnd()}}longTapInfoWrapper(){cur.storyLayer.activeStory&&cur.storyLayer.activeStory._longTapHandle()}getContainer(){}play(){this.paused=!1,this.isLoaded()&&this.opts.onPlay()}pause(){this.paused=!0,this.opts.onPause()}setCurrentTime(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}destroy(){Object(ke.removeEvent)(this.elems.recBlock),clearTimeout(this.longLoadingTimer)}isPaused(){return this.paused}isLoaded(){return this.loaded}getCurrentTime(){return 0}getDuration(){return 0}getId(){return this.data.raw_id}getTrackCode(){return this.data.track_code}getDate(){return this.data.date}getViews(){return this.data.views}getReplies(){return this.data.answers?this.data.answers:{count:"",count_str:"",users:[]}}setViews(e){this.data.views=e}setReplies(e){this.data.answers=e}_onCanPlay(){if(clearTimeout(this.longLoadingTimer),this.loaded=!0,this.opts.onLoadingEnd(),this.startTs=Date.now(),!this.isPaused()){var e=document.visibilityState;if(e&&"visible"!==e)return;this.play()}}_loadingError(){this._error("load")}_error(e){clearTimeout(this.longLoadingTimer),this.opts.onError(e)}_isFailed(){return this.failed}}var je=5e3;class Le extends Oe{constructor(e,t,s){super(e,t,s),this.wrapEl=s,this.videoRaw=`${this.data.video.owner_id}_${this.data.video.video_id}`}render(){super.render(),this.el=ce("div",{className:"stories_live"});var e=ce("div",{className:"stories_live_player"},{height:"100%",width:"100%"});return this.el.appendChild(e),this.chatEl=se('\n      <div class="stories_live_chat">\n        <div class="mv_chat_messages_wrap">\n          <div class="mv_chat_messages"></div>\n        </div>\n        <div class="mv_chat_stickers_wrap"></div>\n      </div>\n    '),this.el.appendChild(this.chatEl),window.mvcur&&window.mvcur.player&&Videoview.hide(!1,!0),setTimeout(()=>{showInlineVideo(this.videoRaw,"",{autoplay:1,module:"story",onLoaded:()=>{this._onPlayerInited()}},!1,e)}),this.el}destroy(){super.destroy(),this._resetTimer(),window.mvcur={},this.player&&(this.player.destroy(),VideoChat.destroy()),cur.storyLayer._sendNavigationStatEvents("live_player_close",!1),delete this.el}getContainer(){return this.el||this.render()}onLiveEnded(){this.liveEnded=!0,hide(geByClass1("_error_msg",geByClass1("videoplayer_error")));var e=this.mvData.oid<0?getLang("stories_live_ended_desc_club"):langSex(this.mvData.author_sex,getLang("stories_live_ended_desc_user","raw"));e=e.replace("{name}",this.mvData.md_author);var t=this.mvData.oid<0?getLang("stories_live_ended_open_club"):getLang("stories_live_ended_open_user");hide(this.chatEl),hide(domByClass(this.player.ui.thumb,"videoplayer_big_play_btn"));var s=cur.storyLayer.storiesBlocks.length>1;this.el.appendChild(se(`\n    <div class="stories_live_end">\n      <div class="stories_live_end_author_photo" style="background-image: url(${this.mvData.author_photo})"></div>\n      <div class="stories_live_end_title">${getLang("stories_live_ended_title")}</div>\n      <div class="stories_live_end_desc">${e}</div>\n      <a href="${this.mvData.author_href}" class="stories_live_end_open_owner">${t}</a>\n      <div class="stories_live_end_timer" onclick="cur.storyLayer.nextStory()" style="${s?"":"display: none;"}">\n        <canvas class="_timer_canvas" width="100" height="100"></canvas>\n        <div class="stories_live_end_timer_text">${getLang("stories_live_ended_watch_next")}</div>\n      </div>\n    </div>\n    `)),s&&setTimeout(()=>{this._startTimer()})}pause(){}play(){this.player&&!this.liveEnded&&(super.play(),this.player&&this.player.play())}sendMessage(e,t){e.length>mvcur.maxChatReplyLength||(ajax.post("al_video.php?act=post_comment",{comment:e,video:this.videoRaw,hash:this.mvData.hash,videoviewer_chat:1}),cur.storyLayer.activeStory._onAnswerSent(t))}volumeUpdate(){this.player.setVolume(y())}_onCanPlay(){super._onCanPlay(),setStyle(this.el,"opacity",1)}_onPlayerInited(){this._onCanPlay(),this.player=window.cur.videoInlinePlayer,this.play(),cur.storyLayer._sendNavigationStatEvents("live_player_show",!1),browser.safari&&this.player.toggleMute(!0,!1),this.mvData=Videoview.getMvData(),window.mvcur={chatMode:!0,maxChatReplyLength:this.mvData.maxChatReplyLength,mvData:this.mvData,mvShown:!0,queueKey:this.mvData.queue_params.key,qversion:this.mvData.qversion},VideoChat.init(this.chatEl,{scrollHidden:!0}),Videoview.queueCheckUpdates(this.mvData.queue_params)}_startTimer(){if(window.CanvasRenderingContext2D){var e=domByClass(this.el,"_timer_canvas"),t=e.getContext("2d");t.lineWidth=6,t.lineCap="round",t.strokeStyle="#fff";var s=Date.now(),r=()=>{var e=(Date.now()-s)/je;e<1?(t.clearRect(0,0,100,100),t.beginPath(),t.arc(50,50,47,-Math.PI/2,-Math.PI/2+2*Math.PI*e),t.stroke(),this._nextTO=setTimeout(r,16)):cur.storyLayer.nextStory()};show(e),this.timerInProgress=!0,r()}}_resetTimer(){window.CanvasRenderingContext2D&&(clearTimeout(this._nextTO),this.timerInProgress=!1,hide(domByClass(this.el,"_timer_canvas")))}}class Be extends Oe{constructor(e,t){super(e,t),this.isFirstChunkLoaded=!1}render(){if(super.render(),this.video)return this.video;var e=this.data.video_url;return this.video=ce("video",{className:"stories_video",autoplay:!1,volume:getAudioPlayer().getVolume()}),addEvent(this.video,"error",()=>{this._loadingError()}),this._isFailed()?this.video:(this.loaded&&(this.video.currentTime=0),addEvent(this.video,"canplay",this._onCanPlay.bind(this)),this.video.src=e,this.volumeUpdate(),this.video)}getContainer(){return this.video||this.render()}getImage(){var e=getSize(this.video),t=ce("canvas",{width:e[0],height:e[1]});return t.getContext("2d").drawImage(this.video,0,0,e[0],e[1]),t.toDataURL()}destroy(){super.destroy(),removeEvent(this.video),delete this.video}play(){if(super.play(),this.loaded&&this.video){var e=this.video.play();void 0!==e&&e.catch(e=>{this.opts.onAutoPlayFail()})}}pause(){super.pause(),this.video&&this.video.pause()}setCurrentTime(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.loaded&&(this.video.currentTime=e)}getCurrentTime(){return 1e3*this.video.currentTime}getDuration(){return 1e3*this.video.duration}_onCanPlay(e){super._onCanPlay(e),this.isFirstChunkLoaded||(this.isFirstChunkLoaded=!0,cur.storyLayer._sendNavigationStatEvents("view_story",!0,{preloading_duration:cur.storyLayer.activeStory&&cur.storyLayer.activeStory.loadingTime||0})),setStyle(this.video,"opacity",1)}volumeUpdate(){this.video.volume=y()}}var Fe=5e3;class Te extends Oe{constructor(e,t){super(e,t),this.pauseTime=0}render(){if(super.render(),this.photo)return this.photo;var e=this.data,t=e.photo_url,s=e.narrative;return this.photo=ce("div",{className:"stories_photo"}),this._isFailed()?this.photo:(_(t).then(e=>{this.photo&&(s&&s.is_cover?addClass(this.photo,"stories_narrative_cover_blur"):setStyle(this.photo,"backgroundImage","url("+e+")"),this._onCanPlay())}).catch(()=>{this.isGroupsMetaStory||this.isAppsMetaStory?this._onCanPlay():this._loadingError()}),this.photo)}getContainer(){return this.isNarrativeMetaStory||this.isGroupsMetaStory||this.isAppsMetaStory||this.photo||this.render()}destroy(){super.destroy(),delete this.photo}play(){(0===this.startTs||this.pauseTime>0)&&(this.startTs=Date.now()-this.pauseTime,this.pauseTime=0),super.play()}pause(){this.isPaused()||(super.pause(),this.pauseTime=this.getCurrentTime())}setCurrentTime(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.startTs=Date.now()+e,this.isPaused()&&(this.pauseTime=e)}getCurrentTime(){return Date.now()-this.startTs||0}getDuration(){return Fe}_onCanPlay(){super._onCanPlay();var e=this.isGroupsMetaStory?"group_feed_view":"view_story";cur.storyLayer._sendNavigationStatEvents(e,!0,{preloading_duration:cur.storyLayer.activeStory&&cur.storyLayer.activeStory.loadingTime||0}),setStyle(this.photo,"opacity",1)}}var xe=s("v+DW"),Ne=s("4+be"),Me=s("kcIO"),Ae=s("rudk"),Pe=s("r7nW"),Ie=s("uW+i"),Re=s("vRp6"),He=s("p+C8"),$e=s("NsuH"),We=s("22MJ"),qe=s("0Rlc");var Ge=class extends r.Component{constructor(e){super(e),this.onTabClick=(e,t)=>new Promise(()=>{var e=this.state,s=e.allGroupsTabList,r=e.pinnedIdsMap,i=s.filter(e=>r[e.id]),o=s.filter(e=>!r[e.id]);this.resetScroll(),this.setState({pinnedGroupsTabList:i,unpinnedGroupsTabList:o,tabKey:t})}),this.onSearchChange=e=>{var t=e.target.value;this.state.searchQuery!==t&&(this.resetScroll(),this.setState({searchQuery:t}))},this.onGroupItemClick=e=>new Promise(()=>{var t=this.state.pinnedIdsLength,s=this.state.pinnedIdsMap,r=+e.currentTarget.getAttribute("data-id"),i=this.allGroupsMap[r];i.isUserAdmin||i&&(t+=s[r]?-1:1,s[r]=!s[r],this.props.sendNavigationStatEvents(s[r]?"set_pin":"set_unpin"),this.setState({pinnedIdsMap:s,pinnedIdsLength:t}))}),this.setScrollContainerRef=e=>{var t=e;if(e&&e.container)for(t=e;t.container;)t=t.container;this.scrollContainer=t},this.onPutGroupsBackCheckBoxChange=()=>{var e=!this.state.putGroupsBack;e&&this.props.sendNavigationStatEvents("pin_to_end"),this.setState({putGroupsBack:e})},this.onSave=()=>{var e=this.props,t=e.onClose,s=e.showMessage,r=e.hash,i=this.state,o=i.pinnedIdsMap,a=i.putGroupsBack,n=Object.keys(o).filter(e=>o[e]);ajax.post("al_stories.php",{act:"save_feed_settings",pinned_ids:n.join(","),put_groups_back:intval(a),hash:r},{onDone:()=>{t(),s(Object(L.getLang)("stories_settings_saved"))},onFail:e=>{t(),s(e)},showProgress:()=>this.setState({isRequestSending:!0}),hideProgress:()=>this.setState({isRequestSending:!1})})};var t=e.groups,s=e.putGroupsBack,r=t.filter(e=>!e.is_pinned),i=t.filter(e=>e.is_pinned),o=t.reduce((e,t)=>(e[t.id]=t.is_pinned,e),{});this.state={tabKey:"all",searchQuery:"",isRequestSending:!1,putGroupsBack:s,allGroupsTabList:t,unpinnedGroupsTabList:r,pinnedGroupsTabList:i,pinnedIdsMap:o,pinnedIdsLength:i.length},this.allGroupsMap=t.reduce((e,t)=>(e[t.id]=t,e),{}),this.scrollContainer=null,this.groupsSearchIndex=null,this.createSearchIndex().then(e=>{this.groupsSearchIndex=e})}resetScroll(){this.scrollContainer.scrollTop=0}createSearchIndex(){var e=window.vkIndexer,t=this.props.groups;return new Promise(s=>{new e(t,e=>e.name,e=>{s(e)})})}getCurrentGroups(){var e=this.state,t=e.allGroupsTabList,s=e.pinnedGroupsTabList,r=e.unpinnedGroupsTabList,i=e.tabKey,o=e.searchQuery,a=[];switch(i){case"all":a=t;break;case"pinned":a=s;break;case"unpinned":a=r}if(o){var n=this.groupsSearchIndex.search(o);return a.filter(e=>n.includes(e))}return a}render(){var e=this.props.onClose,t=this.state,s=t.allGroupsTabList,i=t.pinnedIdsLength,o=t.searchQuery,a=t.isRequestSending,n=t.putGroupsBack,l=this.getCurrentGroups(),c=s.length-i;return r.createElement(Pe.default,{onClose:e,className:Object(N.classNames)("SettingsModal",this.props.className)},r.createElement("div",{className:"SettingsModal__header"},r.createElement(Ie.default,{className:"SettingsModal__tabs",onTabClick:this.onTabClick},r.createElement("span",{key:"all"},Object(L.getLang)("stories_settings_box_tab_all")),i>0&&r.createElement("span",{key:"pinned"},Object(L.getLang)("stories_settings_box_tab_separately"),r.createElement("span",{className:"Tabs__desc"},i)),c>0&&r.createElement("span",{key:"unpinned"},Object(L.getLang)("stories_settings_box_tab_grouped"),r.createElement("span",{className:"Tabs__desc"},c))),r.createElement("div",{className:"SettingsModal__headerCross",onClick:e})),r.createElement("div",{className:"SettingsModal__content"},r.createElement(We.default,{value:o,autoFocus:!0,placeholder:Object(L.getLang)("stories_settings_box_search_placeholder"),onChange:this.onSearchChange}),r.createElement(Re.default,{className:"SettingsModal__scrollContainer",hasMore:!1,virtualized:!0,loadMore:()=>{},ref:this.setScrollContainerRef},l.map(e=>r.createElement(He.default,{className:Object(N.classNames)(this._getGroupItemClasses(e)),"data-id":e.id,key:e.id,onClick:this.onGroupItemClick},r.createElement($e.default,{target:"_blank",size:"34",photo:e.photoUrl,title:e.name,href:e.url}))))),r.createElement("div",{className:"SettingsModal__footer"},r.createElement("div",{className:"SettingsModal__footerInner"},r.createElement(qe.default,{className:"SettingsModal__putBackBtn",checked:n,onChange:this.onPutGroupsBackCheckBoxChange},Object(L.getLang)("stories_settings_box_put_back")),r.createElement("div",{className:"SettingsModal__submitButtons"},r.createElement(ie.default,{key:"closeModal",appearance:"tertiary",onClick:e},Object(L.getLang)("global_cancel")),r.createElement(oe.default,{key:"saveModal",onClick:this.onSave,loading:a},Object(L.getLang)("global_save"))))))}_getGroupItemClasses(e){var t="SettingsModal__groupItem";return this.state.pinnedIdsMap[e.id]&&(t+=" SettingsModal__groupItem--pinned"),e.isUserAdmin&&(t+=" SettingsModal__groupItem--disabled"),t}};function Ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class Ve{constructor(e,t){this.data=e,this.opts=t,this.id=t.id,this.isActive=!1,this.isSendFormActive=!1,this.isModalShown=!1,this.story=!1,this.pressedStory=null,this.index=0,this.preloadedStories={},this.layer=t.layer,this.longTapTimer}destroy(){this._destroyStory(),Object(ke.removeEvent)(Object(G.geByClass1)("stories_item_cont",this.contWrap)),Object(ke.removeEvent)(Object(G.geByClass1)("stories_reply_to",this.replyToWrap)),Object(ke.removeEvent)(this.shareButton),delete this.shareButton,Object(ke.removeEvent)(this.followBtn),delete this.followBtn,Object(ke.removeEvent)(this.pinButton),delete this.pinButton,Object(ke.removeEvent)(this.answersEl),delete this.answersEl,clearTimeout(this.showMessageTimer);for(var e=Object(G.geByClass)("stories_time_line",this.timeLineEl),t=0;t<e.length;t++)Object(ke.removeEvent)(e[t]);Object(ke.removeEvent)(this.viewsButton),Object(ke.removeEvent)(Object(G.geByClass1)("stories_feedback_close",this.wrapEl)),Object(ke.removeEvent)(Object(G.geByClass1)("stories_link",this.wrapEl)),delete this.contWrap,delete this.backButton,delete this.replyToWrap,delete this.descEl,delete this.replyToWrap,delete this.timeLineEl,delete this.authorButtons,delete this.inlineLoader,this.wrapEl&&this.wrapEl.parentNode&&this.wrapEl.parentNode.removeChild(this.wrapEl),delete this.wrapEl;for(var s=!1,r=0;r<this.data.items.length;r++)if(this.data.items[r].unread){s=!0;break}var i=k();if(!s&&i&&i.activeStory&&!this.data.is_apps){var o=Object(G.domQuery)("#feed_story_"+this.layer.getBlockKey(this.data),i.activeStory.wrapEl)[0];Object(G.removeClass)(o,"story_feed_new_item"),Object(G.removeClass)(o,"story_feed_new_item_promo")}}_destroyTimeLine(){for(var e=Object(G.geByClass)("stories_time_line",this.timeLineEl),t=0;t<e.length;t++)Object(ke.removeEvent)(e[t])}getOwnerId(){return this.data.author.id}getIndex(){return this.index}isLastStory(){return this.index>=this.data.items.length-1}getRawId(){return!!this.story&&this.story.getId()}getTrackCode(){return!!this.story&&this.story.getTrackCode()}getReadHash(){return this.data.read_hash}getPinHash(){return this.data.stories_pin_hash}getGetGroupsSettingsHash(){return this.data.stories_get_groups_settings_hash}getSaveGroupsSettingsHash(){return this.data.stories_save_groups_settings_hash}getType(){return this.data.type}getItems(){return this.data.items}getItemsLength(){return this.getItems().length}render(){this.wrapEl=ce("div",{className:"stories_item"}),this.contWrap=ce("div",{className:"stories_item_cont_wrap"}),this.contStickers=ce("div",{className:"stories_item_cont_sticker"}),this.storiesHeader=ce("div",{className:"stories_header"}),this.contWrap.appendChild(this.contStickers),this.wrapEl.appendChild(this.contWrap);var e=ce("div",{className:"stories_item_cont"});return Object(ke.addEvent)(e,"mousedown",e=>{this._onMouseDownHandle(e.target)}),Object(ke.addEvent)(e,"mouseup",()=>{this._onMouseUpHandle(event.target)}),this.contWrap.appendChild(e),this.contWrap.appendChild(this.storiesHeader),this.storiesHeader.appendChild(this._renderAuthor()),this.storySendFormOverlay=ce("div",{className:"stories_bottom_overlay"}),this.storySendFormOverlay.appendChild(ce("div",{className:"stories_bottom_wrap"})),this.contWrap.appendChild(this.storySendFormOverlay),this.contWrap.appendChild(this._renderPreview()),this.indexToUnread(),cur.noStoriesBack||(this.backButton=ce("div",{className:"stories_item_back"}),e.appendChild(this.backButton)),this.replyToWrap=e.appendChild(ce("div",{className:"stories_reply_to_wrap"})),this.inlineLoader=e.appendChild(ce("div",{className:"stories_inline_loader",innerHTML:getProgressHtml()})),this.contWrap.appendChild(ce("div",{className:"stories_play_button video_thumb_play",onclick:()=>{this.story.play()}})),this.isActiveLive()?Object(G.addClass)(this.wrapEl,"live"):this._initTimeLine(),Object(G.toggleClass)(this.wrapEl,"multi_stories",this.data.items.length>1),this.wrapEl}updateBottom(e){var t=Object(G.geByClass1)("stories_bottom_wrap",this.wrapEl);!this.isActive||e||this.story.isNarrativeMetaStory||this.story.isGroupsMetaStory||this.story.isAppsMetaStory?(i.unmountComponentAtNode(t),val(t,"")):i.render(r.createElement(ee,{story:this,sendNavigationStatEvents:this.layer._sendNavigationStatEvents.bind(this.layer)}),t)}_canForceDeleteStories(){return this.data.moder_remove_hash&&!this.data.items[0].is_deleted}_initTimeLine(){this.timeLineEl&&(this._destroyTimeLine(),re(this.timeLineEl)),this.storiesHeader.appendChild(this._renderTimeLine())}_isActionsShown(){var e=domClosest("_ui_menu_wrap",this.wrapEl);return hasClass(e,"shown")}_renderPreview(){return Object(G.se)('<div class="stories_preview"></div>')}_renderMessage(e){return Object(G.se)(`<div class="stories_message">\n  <div class="stories_message_text">${e}</div>\n</div>`)}_showMessage(e){re(Object(G.geByClass1)("stories_message",this.contWrap));var t=this._renderMessage(e);return this.contWrap.appendChild(t),clearTimeout(this.showMessageTimer),new Promise(e=>{this.showMessageTimer=setTimeout(()=>{this.contWrap.removeChild(t),e()},3e3)})}_setPreview(e,t){var s=this.index,r=this.data.items[s].preview_url;r!==this.curPreviewUrl&&r&&(t=t||(()=>{}),e=e||Object(G.geByClass1)("stories_preview",this.contWrap),_(r).then(i=>{s===this.index&&r!==this.curPreviewUrl&&(this.curPreviewUrl=r,Object(G.setStyle)(e,"backgroundImage","url("+i+")")),Object(G.setStyle)(e,"opacity",1),setTimeout(t,0)}))}getPreview(){return this.data.items[this.index].preview_url}_renderAuthor(){var e,t=this.data.author,s=t.photo,r=t.href,i=t.name,o=t.verify,a=this.data&&this.data.items[0]&&this.data.items[0].narrative,n="_self";if(this.layer.list.includes("place")&&(n="_blank"),this.data.is_groups)e=`\n      <div class="stories_author_cont">\n        <a href="${r}" target="${n}" class="stories_author_name"><span>${Object(Ne.getLang)("stories_groups_feed_block")}</span></a>\n        <div class="stories_desc"></div>\n      </div>`;else if(this.data.is_narrative&&a&&!a.is_cover)e=`\n      <div>\n          <div class="stories_narrative_title">${a.title}</div>\n          <span class="stories_narrative_author"><a href="${r}" target="${n}" class="stories_narrative_author_link">${i}</a> · ${Object(Ne.getLang)("global_type_narrative")}</span>\n      </div>`;else{e=`\n      <div class="stories_author_cont">\n        ${`<a href="${r}" class="stories_author_photo_wrap"><img src="${s}" class="stories_author_photo" /></a>`}\n        <a href="${r}" target="${n}" class="stories_author_name"><span>${i}</span></a>\n        ${o||""}\n        <div class="stories_desc"></div>\n      </div>`}var l=Object(G.se)(`\n      <div class="stories_author">\n        <div class="stories_author_cont_wrap">\n          <div class="stories_author_inner">${e}</div>\n          <div class="stories_author_buttons"></div>\n         </div>\n      </div>\n    `);return Object(ke.addEvent)(l,"click",e=>{Object(G.domClosestByTag)("a",e.target)&&this.layer._sendNavigationStatEvents("go_to_author")}),!0===this.data.hide_owner&&val(Object(G.geByClass1)("stories_author_cont",l),""),Object(G.toggleClass)(this.wrapEl,"hide_owner",!0===this.data.hide_owner),this.descEl=Object(G.geByClass1)("stories_desc",l),this.authorButtons=Object(G.geByClass1)("stories_author_buttons",l),l}_createPinButton(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=ce("div",{className:`stories_group_btn stories_group_btn_pin${e?" stories_group_btn_unpin":""}`});return Object(ke.addEvent)(t,"click",()=>{var e=hasClass(t,"stories_group_btn_unpin");this.layer._sendNavigationStatEvents(e?"unpin":"pin"),this.toggleCurrentOwnerPin()}),this._showFeatureTooltipIfNeed(),t}_showFeatureTooltipIfNeed(){cur.stories_pin_feature_tooltip&&!cur.pinFeatureTooltip&&(cur.pinFeatureTooltipTimeoutId=setTimeout(()=>{var e=Object(G.geByClass1)("stories_group_btn_pin",this.wrapEl);if(e){var t=Object(G.se)(`\n        <div>\n          <div class="stories_pin_feature_tt_close" onclick="cur.pinFeatureTooltip.hide(); cancelEvent(event);"></div>\n          <div>${Object(Ne.getLang)("stories_groups_tooltip")}</div>\n        </div>\n     `);Object(ke.addEvent)(t,"click",()=>{cur.pinFeatureTooltip.hide()}),cur.pinFeatureTooltip=new ElementTooltip(e,{appendToParent:!0,autoShow:!1,forceSide:"bottom",cls:"eltt_fancy stories_pin_feature_tt",offset:[4,-3],content:t,align:"right",onHide:this._closeFeatureTooltip.bind(this)}),this.pauseStory(),cur.pinFeatureTooltip.show(),cur.pinFeatureTooltipTimeoutId=null}},2e3),cur.destroy.push(()=>clearTimeout(cur.pinFeatureTooltipTimeoutId)))}_closeFeatureTooltip(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];cur.pinFeatureTooltip&&(cur.stories_pin_feature_tooltip=!1,cur.pinFeatureTooltip.destroy(),cur.pinFeatureTooltip=null,e&&this.playStory(),ajax.post("al_index.php",{act:"hide_feature_tt",hash:cur.stories_pin_feature_tooltip_hash,type:"stories_pin"}))}_renderFollowButton(){return this.followBtn=ce("div",{className:"stories_author_button stories_follow"}),Object(ke.addEvent)(this.followBtn,"click",this._onFollowBtnClick.bind(this)),Object(ke.addEvent)(this.followBtn,"mouseover",()=>{var e=hasClass(this.followBtn,"followed")?Object(Ne.getLang)("stories_unfollow"):Object(Ne.getLang)("stories_follow");showTooltip(this.followBtn,{black:1,center:1,shift:[0,5,0],text:e,appendEl:this.contWrap})}),this.followBtn}_renderTimeLine(){return this.timeLineEl=ce("div",{className:"stories_time_line"}),this.data.items.map((e,t)=>{var s=ce("div",{className:"stories_time_line_item"});Object(ke.addEvent)(s,"click",()=>{this.layer._sendNavigationStatEvents("go_to_story_click"),this.changeStory(t)});var r=ce("div",{className:"stories_time_line_item_cont"});r.appendChild(ce("div",{className:"stories_time_line_item_cont_active"})),s.appendChild(r),this.timeLineEl.appendChild(s)}),this.timeLineEl}isPaused(){return!this.story||this.story.isPaused()}isLoaded(){return!this.story||this.story.isLoaded()}_onMouseDownHandle(e){this.pressedStory=e,this.isActive&&(this.isLocked()||(hasClass(e,"stories_item_cont")||hasClass(e,"stories_item_back")||hasClass(e,"StoryStickers__disableArea"))&&!this.downTs&&(this.downTs=vkNow(),this.longTapTimer=setTimeout(this._longTapHandle.bind(this),P)))}_onMouseUpHandle(e){clearTimeout(this.longTapTimer);var t=this.downTs;if(delete this.downTs,e===this.pressedStory){this.pressedStory=null;var s=!(vkNow()-t<P&&!this.isSendFormActive&&!hasClass(this.wrapEl,"autoplay_failed"));if(this.isActive&&(hasClass(e,"stories_item_back")||hasClass(e,"StoryStickers__disableArea--left"))&&!s&&!this.isTooltipOpened())return this.prevStory();if(hasClass(e,"stories_item_cont")||hasClass(e,"stories_item_back")||hasClass(e,"StoryStickers__disableArea"))if(this._feedbackTTShown&&this.hideFeedbackTooltip(),Object(G.removeClass)(this.wrapEl,"paused"),this.isTooltipOpened())this._hideTooltip();else{if(!this.isActive){this.id>=this.layer.activeStory.id&&this.layer._markStoryAsSkipped();var r=this.layer.storiesBlocks;return r.indexOf(this.layer.getBlockKey(this))>r.indexOf(this.layer.blockKey)?this.layer._sendNavigationStatEvents("go_to_next_author"):this.layer._sendNavigationStatEvents("go_to_previous_author"),void this.opts.onSelect(this)}s?this.isPaused()&&this.playStory(!1,!!t):this._onPlayEnd()}}}_longTapHandle(){this.story&&this.story.pause(),Object(G.addClass)(this.wrapEl,"paused"),this.isTooltipOpened()||this.layer._sendNavigationStatEvents("pause_long_tap")}isLocked(){return!!(this._getSendText()||!this.isActive||this.isSendFormActive||this.isModalShown||this._feedbackTTShown||document.hidden||this._isActionsShown()||isVisible(this.inlineLoader)||hasClass(this.wrapEl,"hiding_reply")||Object(Me.curBox)()&&"stories"!==Object(Me.curBox)().wkRaw||this.story&&this.story.isPausedByMetaScroll)}isSpaceLongTabAvailable(){return!this.story||!this.story.isPausedByMetaScroll}isGroupedStory(){return this.data.is_groups}autoResumeStory(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.audioPlaying||this.story&&this.story.isNarrativeMetaStory||this.isTooltipOpened()||this.playStory(!1,e)}playStory(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;this.isLocked()||(Object(G.removeClass)(this.wrapEl,"paused"),hide(boxLayerBG),hide(boxLayerWrap),this.story&&!e||this._initStory(),this.story.play(),t&&this.layer._sendNavigationStatEvents("resume_release"),delete this.downTs)}pauseStory(e){this.story&&(this.isPaused()||(e&&Object(G.addClass)(this.wrapEl,"paused"),this.story.pause()))}changeStory(e){if(this.index!==e&&!this.isSendFormActive){this._destroyStory(),this.index=e,this._hideTooltip();var t=this.getCurStoryData();t.narrative&&t.narrative.is_cover?this._setPreview(!1,this.playStory.bind(this)):(this._setPreview(),this.playStory())}}getWrap(){return this.wrapEl}stop(){this._destroyFeedBackTT(),this.isActive=!1,this._destroyStory(),this._stopLoader(),val(Object(G.geByClass1)("stories_send_form_text",this.wrapEl),""),this._unlockSendForm(),Object(G.removeClass)(this.wrapEl,"autoplay_failed")}getCurStoryData(){var e=this.data.items[this.index];return e||{}}isActiveLive(){return"live"===this.getCurStoryData().type}isLiveEnded(){return this.isActiveLive()&&this.story.liveEnded}_initStory(){var e=this.getCurStoryData(),t=e.type,s=e.noSound;this.story&&this._destroyStory();var o={onLoadingStart:this._onLoadingStart.bind(this),onLoadingEnd:this._onLoadingEnd.bind(this),onPlay:this._onPlay.bind(this),onPause:this._onPause.bind(this),onError:this._showError.bind(this),onLongLoading:this._showLoader.bind(this),onAutoPlayFail:this._onAutoPlayFail.bind(this)};if("live"===t)this.story=new Le(e,o,this.wrapEl);else{"video"===t?(this.story=new Be(e,o),s&&this.opts.restoreAudioPlay(),Object(G.addClass)(this.wrapEl,"video")):(this.story=new Te(e,o),this.opts.restoreAudioPlay(),Object(G.removeClass)(this.wrapEl,"video"));var a=this.story.getDate();e.isPromo?a=e.promoCaption:e.isAds&&(a=Object(Ne.getLang)("stories_is_ad")),val(this.descEl,a),this.fillTimeLine()}"live"!==t&&"video"!==t||y()>0&&this.opts.onVideoPlay();this.opts.onStartStory(),Object(G.toggleClass)(this.wrapEl,"stories_can_comment",!0===e.can_comment),e.reply_to&&!this.hasSticker(I.storyReply)&&this.replyToWrap.appendChild(this._renderReplyTo()),this.story.isNarrativeMetaStory=e.isNarrativeMetaStory,this.story.isGroupsMetaStory=e.is_groups_meta_story,this.story.isAppsMetaStory=e.is_apps_meta_story,!this.data.author.can_follow||this.data.is_promo||this.isActiveLive()||this.authorButtons.appendChild(this._renderFollowButton()),this.data.author.id<0&&this.data.author.showPin&&!this.story.isGroupsMetaStory&&(this.pinButton=this._createPinButton(this.data.author.isOwnerPinned),this.authorButtons.appendChild(this.pinButton)),this._destroyFeedBackTT(),this.story.isNarrativeMetaStory||this.story.isGroupsMetaStory||this.story.isAppsMetaStory||(this.updateBottom(),this.contWrap.appendChild(this.story.render())),e.clickable_stickers&&(this.stickerLayers=i.render(r.createElement(Ee,{story:this.story,storyData:e,author:this.data.author,showMessage:this._showMessage.bind(this),playStory:this.playStory.bind(this),pauseStory:this.pauseStory.bind(this),hideFeedbackTooltip:this.hideFeedbackTooltip.bind(this),onModalShownChange:this._onModalsShownChange.bind(this),onMouseUpHandle:this._onMouseUpHandle.bind(this),onMouseDownHandle:this._onMouseDownHandle.bind(this),sendNavigationStatEvents:this.layer._sendNavigationStatEvents.bind(this.layer),list:this.layer.list,layerEl:this.layer.layerEl,el:this.contWrap}),this.contStickers)),this.story.data&&this.story.data.narrative&&this.story.data.narrative.is_cover&&(this.contWrap.appendChild(this.story.renderNarrativeCover()),Object(ke.addEvent)(Object(G.geByClass1)("stories_narrative_cover",this.contWrap),"click",e=>{this._showTooltip(e,this._createNarrativeTooltipLink())})),this.story.isNarrativeMetaStory&&!this.story.failed&&(re(Object(G.geByClass1)("stories_photo",this.contWrap)),re(Object(G.geByClass1)("stories_video",this.contWrap)),Object(G.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),this.contWrap.appendChild(this.story.renderNarrativeMetaStory()),this.story._onCanPlay()),this.story.isGroupsMetaStory&&!this.modalSettingsWrapperEl&&(Object(G.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),Object(G.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story_groups"),this.contWrap.appendChild(this.story.render()),this.authorButtons.appendChild(ce("div",{className:"stories_group_btn stories_group_btn_settings",onclick:()=>{this.layer._sendNavigationStatEvents("set_group_view"),this.pauseStory(),this.getStoriesSettings(e=>{this.showSettingsModal(e)})}})),this.authorButtons.appendChild(ce("div",{className:"stories_groups_settings_text stories_groups_settings_text_hide",innerHTML:Object(Ne.getLang)("stories_groups_grid_title")})),re(Object(G.geByClass1)("stories_photo",this.contWrap)),re(Object(G.geByClass1)("stories_video",this.contWrap)),this.contWrap.appendChild(this.story.renderGroupsMetaStory()),this.modalSettingsWrapperEl=ce("div",{className:"stories_meta_settings_wrapper"}),this.contWrap.appendChild(this.modalSettingsWrapperEl)),this.data.is_apps&&(this.story.isAppsMetaStory?(Object(G.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),Object(G.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story_apps"),this.contWrap.appendChild(this.story.render()),this.authorButtons.appendChild(ce("div",{className:"stories_groups_settings_text stories_groups_settings_text_hide",innerHTML:Object(Ne.getLang)("stories_groups_grid_title")})),Object(G.setStyle)(Object(G.geByClass1)("stories_preview",this.contWrap),{backgroundImage:""}),re(Object(G.geByClass1)("stories_photo",this.contWrap)),re(Object(G.geByClass1)("stories_video",this.contWrap)),this.contWrap.appendChild(this.story.renderAppsMetaStory())):(Object(G.removeClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),Object(G.removeClass)(this.contWrap,"stories_item_cont_wrap_meta_story_apps")))}toggleCurrentOwnerPin(){if(this.pinButton){var e=hasClass(this.pinButton,"stories_group_btn_unpin");Object(G.toggleClass)(this.pinButton,"stories_group_btn_unpin",!e),this.data.author.isOwnerPinned=!e,ajax.post("al_stories.php",{act:"toggle_pin",owner_id:this.getOwnerId(),need_pin:intval(!e),hash:this.getPinHash()},{onFail:()=>{this.data.author.isOwnerPinned=e,Object(G.toggleClass)(this.pinButton,"stories_group_btn_unpin",e)}})}}getStoriesSettings(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{},t=document.querySelector("#box_layer_wrap"),s=document.querySelector("#box_loader"),r=isVisible(t);boxRefreshCoords(s),show(s),r||show(t),ajax.post("al_stories.php",{act:"get_feed_settings",hash:this.getGetGroupsSettingsHash()},{onDone:t=>{e(t)},onFail:e=>{this._showMessage(e)},hideProgress:()=>{hide(s),r||hide(t)}})}showSettingsModal(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.modalSettingsWrapperEl){var t=e.groups_info,s=e.put_groups_back;this.isModalShown=!0,i.render(r.createElement(Ge,{groups:t,putGroupsBack:s,onClose:this.hideSettingsModal.bind(this),sendNavigationStatEvents:this.layer._sendNavigationStatEvents.bind(this.layer),className:"stories_meta_settings",showMessage:this._showMessage.bind(this),hash:this.getSaveGroupsSettingsHash()}),this.modalSettingsWrapperEl)}}hideSettingsModal(){this.modalSettingsWrapperEl&&(this.isModalShown=!1,i.unmountComponentAtNode(this.modalSettingsWrapperEl),setTimeout(()=>{this.playStory()}))}hasSticker(e){var t=this.getCurStoryData();if(!t)return!1;var s=(t.clickable_stickers||{}).stickers;return!(!s||!isArray(s))&&s.some(t=>t.type===e)}_createNarrativeTooltipLink(){return ce("div",{className:"StoriesTooltip__link",innerHTML:Object(Ne.getLang)("stories_narrative_show"),onclick:()=>{this._hideTooltip(!0),showNarrative(`${this.story.data.narrative.owner_id}_${this.story.data.narrative.id}`,{isOpenNarrativeFromFeed:!0,source:"narrative_story"})}})}isTooltipOpened(){return this.tooltip||this.stickerLayers&&this.stickerLayers.isShownTooltip()}_showTooltip(e,t){if(this.isTooltipOpened())this._hideTooltip();else{this.tooltip=ce("div",{className:"StoriesTooltip"},{top:0,left:0}),this.tooltip.appendChild(t),this.layer.layerEl.appendChild(this.tooltip);var s=e.clientX,r=void 0===s?0:s,i=e.clientY,o=void 0===i?0:i;Object(G.setStyle)(this.tooltip,{top:o,left:r}),this.pauseStory()}}_hideTooltip(e){this.isTooltipOpened()&&(this.stickerLayers&&this.stickerLayers.hideTooltip(),this.tooltip&&(this.layer.layerEl.removeChild(this.tooltip),delete this.tooltip),e||this.playStory())}getReplies(){return this.story.getReplies()}getViews(){return this.story.getViews()}indexToUnread(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.data.items,s=0;for(var r in t)if(t[r].unread&&!this.layer._hasContext("all")){s=intval(r);break}if(e)return s;this.index=s,this._setPreview()}indexToStoryById(e){var t=this.data.items,s=-1;for(var r in t)if(t[r].raw_id===e){s=intval(r);break}this.layer._hasContext("all")&&(s=0),s>-1?(this.index=s,this._setPreview()):this.indexToUnread()}fillTimeLine(){var e=this.timeLineEl;if(e)for(var t=0;t<e.children.length;t++){var s=Object(G.geByClass1)("stories_time_line_item_cont_active",e.children[t]);t===this.index&&(this.currentTimeLineEl=s);var r=t<this.index?100:0;Object(G.setStyle)(s,"transform","translateX("+r+"%)")}}_destroyStory(){if(this.story){this.updateBottom(!0),window.tooltips&&tooltips.hideAll(),this._hideTooltip(),this._resetErrors(),this._destroyFeedBackTT(),this._closeFeatureTooltip(!1),this.story.pause(),Object(G.removeClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),re(Object(G.geByClass1)("MetaStory",this.contWrap)),Object(G.removeClass)("stories_item_cont_wrap_meta_story_groups",this.contWrap),Object(G.removeClass)(this.contWrap,"stories_narrative_cover_blur"),re(Object(G.geByClass1)("stories_narrative_cover",this.contWrap)),Object(ke.removeEvent)(Object(G.geByClass1)("stories_narrative_cover",this.contWrap)),Object(ke.removeEvent)(window,"resize",this._onResizeHandle);var e=this.getCurStoryData();e&&e.clickable_stickers&&(i.unmountComponentAtNode(this.contStickers),delete this.stickerLayers),e&&e.is_groups_meta_story&&this.modalSettingsWrapperEl&&delete this.modalSettingsWrapperEl,cancelAnimationFrame(this.timeLineAnim);try{this.contWrap.removeChild(this.story.getContainer()),this.story.destroy()}catch(e){}this._replyHideEnd(),Object(ke.removeEvent)(this.pinButton),Object(ke.removeEvent)(this.followBtn),val(this.authorButtons,""),Object(ke.removeEvent)(this.answersEl),Object(ke.removeEvent)(Object(G.geByClass1)("stories_reply_to",this.replyToWrap)),val(this.replyToWrap,""),this.hideInlineLoader(),delete this.story}}_timeLineUpdate(){var e=this.story;if(e&&!e.isPaused()&&!this.isActiveLive()){var t=e.getCurrentTime(),s=e.getDuration(),r=Math.max(0,Math.min(100,t/s*100));Object(G.setStyle)(this.currentTimeLineEl,"transform","translateX("+r+"%) translateZ(0)"),r<100?this.timeLineAnim=requestAnimationFrame(this._timeLineUpdate.bind(this)):this._onPlayEnd(!0)}}_onLoadingStart(){this._loadingStartTime=new Date}_onLoadingEnd(){this._loadingStartTime&&(this.loadingTime=Date.now()-this._loadingStartTime,this.layer._sendViewerStartTime(this.getRawId(),this.loadingTime),this._loadingStartTime=0)}_onPlay(){this._resetErrors(),this._stopLoader(),this._timeLineUpdate(),this.preloadNextStory(),this.opts.onPlayStory(),Object(G.removeClass)(this.wrapEl,"animate_story"),Object(G.removeClass)(this.wrapEl,"autoplay_failed"),this.data.is_groups||this.isAppsMetaStoryActive()||(this.data.items[this.getIndex()].unread=!1),this._updateFeedStoryPreview()}_onPause(){cancelAnimationFrame(this.timeLineAnim)}_onPlayEnd(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.nextStory(e)}nextStory(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isLocked()){var t=this.data.items;e||this.layer._sendNavigationStatEvents("go_to_next_story_tap");var s=this.index+1;s<t.length?(e&&this.layer._sendNavigationStatEvents("go_to_next_story_auto_by_time"),this.changeStory(s)):(this.opts.onStoriesEnd(e),this._destroyStory())}}prevStory(){if(this._feedbackTTShown&&this.hideFeedbackTooltip(),!this.isLocked()){this.layer._sendNavigationStatEvents("go_to_previous_story");var e=this.index-1;e>=0?this.changeStory(e):(this._destroyStory(),this.opts.playPrevOwner())}}getOffsetLeft(){return this.wrapEl.offsetLeft+this.wrapEl.offsetWidth/2}getWidth(){return this.wrapEl.offsetWidth}removeStoryBox(){this.pauseStory(),showFastBox({title:Object(Ne.getLang)("global_warning"),onHide:()=>{this.playStory()}},Object(Ne.getLang)("stories_remove_warning"),Object(Ne.getLang)("stories_remove_confirm"),this.removeStory.bind(this),Object(Ne.getLang)("global_cancel"))}removeStory(e){this.pauseStory();var t=this.getIndex(),s=this.getRawId();ajax.post("al_stories.php",{act:"remove_story",story_raw:s,hash:this.data.remove_hash,moder_remove_hash:this.data.moder_remove_hash},{onDone:e=>{this.layer._sendNavigationStatEvents("delete"),window.cur.module===A&&window.GeStories.storyDidRemove(s,e),Object(Me.curBox)().hide(),this._popStoryAndClearList(t)},showProgress:xe.lockButton.pbind(e),hideProgress:xe.unlockButton.pbind(e)})}removeNarrativeBox(){this.pauseStory(),showFastBox({title:Object(Ne.getLang)("global_warning"),onHide:()=>{this.playStory()}},Object(Ne.getLang)("stories_narrative_remove_warning"),Object(Ne.getLang)("stories_remove_confirm"),this.removeNarrative.bind(this),Object(Ne.getLang)("global_cancel"))}removeNarrative(e){this.pauseStory();var t=this.getCurStoryData().narrative,s=t.raw_id;ajax.post("al_stories.php",{act:"remove_narrative",narrative_raw:s,hash:this.data.remove_hash,moder_remove_hash:this.data.moder_remove_hash},{onDone:()=>{Object(Me.curBox)().hide(),this._popCoverAndCleanNarrativeList(t)},showProgress:xe.lockButton.pbind(e),hideProgress:xe.unlockButton.pbind(e)})}_popCoverAndCleanNarrativeList(e){if(e.is_cover)this._popStoryAndClearList(this.getIndex());else{this.opts.removeList(),this._remove(!1,(()=>{cur.storyLayer.activeStory._popStoryAndClearList(cur.storyLayer.activeStory.getIndex())}).bind(this))}}_sendNarrativeBookmarkButtonDidPress(){var e=this.getCurStoryData().narrative;this.updateBottom=this.updateBottom.bind(this),ajax.post("al_bookmarks.php",{act:"bookmark",owner_id:e.owner_id,object_id:e.id,type:"narrative",state:e.is_bookmarked?1:0,hash:e.bookmark_hash,ref:cur.module},{onDone:t=>{showDoneBox(t||Object(Ne.getLang)("stories_narrative_bookmark_deleted"),{className:"stories_done_msg"}),e.is_bookmarked=!e.is_bookmarked,this.updateBottom()}})}_sendNarrativeEditButtonDidPress(){var e=this.getCurStoryData().narrative;window.open(`https://${location.hostname}${this.data.author.href}?act=narrative_edit&nid=${e.id}`)}_popStoryAndClearList(e){this._removeStoryFromMemoryByIndex(e),0===this.data.items.length&&O(this.getOwnerId())}_removeStoryFromMemoryByIndex(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.data.items.splice(e,1);var s=this.data.items.length;s?(this._initTimeLine(),s>e?this.isActive&&this.playStory(!0):this.isActive&&this.nextStory()):this._remove(t)}_remove(e,t){this.opts.onStoryRemoved(e,t)}shareBox(){var e,t=this.getCurStoryData().narrative;e=t?`narrative${t.raw_id}`:`story${this.story.getId()}`,this.pauseStory(),Object(ye.showBox)("like.php",{act:"publish_box",object:e,from:"wkview"},{onDone:()=>{this.autoResumeStory()},params:{onHide:()=>{this.autoResumeStory()}}})}_onAnswerSend(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this._getSendText();if((i||t.length)&&this.story)if(this.isActiveLive())this.story.sendMessage(i,e);else{var o=this.story.data.narrative;o?t.push(["narrative",o.raw_id]):t.push(["story",this.story.getId()]),ajax.post("al_im.php",Object.assign({act:"a_send",msg:i,hash:this.data.send_hash,media:Object(Ae.convertAttachesToPhpMedia)(t),entrypoint:"stories_comment",to:this.getOwnerId()},s),{onDone:()=>{this._onAnswerSent(e,s,r)},onFail:e=>(this._showMessage(e),!0),showProgress:()=>{val(this.sendFormButton,this._getLoaderHtml()),Object(G.addClass)(this.sendFormButton,"sending")},hideProgress:()=>{val(this.sendFormButton,""),Object(G.removeClass)(this.sendFormButton,"sending")}})}}_onAnswerSent(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.isActiveLive()){this._showMessage(Object(Ne.getLang)("stories_answer_sent")).then(()=>{this.playStory()});var r=t.sticker_referrer||"",i={},o="";"story_keyboard"===r?o="sticker_keyboard_send":r.startsWith("story_suggestion_")?o="sticker_suggestion_send":"story_reaction"===r?(o="sticker_reaction_send",i.reaction_name=s.reactionName):o="comment_send",this.layer._sendNavigationStatEvents(o,!0,i)}val(Object(G.geByClass1)("stories_send_form_text",this.wrapEl),""),this._blurSendForm(),this.updateFeedbackTTPos(),this.pauseStory(),e&&e()}_onSendFormFocus(){this.pauseStory(),this.isActiveLive()||this._toggleSendFormOverlay(!0),this._hideTooltip(!0),this.hideFeedbackTooltip(),cancelStackPush("stories_form_focus",()=>{Emoji.shown||(this._resetFendForm(),this._blurSendForm()),this.updateFeedbackTTPos()})}_toggleSendFormOverlay(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(G.toggleClass)(this.storySendFormOverlay,"stories_bottom_overlay_available",this.isSendFormActive=e)}_blurSendForm(){var e=Object(G.geByClass1)("stories_send_form_text",this.wrapEl);e&&e.blur()}_getSendText(){var e=Emoji.editableVal(Object(G.geByClass1)("stories_send_form_text",this.wrapEl));return trim(e)}_onSendFormBlur(){var e=this._getSendText();this.isActiveLive()||this._toggleSendFormOverlay(!1),e||this._resetFendForm()}_onSendFormKeyUp(){this.updateFeedbackTTPos()}_unlockSendForm(){this.isSendFormActive&&(this.isSendFormActive=!1)}_resetFendForm(){this._unlockSendForm(),this.playStory(),val(Object(G.geByClass1)("stories_send_form_text",this.wrapEl),"")}_emojiOnKeyAction(){this._getSendText()?Object(G.addClass)(this.sendFormButton,"active"):Object(G.removeClass)(this.sendFormButton,"active")}_getLoaderHtml(){return'<svg class="stories_view_loader_circular" viewBox="25 25 50 50">\n      <circle class="stories_view_loader_circular_path" cx="50" cy="50" r="20" fill="none" stroke-width="4" stroke-miterlimit="10"/>\n    </svg>'}preloadNextStory(e){if(e=isUndefined(e)?this.index+1:e,!this.preloadedStories[e]){var t=this.data.items[e];if(t){this.preloadedStories[e]=!0;var s=t[t.type+"_url"];s&&("video"===t.type?m(s):_(s))}}}_addToBlacklist(){cur.storyLayer&&cur.storyLayer.pauseStory(),showFastBox({title:Object(Ne.getLang)("stories_add_blacklist_title"),onHide:function(){cur.storyLayer&&cur.storyLayer.playStory()}},this.getOwnerId()<0?Object(Ne.getLang)("stories_add_blacklist_message_group"):Object(Ne.getLang)("stories_add_blacklist_message"),Object(Ne.getLang)("stories_add_blacklist_button"),this._doAddToBlacklist.bind(this),Object(Ne.getLang)("global_cancel"))}_doAddToBlacklist(e){ajax.post("al_stories.php",{act:"blacklist_add",owner_id:this.getOwnerId(),hash:this.data.blacklist_hash,source_story:this.getRawId()},{onDone:()=>{this.data.can_blacklist=!1,this.layer._sendNavigationStatEvents("hide_from_stories"),Object(Me.curBox)().hide(),this.opts.removeList(),this._remove()},showProgress:xe.lockButton.pbind(e),hideProgress:xe.unlockButton.pbind(e)})}_resetErrors(){var e=Object(G.geByClass1)("stories_error_wrap",this.contWrap);e&&(Object(ke.removeEvent)(Object(G.geByClass1)("stories_error_button",e)),re(e)),Object(G.removeClass)(this.wrapEl,"failed"),Object(G.removeClass)(this.wrapEl,"fatal_error")}_showError(e){if(this.contWrap){var t,s,r=e;switch(e){case"load":t=Object(Ne.getLang)("stories_error_cant_load"),s=ce("div",{className:"stories_error_button",innerHTML:Object(Ne.getLang)("stories_try_again")}),Object(ke.addEvent)(s,"click",()=>{this._destroyStory(),this.playStory()});break;case"expired":t=Object(Ne.getLang)("stories_error_expired");break;case"deleted":t=Object(Ne.getLang)("stories_error_deleted");break;case"private":t=Object(Ne.getLang)("stories_error_private");break;case"deleted-narrative":t=Object(Ne.getLang)("stories_error_deleted_narrative");break;case"private-narrative":t=Object(Ne.getLang)("stories_error_private_narrative");break;default:t=Object(Ne.getLang)("global_unknown_error")}this._resetErrors(),this._stopLoader();var i=ce("div",{className:"stories_error_wrap"}),o=ce("div",{className:"stories_error"}),a=ce("div",{className:"stories_error_cont"});o.appendChild(a),a.appendChild(ce("div",{className:"stories_error_icon "+r})),a.appendChild(ce("div",{className:"stories_error_caption",innerHTML:t})),s&&a.appendChild(s),i.appendChild(o),this.contWrap.appendChild(i),Object(G.addClass)(this.wrapEl,"failed"),inArray(e,["expired","deleted","private","deleted-narrative","private-narrative"])&&Object(G.addClass)(this.wrapEl,"fatal_error")}}_stopLoader(){setTimeout(()=>{re(Object(G.geByClass1)("stories_loader",this.contWrap))},0)}_showLoader(){if(this._stopLoader(),this.isActive&&(!this.isLoaded()||this.isPaused())&&this.contWrap){var e=ce("div",{className:"stories_loader",innerHTML:this._getLoaderHtml()});this.contWrap.appendChild(e)}}_onFollowBtnClick(){var e,t;(this.pauseStory(),this.followBtnLock)||(this.followBtnLock=!0,this.data.author.id>0?(t="al_friends",e=this.data.author.can_follow?"add":"remove"):(t="al_groups",e=this.data.author.can_follow?"a_enter":"a_leave"),ajax.post(`${t}.php`,{act:e,mid:this.getOwnerId(),gid:-this.getOwnerId(),hash:this.data.author.hash,from:"stories"},{onDone:()=>{this.data.author.can_follow&&this._sendStatEvent("follow"),this.data.author.can_follow=!this.data.author.can_follow,Object(G.toggleClass)(this.followBtn,"followed",!this.data.author.can_follow),this._showMessage(Object(Ne.getLang)(this.data.author.can_follow?"stories_unfollowed":"stories_followed")).then(()=>this.playStory()),window.tooltips&&tooltips.destroy(this.followBtn),triggerEvent(this.followBtn,"mouseover")},showProgress:()=>this.showInlineLoader(),hideProgress:()=>{this.hideInlineLoader(),this.followBtnLock=!1}}))}_getDimensions(){var e=Ue(getSize(this.wrapEl),2),t=e[0],s=e[1],r=Ue(getXY(this.wrapEl),2),i=r[0];return{width:t,height:s,top:r[1]-scrollGetY(),left:i-scrollGetX()}}markAsActive(){this.isActive=!0,Object(G.addClass)(this.wrapEl,"animate_story")}_renderReplyTo(){var e=this.getCurStoryData().reply_to,t=e.list,s=e.photo_url,r=e.name,i=e.can_view_deleted,o=e.is_deleted,a=e.is_private,n=e.is_expired,l=e.raw_id,c=Object(G.se)(`<div class="stories_reply_to" style="background-image: url(${s})">\n  <div class="stories_reply_to_error_msg"></div>\n  <div class="stories_reply_to_owner_name_wrap">\n    <div class="stories_reply_to_owner_name">${r}</div>\n  </div>\n</div>`);if(Object(ke.addEvent)(c,"click",()=>{this.layer._sendNavigationStatEvents("open_parent_story");var e=k();S.length>1&&e.getStoryRaw()===l?cancelStackPop():showStory(t,{fromEl:c,source:"reply_story"})}),i)return c;var d=!1;return o?(Object(G.addClass)(c,"deleted"),d=Object(Ne.getLang)("stories_deleted_story")):a?(Object(G.addClass)(c,"private"),d=Object(Ne.getLang)("stories_private_story")):n&&(Object(G.addClass)(c,"expired"),d=Object(Ne.getLang)("stories_expired_story")),d&&(val(Object(G.geByClass1)("stories_reply_to_error_msg",c),d),re(Object(G.geByClass1)("stories_reply_to_owner_name_wrap",c))),c}sendMask(){if(this.layer._sendNavigationStatEvents("click_to_mask"),!this._maskSending){this._maskSending=!0,this.pauseStory();var e=this.getCurStoryData();ajax.post("al_stories.php",{act:"send_mask",mask_id:e.mask_id,hash:this.data.send_mask_hash},{onDone:(e,t,s,r)=>{"cant_send"===e?showFastBox({title:t,width:460,onHide:()=>{this.playStory()}},s,r):this._showMessage(Object(Ne.getLang)("stories_mask_sent")).then(()=>this.playStory())},showProgress:()=>this.showInlineLoader(),hideProgress:()=>{this._maskSending=!1,this.hideInlineLoader()}})}}_getFeedbackTTElem(){return Object(G.geByClass1)("stories_answers_tt_arrow",this.wrapEl)||Object(G.geByClass1)("_views_button",this.wrapEl)}_destroyFeedBackTT(){var e=this._getFeedbackTTElem();e&&e.tt&&e.tt.destroy(),this._feedbackTTShown=!1,this._feedbackTTLoaded=!1}hideFeedbackTooltip(){if(this._feedbackTTShown){var e=this._getFeedbackTTElem();e&&e.tt&&(e.tt.hide(),this._feedbackTTShown=!1,this.autoResumeStory(),cancelStackPop())}}updateFeedbackTTArrow(){var e=this._getFeedbackTTElem();if(hasClass(e,"stories_answers_tt_arrow")){var t=Object(G.geByClass1)("stories_feedback_tt_arrow",this.wrapEl),s=e.offsetLeft+getSize(e)[0]/2-getSize(t)[0]/2-1;Object(G.setStyle)(t,"left",`${s}px`)}}showFeedbackTooltip(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._hideTooltip();var t=this._getFeedbackTTElem();if(t)if(this._feedbackTTShown&&!0!==e)cancelStackPop();else{this.pauseStory(),this._feedbackTTShown||cancelStackPush("stories_feedback_tt",()=>{this.hideFeedbackTooltip(!1,!0)}),this._feedbackTTLoaded&&(this._feedbackTTShown=!0),this.layer._sendNavigationStatEvents("open_replies_list");var s=8;if(hasClass(t,"stories_answers_tt_arrow")){s=getSize(domPN(t))[0]-39}showTooltip(t,{className:"stories_feedback_tt",forcetoup:!0,nohide:!0,forceNoHide:!0,nohideover:!0,content:`<div class="stories_feedback_content">\n          <div class="stories_feedback_loader">${this._getLoaderHtml()}</div>\n        </div>\n        <div class="stories_feedback_headers"></div>\n        <div class="stories_feedback_close"></div>`,slide:15,zIndex:100,shift:[s,19,0],appendEl:Object(G.geByClass1)("stories_bottom_wrap",this.wrapEl),onHide:()=>{this._feedbackTTShown=!1},onShowStart:()=>{this.isActive&&(this._feedbackTTShown=!0,this._feedbackTTLoaded?this._feedbackRequestEnd&&(this.feedbackScroll.update(),this._feedbackTooltipInitHeaders(),tooltips.rePositionTT(t.tt),this._onFeedbackScroll(),setTimeout(()=>tooltips.rePositionTT(t.tt),200)):(Object(G.geByClass1)("stories_feedback_tt",this.wrapEl).appendChild(Object(G.se)('<div class="stories_feedback_tt_arrow"></div>')),this._feedbackTTLoaded=!0,this._feedbackRequestEnd=!1,this._feedbackTooltipHeadersInited=!1,Object(ke.addEvent)(Object(G.geByClass1)("stories_feedback_close",this.wrapEl),"click",()=>this.hideFeedbackTooltip()),setTimeout(()=>{ajax.post("al_stories.php",{act:"feedback",story_raw:this.getRawId()},{onDone:(e,s,r,i,o,a)=>{if(this.isActive){this.story.setViews(i),this.story.setReplies(o),this._feedbackRequestEnd=!0;var n=Object(G.geByClass1)("stories_feedback_content",this.wrapEl);val(n,e),this.updateQuestions(a,this._showMessage.bind(this),this.getCurStoryData().small_preview),this.feedbackScroll=new uiScroll(Object(G.geByClass1)("stories_feedback_content",this.wrapEl),{theme:"default emoji no_transition",onmore:()=>this._onMoreFeedBack(),onscroll:()=>this._onFeedbackScroll()}),this.feedbackScroll.scrollTop(0),Object(G.addClass)(this.feedbackScroll.container,"ui_scroll_shadow_bottom_visible"),Object(G.geByClass1)("ui_scroll_overflow",this.feedbackScroll.container).appendChild(ce("div",{className:"ui_scroll_shadow_bottom"})),this.feedbackNextFrom=s,t.tt.shown&&this._feedbackTooltipInitHeaders(),this.updateBottom(),this.updateFeedbackTTPos(),cur=Object(W.extend)(cur,r),this.updateFeedbackTTArrow()}}})},200)),this.updateFeedbackTTArrow())}})}}updateQuestions(e,t,s){var o=Object(G.ge)("stories_feedback_questions");Object(G.removeClass)(Object(G.geByClass1)("_views_button",this.wrapEl),"stories_button_new_questions"),o&&i.render(r.createElement(pe,{showMessage:t,storyUrl:s,questions:e,sendNavigationStatEvents:this.layer._sendNavigationStatEvents.bind(this.layer),destroyCallback:this.destroyFeedbackQuestions.bind(this)}),o)}destroyFeedbackQuestions(){var e=Object(G.ge)("stories_feedback_questions");i.unmountComponentAtNode(e),re(e),re(Object(G.ge)("stories_feedback_title_questions")),this.feedbackTooltipReInitHeaders(),this.feedbackScroll.scrollTop(0),tooltips.rePositionTT(this._getFeedbackTTElem().tt)}_onModalsShownChange(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isModalShown=e}updateFeedbackTTPos(){var e=this._getFeedbackTTElem();this._feedbackTTShown&&e&&e.tt&&tooltips.rePositionTT(e.tt)}_feedbackTooltipInitHeaders(){if(!this._feedbackTooltipHeadersInited){this._feedbackTooltipHeadersInited=!0;var e=Object(G.geByClass1)("stories_feedback_content",this.wrapEl),t=Object(G.geByClass1)("stories_feedback_headers",this.wrapEl),s=Object(G.geByClass)("stories_feedback_title",e);show(s[0]),this.feedbackHeaders=[];for(var r=s.length+1,i=0;i<s.length;i++){var o=s[i],a=t.appendChild(ce("div",{className:"stories_feedback_title",innerHTML:val(o)},{top:o.offsetTop,zIndex:r-i}));this.feedbackHeaders.push({top:o.offsetTop,height:o.offsetHeight,el:a})}Object(G.setStyle)(e,"margin-top",s[0].offsetHeight),hide(s[0])}}feedbackTooltipReInitHeaders(){this._feedbackTooltipHeadersInited&&(this._feedbackTooltipHeadersInited=!1,this.feedbackHeaders=[],val(Object(G.geByClass1)("stories_feedback_headers",this.wrapEl),""),this._feedbackTooltipInitHeaders())}_onFeedbackScroll(){if(this._feedbackTooltipHeadersInited)for(var e=this.feedbackScroll.data.scrollTop,t=!1,s=0,r=this.feedbackHeaders.length-1;r>=0;r--){var i=this.feedbackHeaders[r],o=i.top,a=i.height,n=i.el,l=o,c=e;t&&(c-=s-(l+=a));var d=c>=o-a;n.classList.toggle("active",!t&&d&&c>0),d&&(t=!0),s=o;var h=-Math.min(c,l);n.style.transform=`translateY(${h}px)`}}_onMoreFeedBack(){!this.feedbackLoadingMore&&this.feedbackNextFrom&&(this.feedbackLoadingMore=!0,ajax.post("al_stories.php",{act:"feedback",story_raw:this.getRawId(),offset:this.feedbackNextFrom},{onDone:(e,t)=>{this.feedbackNextFrom=t,t&&(this.feedbackLoadingMore=!1);for(var s,r=Object(G.geByClass1)("stories_feedback_views",this.wrapEl),i=ce("div",{innerHTML:e});s=i.firstChild;)r.appendChild(s)}}))}showInlineLoader(){show(this.inlineLoader)}hideInlineLoader(){hide(this.inlineLoader)}volumeUpdate(){this.story&&this.story.volumeUpdate&&this.story.volumeUpdate()}_onAutoPlayFail(){Object(G.addClass)(this.wrapEl,"autoplay_failed")}_hideReply(){showFastBox({title:Object(Ne.getLang)("global_warning"),onHide:()=>{this.autoResumeStory()}},Object(Ne.getLang)("stories_hide_reply_warning"),Object(Ne.getLang)("global_continue"),this._doHideReply.bind(this),Object(Ne.getLang)("global_cancel"))}_doHideReply(){this.pauseStory(),Object(G.addClass)(this.wrapEl,"hiding_reply"),Object(Me.curBox)().hide();var e=this.getIndex(),t=this.data.author.gender,s=Object(G.se)(`<div class="stories_hide_reply_wrap loading">\n  <div class="stories_inline_loader">${getProgressHtml()}</div>\n  <div class="stories_hide_reply_cont">\n    <div class="stories_hide_reply_icon"></div>\n    <div class="stories_hide_reply_info">${Object(Ne.getLang)("stories_reply_hidden")}</div>\n    <div class="stories_hide_reply_continue_button _stories_reply_continue">${Object(Ne.getLang)("stories_hide_reply_continue")}</div>\n  </div>\n  <div class="stories_hide_reply_other_actions">\n    <div class="stories_hide_reply_other_action _stories_hide_replies">${langSex(t,window.lang.stories_hide_all_replies)}</div>\n    <div></div>\n    <div class="stories_hide_reply_other_action _stories_reply_ban">${Object(Ne.getLang)("stories_reply_add_to_blacklist")}</div>\n  </div>\n</div>`);Object(ke.addEvent)(Object(G.geByClass1)("_stories_reply_restore",s),"click",this._restoreReply.bind(this)),Object(ke.addEvent)(Object(G.geByClass1)("_stories_reply_continue",s),"click",()=>this._replyHideEnd(e)),Object(ke.addEvent)(Object(G.geByClass1)("_stories_hide_replies",s),"click",this._hideAllReplies.bind(this)),Object(ke.addEvent)(Object(G.geByClass1)("_stories_reply_ban",s),"click",this._ban.bind(this)),this.contWrap.appendChild(s),ajax.post("al_stories.php",{act:"hide_reply",raw_id:this.getRawId(),hash:this.data.reply_hide_hash},{onDone:()=>{this.opts.removeList(),cur.needUpdateFeedStories=!0,Object(G.removeClass)(s,"loading")},onFail:()=>{this._resetReplyHide(),this.playStory()}})}_restoreReply(e){cancelEvent(e);var t=Object(G.geByClass1)("stories_hide_reply_wrap",this.contWrap);ajax.post("al_stories.php",{act:"restore_reply",raw_id:this.getRawId(),hash:this.data.reply_hide_hash},{onDone:()=>{this._resetReplyHide(),this.playStory()},showProgress:()=>Object(G.addClass)(t,"loading"),hideProgress:()=>Object(G.removeClass)(t,"loading")})}_resetReplyHide(){re(Object(G.geByClass1)("stories_hide_reply_wrap",this.contWrap)),Object(G.removeClass)(this.wrapEl,"hiding_reply")}_hideAllReplies(){var e=this.data.author.first_name_gen;showFastBox({title:Object(Ne.getLang)("global_warning")},Object(Ne.getLang)("stories_delete_all_replies_confirm").replace("{name}",e),Object(Ne.getLang)("global_continue"),this._doHideAllReplies.bind(this),Object(Ne.getLang)("global_cancel"))}_doHideAllReplies(e){ajax.post("al_stories.php",{act:"hide_all_replies",owner_id:this.getOwnerId(),hash:this.data.reply_hide_hash},{onDone:()=>{Object(Me.curBox)().hide(),this.opts.removeList(),this.data.items=[];var e=Object(G.geByClass1)("_stories_hide_replies",this.contWrap);val(e,Object(Ne.getLang)("stories_all_replies_hidden")),Object(G.addClass)(e,"disabled")},showProgress:xe.lockButton.pbind(e),hideProgress:xe.unlockButton.pbind(e)})}_ban(){var e=this.data.author.first_name_gen;showFastBox({title:Object(Ne.getLang)("global_warning")},Object(Ne.getLang)("stories_ban_confirm").replace("{name}",e),Object(Ne.getLang)("global_continue"),this._doBan.bind(this),Object(Ne.getLang)("global_cancel"))}_doBan(e){ajax.post("al_stories.php",{act:"ban",owner_id:this.getOwnerId(),hash:this.data.stories_ban_hash},{onDone:()=>{Object(Me.curBox)().hide(),this.opts.removeList(),this.data.items=[];var e=Object(G.geByClass1)("_stories_reply_ban",this.contWrap);val(e,Object(Ne.getLang)("stories_banned")),Object(G.addClass)(e,"disabled")},showProgress:xe.lockButton.pbind(e),hideProgress:xe.unlockButton.pbind(e)})}_replyHideEnd(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;Object(G.geByClass1)("stories_hide_reply_wrap",this.contWrap)&&(this.data.items.length<=1&&O(this.getOwnerId()),this._resetReplyHide(),this._removeStoryFromMemoryByIndex(e||this.getIndex(),!isNumeric(e)))}_feedbackRemoveReplyFromDom(e){var t=Object(G.geByClass1)("stories_feedback_content",this.wrapEl);if(t){var s=t.querySelector(`#feed_story_${e}`);s&&Object(G.addClass)(s,"removed")}}onReplyDeleted(e){this._feedbackRemoveReplyFromDom(e)}_updateFeedStoryPreview(){var e=Object(G.ge)("feed_story_"+this.layer.getBlockKey(this.data));if(e&&!e.classList.contains("stories_feed_reply_item")&&e.classList.contains("stories_feed_preview_item")){var t=this.indexToUnread(!0),s=this.data.items[t];s&&s.small_preview&&Object(G.setStyle)(e,"background-image",`url(${s.small_preview})`)}}_sendStatEvent(e){var t=this.getCurStoryData();ajax.post("al_stories.php",Object(W.extend)({act:"stat",source_story:this.getRawId()},t.stats[e]))}_sendStatStickerEvent(e,t){var s=this.getCurStoryData().clickable_stickers;ajax.post("al_stories.php",Object(W.extend)({act:"stickers_stat",story_raw_id:this.getRawId(),action:e,hash:s.hash},t))}report(){var e=this.getCurStoryData(),t="story";this.isActiveLive()?t="live":e.narrative&&(t="narrative");var s=Object(ye.showBox)("al_stories.php",{act:"report_box",type:t},{onDone:()=>{var e=Object(G.geByClass)("radiobtn","stories_report");radioBtns.stories_report={val:0,els:e}},params:{onClean:()=>{delete radioBtns.stories_report,this.playStory()}}});s.removeButtons(),s.addButton(Object(Ne.getLang)("box_send"),this._sendReportButtonDidPress.bind(this)),s.addButton(Object(Ne.getLang)("global_cancel"),!1,"no")}_sendReportButtonDidPress(e){var t,s,r=this.index,i=this.getCurStoryData(),o=i.narrative,a=i.report_hash,n="groups"===this.layer.list,l=!!o;l?(t=o.raw_id,s=o.report_hash):(t=this.getRawId(),s=a),ajax.post("al_stories.php",{act:"report",type:l?"narrative":"story",item_raw:t,reason:radioBtns.stories_report.val,hash:s},{onDone:()=>{Object(Me.curBox)().hide(),this.layer._sendNavigationStatEvents("claim"),n||l||this._popStoryAndClearList(r),showDoneBox(Object(Ne.getLang)("stories_report_sent"),{className:"stories_done_msg"})},showProgress:xe.lockButton.pbind(e),hideProgress:xe.unlockButton.pbind(e)})}onLiveEnded(e){this.isActiveLive()&&(this.data.items[this.index].can_share=!e,this.story.onLiveEnded(),this.updateBottom())}updateLiveViewersCount(e){val(this.descEl,e)}isAppsMetaStoryActive(){return!(!this.story||!this.story.isAppsMetaStory)}}var Ke=.563,ze=1.78,Qe=540,Xe=320,Ye="user_personal_card",Je="group_personal_card",Ze=s("Tn+0");function et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function tt(){var e=navigator.connection;if(!e)return"";var t=e.effectiveType,s=e.downlink;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return s>8?"wi-fi":"LTE"}return""}var st=[];var rt=[];function it(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class ot{constructor(e,t,s,r,i){this.queue=[],this.storiesToRead=[],this.storiesSkip=[];try{window.Videoview&&Videoview.togglePlay(!1)}catch(e){}this.initDOM(),this.show(),this._init(e,t,s,r),Object(G.addClass)(this.layerEl,"shown"),this._source=i.source,this._initViewerSource(),this._sendOpeningEvents(),i.isOpenNarrativeFromFeed&&(this.isOpenNarrativeFromFeed=i.isOpenNarrativeFromFeed)}_init(e,t,s,r){var i=it(e.split("&"),2),o=i[0],a=i[1],n=void 0===a?"":a,l=it(o.split("_"),2),c=l[0],d=l[1];this.storyRaw=o,this.storyOwner=c,this.storyId=d,this.blockKey=`${c}${n}`,this.list=t,this.storiesList=s,this.extra=this.parseExtra(r),this.initStories()}initStories(){return new Promise(e=>{this.storiesBlocks=this.storiesList.map(e=>this.getBlockKey(e));var t=!1,s=this.storiesBlocks.indexOf(this.blockKey);if(s>-1){var r=this.storiesList[s];t=r.items[r.items.length-1].unread}if(this.extra)switch(this.extra.context){case"new":t=!0;break;case"all":t=!1}t&&"replies"===this.list.substr(0,7)&&(t=!1);for(var i=0;i<this.storiesList.length;i++){var o=this.storiesList[i],a=o.items[o.items.length-1];o.is_narrative&&!a.isNarrativeMetaStory&&o.items.push({type:"photo",raw_id:a.raw_id,narrative:a.narrative,isNarrativeMetaStory:!0})}if(t){for(var n=[],l=0;l<this.storiesList.length;l++){var c=this.storiesList[l];(c.items[c.items.length-1].unread||0===l&&this._hasContext("new"))&&n.push(c)}n.length&&(this.storiesList=n,this.storiesBlocks=this.storiesList.map(e=>this.getBlockKey(e)))}this.renderedStories={};var d=this._renderStories().activeStory;this.scrollToStory(d,!0),1===this.storiesList.length&&Object(G.addClass)(this.stories,"one_story"),this._startFirstStory(d,this.extra.story_id),Object(G.addClass)(this.stories,"inited"),e()})}getBlockKey(e){return e.hasOwnProperty("data")&&(e=e.data),e.items&&e.items.length&&"live"===e.items[0].type?`${e.author.id}live`:e.narrative||e.is_narrative?`${e.author?e.author.id:e.narrative.owner_id}narrative${e.items?e.items[0].narrative.id:e.narrative.id}`:this.list.includes("place")?`${e.author.id}`+"place":`${e.author.id}`}_renderStories(){for(var e=[],t=0;t<this.storiesList.length;t++)this.storiesList[t]&&e.push(this.storiesList[t]);var s,r=this._getScreenStoriesCount(),i=this._getCurStoryPos(e.map(e=>this.getBlockKey(e))),o=Math.floor(r/2),a=e.slice(Math.max(0,i-o)).slice(0,r),n=a.map(e=>this.getBlockKey(e));for(var l in this.renderedStories)if(this.renderedStories.hasOwnProperty(l)){var c=this.renderedStories[l];-1===n.indexOf(l)&&(c.story.destroy(),delete this.renderedStories[l])}if(a.map((e,t)=>{var r=this.getBlockKey(e);if(!this.renderedStories[r]){var i=this.storiesBlocks.indexOf(r),a=e.author.id,n=new Ve(e,{id:t,layer:this,onSelect:this._onSelectStory.bind(this),onStoriesEnd:this._onStoriesEnd.bind(this,i),onStoryRemoved:(e,t)=>this._onStoryRemoved(a,i,e,t),playPrevOwner:this._playPrevOwner.bind(this,i),onPlayStory:this._onPlayStory.bind(this,i),onVideoPlay:this._onVideoPlay.bind(this),restoreAudioPlay:this._restoreAudioPlay.bind(this),onStartStory:this._onStartStory.bind(this),removeList:()=>Stories.removeList(this.list)});t<=o&&this.stories.children[t]?this.stories.insertBefore(n.render(),this.stories.children[t]):this.stories.appendChild(n.render()),this.renderedStories[r]={story:n,index:i},r===this.blockKey&&(s=n)}}),!s){var d=n[0];s=this.renderedStories[d].story}return{activeStory:s}}_sendOpeningEvents(){if(this._source){var e;switch(this._source){case"narrative_story":e="narrative_open_stories";break;case"narrative_snippet":case"narrative_link":e="narrative_open";break;case"narrative_recommendations":e="narrative_other"}if(e&&this._sendNavigationStatEvents(e,!1),"narrative_fave"===this._source){var t=this.activeStory.getCurStoryData();if(t&&t.narrative){var s=t.narrative,r=s.owner_id,i=s.id;statlogsValueEvent("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:r,item_id:i,time:window.getServerTime()})}}}}_destroyStories(){for(var e in this.renderedStories){if(this.renderedStories.hasOwnProperty(e))this.renderedStories[e].story.destroy()}}destroy(){clearTimeout(this.timer),clearTimeout(this.animationTimer),this._destroyStories(),this._onVideoEnd(),removeEvent(this.volumeControl),removeEvent(this.layerEl),delete this.activeStory,delete this.volumeControl,delete this.renderedStories;try{this.layerEl&&bodyNode.removeChild(this.layerEl)}catch(e){}delete cur.storyLayer}getList(){return"story"+this.activeStory.getRawId()+"/"+this.list}getStoryRaw(){return!!this.activeStory&&this.activeStory.getRawId()}initDOM(){this.layerEl=ce("div",{className:"stories_layer"});var e=ce("div",{className:"stories_layer_cont"});this.layerEl.appendChild(e),e.appendChild(this._renderBackButton()),e.appendChild(this._renderVolumeControl()),this._updateVolumeButton(),this.stories=ce("div",{id:"stories_list",className:"stories_list"}),e.appendChild(this.stories),e.appendChild(ce("div",{className:"stories_layer_close"})),addEvent(this.layerEl,"click",this._onLayerClick.bind(this)),bodyNode.appendChild(this.layerEl)}show(){onBodyResize()}hide(e){Object(G.addClass)(this.layerEl,"stories_layer_hiding"),!this.hideAllLayers&&C(),this._source&&this._source.indexOf("narrative")>-1&&this._sendNavigationStatEvents("narrative_close",!1),!0!==e&&this.activeStory?this.animateStory("minimize").then(this.doHide.bind(this)):this.doHide(e),removeClass(this.layerEl,"shown"),this.activeStory&&(this.activeStory.pauseStory(),this.activeStory._hideTooltip(),this.activeStory.isActiveLive()&&this._sendNavigationStatEvents("live_player_close",!1))}doHide(e){if(this._readStories(),this.destroy(),!e&&(S.pop(),cur.storyLayer=S[S.length-1],cur.storyLayer?cur.storyLayer.resumeLayer():(E(!1,!0),layerQueue.pop())),window.wkcur&&window.wkcur.shown&&WkView.restoreLayer({}),"group_stories"===this.list&&Stories.groupStoriesBlockUpdate(),this.list.startsWith("archive")&&!1!==this.hideAllLayers&&!e){if(!_message_boxes[cur.storiesArchiveBoxGUID])return;_message_boxes[cur.storiesArchiveBoxGUID].forceHide=!1,_message_boxes[cur.storiesArchiveBoxGUID]._show(!0,!1,!0),window.updateStoriesArchiveBoxPosition&&window.updateStoriesArchiveBoxPosition()}}back(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.hideAllLayers=!1;var t=cancelStack[cancelStack.length-1];t&&"stories_form_focus"===t.name&&Object(D.cancelStackPop)(),this.hide(!1,e)}_getScreenStoriesCount(){return 2*Math.floor(window.innerWidth/(window.innerHeight*Ke))+1}_getCurStoryPos(e){return(e||this.storiesBlocks).indexOf(this.blockKey)}_startFirstStory(e,t){this.activeStory=e,Object(G.addClass)(e.getWrap(),"active"),this.scrollToStory(),t||(t=this._hasContext("new")?t:this.storyRaw),e.indexToStoryById(t),this._startActiveStory(),setTimeout(()=>{Object(G.addClass)(this.stories,"animated"),this.inited=!0,"open"===this.extra.replies&&this.activeStory.showFeedbackTooltip()})}_markReadRestStories(e){e.data.is_groups?this._onGroupsStoriesBlockViewEnd(e):e.data.is_apps?this._onAppsStoriesBlockViewEnd(e):(this._markReadStoriesInRange(e,e.index,e.data.items.length),this._updateBadge(e))}_onGroupsStoriesBlockViewEnd(e){var t=Stories._getList("groups");if(t){var s=ge("feed_story_"+this.getBlockKey(e)),r=t.map(e=>e.author.id);this._readAllStoriesByOwners(r,()=>{t.forEach(e=>e.items.forEach(e=>e.unread=!1)),e.data.items[0].unread=!1,this._updateMetaStoryItems(),this._resetGroupsBlockPreview(t[0],s),removeClass(s,"story_feed_new_item")})}}_onAppsStoriesBlockViewEnd(e){var t=Stories._getList("apps");if(t){var s=ge("feed_story_"+this.getBlockKey(e)),r=t.map(e=>e.author.id);this._readAllStoriesByOwners(r,()=>{t.forEach(e=>e.items.forEach(e=>e.unread=!1)),e.data.items[1].unread=!1,this._updateMetaStoryItems(),removeClass(s,"story_feed_new_item")})}}_readAllStoriesByOwners(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};ajax.post("al_stories.php",{act:"mark_owners_seen",owners_ids:e.join(","),hash:this.storiesReadHash},{onDone:()=>{t()}})}_resetGroupsBlockPreview(e,t){var s=e.items[0];t.classList.contains("stories_feed_preview_item")&&s&&s.small_preview&&Object(G.setStyle)(t,"background-image",`url(${s.small_preview})`)}_onSelectStory(e){var t;this.activeStory&&(t=this.activeStory.getWrap(),this.activeStory.stop()),e.id-this.activeStory.id>0&&this._markReadRestStories(this.activeStory),this.activeStory=e,e.indexToUnread(),e.isActiveLive()||e.fillTimeLine(),this.blockKey=this.getBlockKey(e),clearTimeout(this.timer),Object(G.addClass)(this.stories,"animated"),this.timer=setTimeout(()=>{removeClass(t,"active"),Object(G.addClass)(e.getWrap(),"active"),this.scrollToStory(),this.timer=setTimeout(()=>{this.activeStory&&e.id!==this.activeStory.id||!this.activeStory||(e.indexToUnread(),this._startActiveStory(),this._renderStories(),this.scrollToStory(e,!0))},200)})}_startActiveStory(){var e=this.activeStory;e.markAsActive(),e.playStory(!0)}_onStartStory(){var e=this.activeStory,t=this.list;if(e){var s=nav.objLoc;s.w="story"+e.getRawId(),t.match(/^-?(\d+)_(\d+)$/)||(s.w+="/"+t),t.match(/^narrative-?\d+_\d+/)&&(s.w=`narrative${this.activeStory.getCurStoryData().narrative.raw_id}`),nav.setLoc(nav.toStr(s))}}scrollToStory(e,t){var s=this._getScrollLeft(e);t?(removeClass(this.stories,"animated"),this._setScrollLeft(s)):this.inited&&Object(G.addClass)(this.stories,"animated"),setTimeout(()=>{this._setScrollLeft(s)})}_setScrollLeft(e){Object(G.setStyle)(this.stories,"transform","translateX("+e+"px) translateZ(0)")}_getScrollLeft(e){return e=e||this.activeStory,window.innerWidth/2-e.getOffsetLeft()}_onStoriesEnd(e,t){for(var s=-1,r=e+1;r<this.storiesList.length;r++){if(this.storiesList[r]){s=r;break}}var i=this._getStoryInstanceByIndex(s);if(s>-1)t&&this._sendNavigationStatEvents("go_to_next_story_auto_by_time"),this._onSelectStory(i);else{cur.storyLayer.activeStory.data.is_groups&&this._onGroupsStoriesBlockViewEnd(cur.storyLayer.activeStory),cur.storyLayer.activeStory.isAppsMetaStoryActive()&&this._onAppsStoriesBlockViewEnd(cur.storyLayer.activeStory);var o=cancelStack[cancelStack.length-1];o&&"stories_form_focus"===o.name&&Object(D.cancelStackPop)(),Object(D.cancelStackPop)(t)}}_playPrevOwner(e){for(var t=-1,s=e-1;s>=0;s--){if(this.storiesList[s]){t=s;break}}t>-1?this._onSelectStory(this._getStoryInstanceByIndex(t)):Object(D.cancelStackPop)()}_markReadStoriesInRange(e,t,s){for(var r=e.data.items,i=t;i<s;i++){var o=r[i];o.unread&&(o.unread=!1)}}_markReadPrevStories(e){this._markReadStoriesInRange(e,0,e.index)}_updateBadge(e){var t=ge("feed_story_"+this.getBlockKey(e)),s=geByClass1("_stories_feed_item_replies",t);if((hasClass(t,"story_feed_new_item")||""!==val(s))&&!e.data.is_groups&&!e.data.is_apps){var r=e.data.items||[],i=r[e.index]||{};(i.answers||{}).new_count=0,i.unread=!1;var o=!0,a=0;r.forEach(e=>{var t=e.answers||{};a+=t.new_count||0,e.unread&&(o=!1)}),a>0?val(s,a):(val(s,""),o&&(removeClass(t,"story_feed_new_item"),removeClass(t,"story_feed_new_item_promo")))}}_onPlayStory(e){var t=this._getStoryInstanceByIndex(e);if(t){this.storiesReadHash=t.getReadHash();var s=t.getRawId(),r=t.getTrackCode();r&&(s+="_"+r),t.data.is_groups||t.isAppsMetaStoryActive()||(this.storiesToRead.push(s),this._markReadPrevStories(t)),this.storiesToRead>10&&this._readStories(),this._updateBadge(t)}var i=this._getStoryInstanceByIndex(e+1);i&&i.preloadNextStory(i.getIndex())}_getStoryInstanceByIndex(e){var t=this.storiesList[e];if(!t)return!1;var s=this.getBlockKey(t);return this.renderedStories[s].story}_onStoryRemoved(e,t,s,r){for(var i=0;i<this.storiesList.length;i++)this.storiesList[i]&&this.storiesList[i].author.id===e&&(this.storiesList[i]=!1);!s&&this._onStoriesEnd(t),Stories.updateFeedStories(null,{cb:r})}onVisibilityChange(){"visible"===document.visibilityState?cur.storyLayer&&cur.storyLayer.playStory():cur.storyLayer&&cur.storyLayer.pauseStory()}onResize(){var e=cur.storyLayer.activeStory;e&&cur.storyLayer.scrollToStory(e,!0)}pauseStory(e){this.activeStory&&this.activeStory.pauseStory(e)}playStory(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.activeStory&&this.activeStory.autoResumeStory(e)}_onLayerClick(e){var t=hasClass(e.target,"stories_layer_close");(hasClass(e.target,"stories_layer_cont")||t)&&(t?this.isCloseBtnClick=!0:this.storiesBlocks.length-1===this._getCurStoryPos()&&(this._markReadRestStories(this.activeStory),this._markStoryAsSkipped()),Object(D.cancelStackPop)())}_checkKeyEvents(e){return!(attr(e.target,"contenteditable")||inArray(e.target.tagName,["INPUT","TEXTAREA"])||curBox())}onKeyDown(e){if(cur.storiesKeyDown)cur.storyLayer&&cur.storyLayer._checkKeyEvents(e)&&cancelEvent(e);else{if(cur.storiesKeyDown=e.keyCode!==KEY.ESC,[KEY.PAGEDOWN,KEY.PAGEUP].indexOf(e.keyCode)>-1)return cancelEvent(e);if(cur.storyLayer&&cur.storyLayer.inited&&cur.storyLayer._checkKeyEvents(e)){switch(e.keyCode){case KEY.LEFT:cur.storyLayer.prevStory();break;case KEY.RIGHT:cur.storyLayer.nextStory();break;case KEY.SPACE:cancelEvent(e);var t=cur.storyLayer.activeStory;t.isSpaceLongTabAvailable()&&(cur.storiesKeyDownLong=setTimeout(t._longTapHandle.bind(t),P))}cur.storiesKeyDownTs=vkNow()}}}onKeyUp(e){cur.storiesKeyDown=!1,clearTimeout(cur.storiesKeyDownLong),cur.storyLayer&&cur.storyLayer.inited&&cur.storyLayer._checkKeyEvents(e)&&e.keyCode===KEY.SPACE&&(cancelEvent(e),vkNow()-cur.storiesKeyDownTs>P?cur.storyLayer.playStory(!0):cur.storyLayer.nextStory())}nextStory(){this.activeStory&&this.activeStory.nextStory()}prevStory(){this.activeStory&&this.activeStory.prevStory()}changeStory(e){this.activeStory&&this.activeStory.changeStory(e)}_readStories(){if(this.storiesToRead.length){var e,t,s=this._getSource(),r=this.storiesToRead.join(","),i=this.storiesSkip.join(",");this.storiesToRead=[],ajax.post("al_stories.php",{act:"read_stories",stories:r,source:s,stories_skip:i,navigation_stats:(t=st.map(e=>[e.ownerId,e.storyId,e.source,e.action].join(",")).join(";"),st=[],t),loading_stats:(e=rt.map(e=>[e.ownerId,e.storyId,e.source,e.time].join(",")).join(";"),rt=[],e),connection_type:tt(),hash:this.storiesReadHash})}}_getSource(){var e="list";return this._source?this._source:(-1!==[Ye,Je,A,Ze.MODULE].indexOf(cur.module)&&(e=cur.module),e)}_sendNavigationStatEvents(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.activeStory,i=this.getStoryRaw()||r.getCurStoryData().raw_id,o=this._getSource();t&&this._sendProductAnalyticEvents(e,s),this._updateLastStoryOpenAction(e),function(e){var t=e.storyRawId,s=e.source,r=e.action,i=et(t.split("_"),2);"reply"===s&&(s="replies_list");var o={ownerId:i[0],storyId:i[1],source:s,action:r};st.push(o)}({storyRawId:i,source:o,action:e})}_sendProductAnalyticEvents(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.activeStory,r=it((this.getStoryRaw()||s.getCurStoryData().raw_id).split("_"),2),i=r[0],o=r[1],a=s.getIndex(),n=s.getItemsLength()-a,l=s.story,c=this._getSource(),d=s.isGroupedStory(),h=0;if(e&&s&&l&&i&&o){d&&(o=0,i=0,h=0),"groups"===this.list&&(h=1);var u={event_type:e,story_owner_id:i,story_id:o,time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3),volume:100*y(),view_entry_point:c,stories_author_before:a,stories_author_after:n,nav_screen:cur.module,view_event_timeline_position:l.getCurrentTime(),story_type:d?"group_feed":"",is_grouped:h};Object.assign(u,t),statlogsValueEvent("story_product_analytics",u)}}_updateLastStoryOpenAction(e){switch(e){case"go_to_next_story_tap":case"go_to_next_story_click":case"go_to_next_story_auto_by_time":this.viewerSource="next_story";break;case"go_to_previous_story":this.viewerSource="previous_story";break;case"go_to_next_author":this.viewerSource="next_author";break;case"go_to_previous_author":this.viewerSource="previous_author"}}_initViewerSource(){var e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=cur.section;break;default:this.viewerSource=e}}_sendViewerStartTime(e,t){!function(e){var t=e.storyRawId,s=e.source,r=e.time,i=et(t.split("_"),2),o={ownerId:i[0],storyId:i[1],source:s,time:r};rt.push(o)}({storyRawId:e,source:this.viewerSource,time:t})}_onVideoPlay(){this.activeStory.getCurStoryData().noSound||(Notifier.lcSend("stories_video_start"),window.getAudioPlayer().isPlaying()&&(getAudioPlayer().pause(),this.needAudioReset=!0))}_onVideoEnd(){this._restoreAudioPlay()}_restoreAudioPlay(){Notifier.lcSend("stories_video_end"),this.needAudioReset&&(window.getAudioPlayer().play(),delete this.needAudioReset)}_renderBackButton(){return this.backButton=se(`<div class="stories_back_button_wrap">\n  <div class="stories_back_button">\n    <div class="stories_back_button_icon"></div>\n    <div class="stories_back_button_text">${getLang("global_back")}</div>\n  </div>\n</div>`),addEvent(this.backButton,"click",()=>{Object(D.cancelStackPop)()}),this.backButton}showBackButton(){show(this.backButton),this.hideAllLayers=!0,Object(G.addClass)(this.layerEl,"with_back_button")}parseExtra(e){var t={},s=String(e).split(";");for(var r in s)if(s.hasOwnProperty(r)){var i=it(s[r].split(":"),2),o=i[0],a=i[1];o&&a&&(t[o]=a)}return t}getAnimateFromElem(){if(!this.hideAllLayers){var e=this.getBlockKey(this.activeStory);if(hasClass(this.animateFromEl,"stories_feed_reply_item")){var t=domQuery("#feed_story_"+e,domPN(this.animateFromEl))[0];if(t)return t}else if("feed"===cur.module&&!isVisible(this.backButton)){var s=ge("feed_story_"+e);if(s)return Stories.feedScrollToOwner(e),s}}return this.animateFromEl}animateStory(e,t){return new Promise(s=>{if("expand"===e&&!t||"minimize"===e&&!this.animateFromEl)return Object(G.setStyle)("stories_layers_background","opacity",1),s();this.pauseStory(),Object(G.addClass)(this.layerEl,"animation"),removeClass(this.stories,"animated");var r="expand"===e?t:this.getAnimateFromElem();if(this.hideAllLayers&&"minimize"===e){var i=S[0];r=i.getAnimateFromElem(),function(){for(var e=S.length-2;e>=0;e--)S[e].doHide(!0);S.splice(0,S.length-1)}(),C()}removeClass(r,"stories_feed_item_ava_animate");var o=it(getXY(r),2),a=o[0],n=o[1],l=getSize(r),c=window.innerHeight,d=Math.min(Qe,Math.max(Xe,c*Ke)),h=d*ze,u=Math.max(0,(c-h)/2),p=Math.max(0,(window.innerWidth-d)/2);a=p-a+d/2-l[0]/2+scrollGetX(),n=u-n+h/2-l[1]/2+scrollGetY(),a=-a,n=-n;var _={};"expand"===e&&(_.transform=`translate(${a}px, ${n}px) scale(0)`,this.animateFromEl=t),Object(G.setStyle)(this.activeStory.wrapEl,_),"minimize"===e&&Object(G.setStyle)(r,"transform","scale(0)"),this.animationTimer=setTimeout(()=>{Object(G.addClass)(this.stories,"animated"),Object(G.addClass)(r,"stories_feed_item_ava_animate"),this.animationTimer=setTimeout(()=>{"expand"===e?(Object(G.setStyle)("stories_layers_background","opacity",1),Object(G.setStyle)(this.activeStory.wrapEl,"transform","translate(0, 0) scale(1)")):(Object(G.setStyle)(this.activeStory.wrapEl,"transform",`translate(${a}px, ${n}px) scale(0.01)`),Object(G.setStyle)(r,"transform","scale(1)")),this.animationTimer=setTimeout(()=>{s(),"expand"===e?(Object(G.setStyle)(this.activeStory.wrapEl,"transform",""),removeClass(this.layerEl,"animation"),removeClass(this.stories,"animated"),this.playStory(),S.length>1&&(S[S.length-2].setLayerVisibility(!1),S[S.length-1].showBackButton())):(removeClass(r,"stories_feed_item_ava_animate"),Object(G.setStyle)(r,"transform",""))},330)},30)},30)})}pauseLayer(){this.pauseStory(),Object(G.addClass)(this.layerEl,"paused")}resumeLayer(){this._updateVolumeButton(),this.activeStory.volumeUpdate(),this.activeStory&&!this.activeStory.story.isNarrativeMetaStory&&(cur.storyLayer.activeStory.data.is_groups&&cur.storyLayer.activeStory.isAppsMetaStoryActive()&&this._updateMetaStoryItems(),this.playStory(),removeClass(this.layerEl,"paused"),this.activeStory.feedbackScroll&&this.activeStory.feedbackScroll.update())}_updateMetaStoryItems(){if(cur.storyLayer&&cur.storyLayer.activeStory&&cur.storyLayer.activeStory.story&&(cur.storyLayer.activeStory.data.is_groups||cur.storyLayer.activeStory.isAppsMetaStoryActive())){var e="groups";cur.storyLayer.activeStory.isAppsMetaStoryActive()&&(e="apps");var t=cur.storyLayer.activeStory.story.elems.recItems.querySelectorAll(".GridStoryPreview:not(.GridStoryPreview--live)"),s=Stories._getList(e);if(!s)return this.hideAllLayers=!0,void this.hide();var r=0;t.forEach(e=>{var t=e.querySelector(".GridStoryPreview__author"),i=e.querySelector(".GridStoryPreview__inner"),o=+t.getAttribute("data-author-id"),a=s.find(e=>e&&e.author.id===o&&"live"!==e.items[0].type);if(!a)return++r,void e.remove();var n=a.items.findIndex(e=>e.unread);-1===n&&(n=0,removeClass(t,"GridStoryPreview__author--unread"));var l=a.items[n],c=new Image;c.src=l.small_preview,c.onload=()=>{Object(G.setStyle)(i,{backgroundImage:`url('${l.small_preview}')`})}}),t.length-r<3&&(this.hideAllLayers=!0,this.hide())}}setLayerVisibility(e){toggle(this.layerEl,e)}_renderVolumeControl(){return this.volumeControl=se('<div class="stories_volume_control">\n  <div class="stories_volume_control_slide_wrap">\n    <div class="stories_volume_control_slide">\n      <div class="stories_volume_control_slide_indicator"></div>\n    </div>\n  </div>\n</div>'),addEvent(geByClass1("stories_volume_control_slide_wrap",this.volumeControl),"mousedown",this._volumeControlOnMouseDown.bind(this)),addEvent(this.volumeControl,"mousedown",this._volumeControlOnClick.bind(this)),this.volumeControlContainer=ce("div",{className:"stories_volume_control_container"}),this.volumeControlContainer.appendChild(this.volumeControl),this.volumeControlContainer}_volumeControlOnMouseDown(e){Object(G.addClass)(this.volumeControlContainer,"changing");var t=geByClass1("stories_volume_control_slide",this.volumeControl),s=geByClass1("stories_volume_control_slide_indicator",t),r=it(getXY(t),1)[0],i=it(getSize(t),1)[0],o=e=>{var t=Math.max(0,Math.min(e.pageX-r,i))/i*100;Object(G.setStyle)(s,"width",t+"%"),g(t/100),this.activeStory.volumeUpdate()},a=()=>{removeEvent(window,"mousemove",o),removeEvent(window,"mouseup",a),this._updateVolumeButton(),removeClass(this.volumeControlContainer,"changing")};addEvent(window,"mousemove",o),addEvent(window,"mouseup",a),o(e)}_updateVolumeButton(){var e=100*y();toggleClass(this.volumeControl,"low",e>0&&e<50),toggleClass(this.volumeControl,"high",e>=50);var t=geByClass1("stories_volume_control_slide_indicator",this.volumeControl);Object(G.setStyle)(t,"width",e+"%")}_volumeControlOnClick(e){if(!hasClass(e.target,"stories_volume_control_slide_wrap")&&!hasClass(this.volumeControlContainer,"changing")){var t=y();g(t=t?0:1),this._updateVolumeButton(),this.activeStory.volumeUpdate()}}onReplyDeleted(e){this.activeStory&&this.activeStory.onReplyDeleted(e)}_markStoryAsSkipped(){this.storiesSkip.push(this.getStoryRaw())}_hasContext(e){return!(!this.extra||!this.extra.context||this.extra.context!==e)}}function at(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var nt=o.Promise,lt={show(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.match(/story/)&&(e=this._parseList(e)),cur.storyLayer&&cur.storyLayer.list===e.split("/")[1])return!1;this.getList(e).then(e=>{var s=e.blockKey,r=e.list,i=e.items,o=e.extra;w(new ot(s,r,i,o,t),t);var a=Object(Me.curBox)();a&&(t.fromEl=null,"stories"===a.wkRaw?(a._hide(!1,!0,!0),a.forceHide=!0,cur.storiesArchiveBoxGUID=a.guid):a.hide())}).catch(e=>{vk.dev&&debugLog(e),showFastBox(Object(Ne.getLang)("global_error"),Object(Ne.getLang)("global_unknown_error"))})},_getUnreadStory(e,t){e=intval(e);for(var s=!1,r=0;r<t.length;r++)if(t[r].author.id===e){for(var i=t[r].items,o=0;o<i.length;o++)if(i[o].unread){s=i[o];break}s||(s=i[0]);break}return s},getList:e=>new nt((t,s)=>{var r=at(e.split("/"),3),i=r[0],o=r[1],a=r[2],n={blockKey:i,list:o,extra:a},l=lt._getList(o);isArray(l)?(n.items=l,t(n)):ajax.post("al_stories.php",{act:"get_list",list:o,story_raw:i,extra:a,from_manage:window.cur.module===A?1:0},{loader:!0,onDone(e){cur["stories_list_"+o]=e.list,n.items=e.list,e.recommendations&&(cur["stories_list_"+o+"_recommendations"]=e.recommendations),t(n)},onFail:()=>(s(),!0)})}),_getList:e=>cur["stories_list_"+e],_setList(e,t){cur["stories_list_"+e]=t},removeList(e){delete cur["stories_list_"+e]},_parseList(e){var t=at((e=decodeURIComponent(e)).match(/^story(-?\d+)_(\d+)(\/([a-z0-9\_\-]+))?(\/([a-z0-9\_\:\;\-]+))?$/i),7),s=t[1],r=t[2],i=t[4],o=t[6],a=s+"_"+r;return e.match(/from_feed\=1/)?i="feed":e.match(/profile\=1/)?i="profile":i||(i=a),a+"/"+i+"/"+o},initFeed(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"stories_feed_items_container";e=Object(G.ge)(e);var t=Object(G.geByClass1)("stories_feed_items",e),s=attr(t,"id");function r(){addEvent(e,browserFeatures.wheelEvent,lt.feedMouseWheel)}function i(){removeEvent(e,browserFeatures.wheelEvent,lt.feedMouseWheel)}lt.updateFeedArrows(s),addEvent(e,"mouseenter",r),addEvent(e,"mouseleave",i),cur.destroy.push(function(){removeEvent(e,browserFeatures.wheelEvent,lt.feedMouseWheel),removeEvent(e,"mouseenter",r),removeEvent(e,"mouseleave",i)})},feedNext(e){var t=Object(G.ge)("stories_feed_wrap");return e&&(t=domClosest("stories_feed_wrap",e.target)),this.feedPaging("next",null,t)},feedPrev(e){var t=Object(G.ge)("stories_feed_wrap");return e&&(t=domClosest("stories_feed_wrap",e.target)),this.feedPaging("prev",null,t)},feedPaging(e,t,s){s||(s=Object(G.ge)("stories_feed_wrap"));var r=Object(G.geByClass1)("stories_feed_items",s),i=attr(r,"id"),o=i+"_position",a=cur[o]||0,n=getSize(s)[0];if(isNumeric(e))a+=e;else{var l=n-100;"next"===e?a+=l:a-=l}cur[o]=Math.max(0,Math.min(a,r.scrollWidth-n)),t?Object(G.removeClass)(r,"animated"):Object(G.addClass)(r,"animated"),setStyle(r,"transform","translateX(-"+cur[o]+"px)"),lt.updateFeedArrows(i)},feedScrollToOwner(e){var t=Object(G.ge)("feed_story_"+e);if(t){var s=domClosest("stories_feed_items",t),r=s.offsetWidth,i=attr(s,"id")+"_position",o=t.offsetWidth,a=t.offsetLeft,n=domClosest("stories_feed_wrap",s);cur[i]=a-r+r/2+o/2,lt.feedPaging(0,!0,n)}},updateFeedStories(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"stories_feed_items",r=Object(G.ge)(s),i=domClosest("stories_feed_wrap",r);if(e=e||"news",r)if(inArray(e,["news","search"])){var o=(e,r)=>{t&&t.cb&&t.cb(),Object.keys(r).forEach(e=>this._setList(e,r[e])),cur.storyLayer&&cur.storyLayer._updateMetaStoryItems();var o=Object(G.ge)(s);o&&(e?(setStyle(o,"transform","translateX(0px)"),Object(G.val)(o,e),o.children.length<6?Object(G.addClass)(i,"stories_feed_not_nav_buttons"):Object(G.removeClass)(i,"stories_feed_not_nav_buttons"),cur[s+"_position"]=0,lt.updateFeedArrows(s),show(i)):hide(i))};if(t&&t.stories){var a=t.section,n=t.q,l=t.stories,c=l.html,d=l.js,h=d.feed?d.feed:[];return"search"!==a||n&&h.length?void o(c,d):void hide(i)}ajax.post("al_stories.php",{act:"feed_stories"},{onDone:o})}else hide(i)},feedMouseWheel(e){var t=domClosest("stories_feed_wrap",e.target);if(!hasClass(t,"stories_feed_not_nav_buttons")){cancelEvent(e);var s=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;lt.feedPaging(s,1,t)}},updateFeedArrows(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"stories_feed_items",t=Object(G.ge)(e),s=e+"_position";if(t){cur[s]||(cur[s]=0);var r=Object(G.geByClass1)("stories_feed_wrap").offsetWidth,i=t.scrollWidth-r,o=Object(G.geByClass1)("stories_feed_arrow_left",domPN(t)),a=Object(G.geByClass1)("stories_feed_arrow_right",domPN(t));0===cur[s]?Object(G.addClass)(o,"disabled"):Object(G.removeClass)(o,"disabled"),cur[s]===i||i<=0?Object(G.addClass)(a,"disabled"):Object(G.removeClass)(a,"disabled")}},showBlackList(){cur.storyLayer&&cur.storyLayer.pauseStory(),showBox("al_stories.php",{act:"black_list"},{onDone(){cur.storiesBlackListScroll=new uiScroll("stories_black_list_result")},params:{onHide:()=>{cur.storyLayer&&cur.storyLayer.playStory()}}})},blackListItemClick(e,t){cancelEvent(t);var s=intval(attr(e,"data-id"));cur.storiesBlackListShown[s]?(delete cur.storiesBlackListShown[s],Object(G.removeClass)(e,"olist_item_wrap_on")):(cur.storiesBlackListShown[s]=1,Object(G.addClass)(e,"olist_item_wrap_on"))},saveBlackList(e){var t=Object.keys(cur.storiesBlackListShown);0!==t.length?ajax.post("al_stories.php",{act:"save_blacklist",hash:cur.storiesBlackList.hash,list:t.join(",")},{onDone(){lt.updateFeedStories(),Object(Me.curBox)().hide()},showProgress:lockButton.pbind(e),hideProgress:unlockButton.pbind(e)}):Object(Me.curBox)().hide()},blacklistUpdateUsers(e){var t=e;if(e=trim(e).toLowerCase(),cur.storiesBlacklistLastQ!==e){cur.storiesBlacklistLastQ=e;var s=e?cur.storiesIndexer.search(e):cur.storiesBlackList.users,r=[];if(e)for(var i=0;i<e.length;i++)r.push(e.substr(i,1));for(var o=new RegExp(r.join(".*?"),"i"),a="",n=0;n<s.length;n++){var l=s[n],c=e?l.name.replace(o,e=>`<em>${e}</em>`):l.name;a+=cur.storiesBlackList.tpl.replace(/\{id\}/g,l.id).replace("{photo}",l.photo).replace("{name}",c).replace("{href}",l.href).replace("{class_name}",cur.storiesBlackListShown[l.id]?" olist_item_wrap_on":"")}a||(a='<div class="no_rows">'+Object(Ne.getLang)("global_search_not_found").replace("{search}",clean(t))+"</div>"),Object(G.val)(Object(G.geByClass1)("olist","stories_black_list_result"),a)}},blackListInit(e){cur.storiesBlackListShown={},cur.storiesBlackList=e,Object(Me.curBox)().setOptions({width:450,bodyStyle:"padding: 0px",onClean:function(){this.storyLayer&&this.storyLayer.playStory(),cur.storiesBlackListScroll&&cur.storiesBlackListScroll.destroy()}}).removeButtons(),cur.storiesBlackList.users.length?(cur.storiesBlacklistLastQ=!1,cur.storiesIndexer=new vkIndexer(cur.storiesBlackList.users,e=>e.name,()=>{lt.blacklistUpdateUsers("")}),uiSearch.init("stories_blacklist"),uiSearch.focus("stories_blacklist"),Object(Me.curBox)().addButton(Object(Ne.getLang)("global_save"),lt.saveBlackList).addButton(Object(Ne.getLang)("global_cancel"),void 0,"no")):Object(Me.curBox)().addButton(Object(Ne.getLang)("global_close"))},preloadUrl(e){_(e)},showNextRepliesChunk(e){var t=gpeByClass("stories_feedback_replies_items",e);Object(G.removeClass)(Object(G.geByClass1)("stories_replies_chunk_hidden",t),"stories_replies_chunk_hidden");var s=Object(G.geByClass1)("stories_replies_chunk_hidden",t);s?Object(G.val)(e,langNumeric(Object(Ne.getLang)("stories_replies_more_button",intval(attr(s,"data-size"))))):re(e),cur.storyLayer&&cur.storyLayer.activeStory&&cur.storyLayer.activeStory.feedbackTooltipReInitHeaders(),cur.storyLayer&&cur.storyLayer.activeStory&&cur.storyLayer.activeStory.updateFeedbackTTPos()},groupStoriesBlockUpdate(){var e=lt._getList("group_stories"),t=e&&e[0]&&e[0].items;if(t){for(var s=0,r=0;r<t.length;r++){t[r].unread&&s++}var i=Object(G.geByClass1)("stories_groups_block_stories_wrap"),o=Object(G.geByClass1)("stories_groups_block_stories_button",i);Object(G.toggleClass)(i,"has_unread",s>0),Object(G.toggleClass)(i,"has_stories",t.length>0),Object(G.toggleClass)(o,"has_stories",t.length>0);var a=Object(W.clone)(cur.storiesPreviews),n=a.splice(a.length-s,3);n.length<3&&(n=n.concat(a.slice(0,3-n.length))),n.reverse();for(var l="",c=n.length-1;c>=0;c--)l+=cur.storiesPreviewsRowHtml.replace("{url}",n[c]);Object(G.val)(Object(G.geByClass1)("stories_groups_block_stories_rows",i),l)}},isLiveShown:e=>!!(cur.storyLayer&&cur.storyLayer.activeStory&&cur.storyLayer.activeStory.isActiveLive())&&cur.storyLayer.activeStory.story.videoRaw===e,activeLiveEnded(e){cur.storyLayer.activeStory.onLiveEnded(e)},updateLiveViewersCount(e){var t=e?Object(Ne.getLang)("stories_live_N_watching",e,!0):"";cur.storyLayer.activeStory.updateLiveViewersCount(t)}};window.Stories=lt;try{stManager.done("stories.js")}catch(e){}},Hx9h:function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return n});s("91GP"),s("ioFf"),s("rGqo"),s("Btvt");var r=s("q1tI"),i=(s("17x9"),s("pemR"));function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var s,r,i=function(e,t){if(null==e)return{};var s,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}class n extends r.Component{render(){var e=this.props,t=e.className,s=e.appearance,n=e.wide,l=e.overflow,c=e.size,d=a(e,["className","appearance","wide","overflow","size"]),h=Object(i.classNames)("Button",...Array.isArray(s)?s.map(e=>`Button--${e}`):[`Button--${s}`],`Button--size-${c}`,{"Button--wide":!!n,"Button--overflow":!!l,"Button--disabled":!!e.disabled},t);return r.createElement("button",o({},d,{className:h}),e.children)}}n.defaultProps={appearance:"primary",size:"m",wide:!1,disabled:!1}},KFTi:function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return n});s("91GP"),s("ioFf"),s("rGqo"),s("Btvt");var r=s("q1tI"),i=(s("17x9"),s("pemR"));function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var s,r,i=function(e,t){if(null==e)return{};var s,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}function n(e){var t=e.inverted,s=e.size,n=e.className,l=a(e,["inverted","size","className"]),c=Object(i.classNames)("Progress",{"Progress--inverted":t},`Progress--size-${s}`,n);return r.createElement("div",o({className:c},l),r.createElement("div",{className:"Progress__item"}),r.createElement("div",{className:"Progress__item"}),r.createElement("div",{className:"Progress__item"}))}n.defaultProps={inverted:!1,size:"s"}},NsuH:function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return n});var r=s("q1tI"),i=(s("17x9"),s("pemR")),o=s("BN/X"),a="/images/camera_c.gif";class n extends r.PureComponent{constructor(e){super(e),this.onError=()=>{this.setState({errored:!0})},this.state={}}getPhotoImage(){var e=this.props,t=e.photo,s=e.title;return r.createElement("img",{src:this.state.errored?a:t,alt:s,onError:this.onError,className:"Entity__photo"})}render(){var e=this.props,t=e.className,s=e.style,a=e.size,n=e.photo,l=e.href,c=e.title,d=e.description,h=e.target,u={[`Entity--size${a}`]:!!a};return r.createElement("div",{className:Object(i.classNames)("Entity",t,u),style:s},r.createElement("div",{className:"Entity__aside"},"string"==typeof n?l?r.createElement("a",{href:l,target:h},this.getPhotoImage()):this.getPhotoImage():n),r.createElement("div",{className:"Entity__main"},c&&l?r.createElement("div",{className:"Entity__title"},r.createElement(o.default,{href:l,dangerouslySetInnerHTML:{__html:c},target:h})):r.createElement("div",{className:"Entity__title",dangerouslySetInnerHTML:{__html:c}}),"string"!=typeof d?r.createElement("div",{className:"Entity__description"},d):r.createElement("div",{className:"Entity__description",dangerouslySetInnerHTML:{__html:d}})))}}n.defaultProps={size:null,photo:"",title:"",description:"",href:"",target:null}},PjZB:function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return i});s("rGqo"),s("a1Th"),s("Btvt");var r=s("q1tI");s("17x9");class i extends r.Component{constructor(e){super(e),this.id=Math.round(1e6*Math.random()).toString(16),this.setSpinnerParams(e)}componentWillReceiveProps(e){this.setSpinnerParams(e)}setSpinnerParams(e){this.offset=Math.round(Math.PI*e.size),this.c=.5*e.size,this.animation=function(e,t){if(!e||!t)return"";var s=Object.keys(t).map(e=>e+" {"+Object.keys(t[e]).map(s=>s+":"+t[e][s]).join(";")+"}").join("");return`@-webkit-keyframes ${e} {${s}} @keyframes ${e} {${s}}`}("dash"+this.id,{"0%":{"stroke-dashoffset":this.offset},"50%":{"stroke-dashoffset":Math.round(.25*this.offset),transform:"rotate(135deg)"},"100%":{"stroke-dashoffset":this.offset,transform:"rotate(360deg)"}})}render(){var e=this.props,t=e.style,s=e.color,i=e.size,o=e.duration,a=e.strokeWidth,n=this.id,l=this.offset,c=this.animation;return r.createElement("div",{className:"Spinner",style:t},r.createElement("svg",{className:"Spinner__svg",width:i,height:i,viewBox:`0 0 ${i} ${i}`,xmlns:"http://www.w3.org/2000/svg"},r.createElement("g",{style:{width:i,height:i,transformOrigin:.5*i+"px "+.5*i+"px"}},r.createElement("style",{dangerouslySetInnerHTML:{__html:c}}),r.createElement("circle",{className:"Spinner__path",fill:"none",stroke:s,strokeDasharray:l,strokeDashoffset:l,strokeWidth:a,style:{animationName:"dash"+n,animationTimingFunction:"ease-in-out",animationDuration:o+"s",animationIterationCount:"infinite"},cx:.5*i,cy:.5*i,r:.5*i-.5*a}))))}}i.defaultProps={color:"#5181b8",size:19,strokeWidth:2,duration:1.4}},"S6+Z":function(e,t,s){"use strict";s.r(t),s.d(t,"emojiRegex",function(){return r}),s.d(t,"skinToneModifierRegex",function(){return i}),s.d(t,"EMOJI_PREFIXED_REPLACES",function(){return o}),s.d(t,"EMOJI_REPLACES",function(){return a}),s.d(t,"EMOJI_HINTS",function(){return n});var r=()=>/(?:\uD83C\uDFF4)(?:(?:\uDB40\uDC67)(?:\uDB40\uDC62)(?:(?:\uDB40\uDC65)(?:\uDB40\uDC6E)(?:\uDB40\uDC67)|(?:\uDB40\uDC77)(?:\uDB40\uDC6C)(?:\uDB40\uDC73)|(?:\uDB40\uDC73)(?:\uDB40\uDC63)(?:\uDB40\uDC74))(?:\uDB40\uDC7F)|\u200D\u2620\uFE0F?)|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC69)\u200D(?:(?:\uD83D\uDC66)\u200D(?:\uD83D\uDC66)|(?:\uD83D\uDC67)\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83D\uDC68)(?:\u200D(?:\u2764\uFE0F?\u200D(?:(?:\uD83D\uDC8B)\u200D)?(?:\uD83D\uDC68)|(?:\uD83D[\uDC68\uDC69])\u200D(?:(?:\uD83D\uDC66)\u200D(?:\uD83D\uDC66)|(?:\uD83D\uDC67)\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83D\uDC66)\u200D(?:\uD83D\uDC66)|(?:\uD83D\uDC67)\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3]))|(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3]))|(?:\uD83D\uDC69)\u200D(?:\u2764\uFE0F?\u200D(?:(?:\uD83D\uDC8B)\u200D(?:\uD83D[\uDC68\uDC69])|(?:\uD83D[\uDC68\uDC69]))|(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3]))|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC66)\u200D(?:\uD83D\uDC66)|(?:(?:\uD83D\uDC41)\uFE0F?\u200D(?:\uD83D\uDDE8)|(?:\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|(?:\uD83D\uDC68)(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|(?:(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)\uFE0F?|(?:\uD83D\uDC6F|\uD83E[\uDD3C\uDDDE\uDDDF]))\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDD6-\uDDDD])(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|\u200D[\u2640\u2642])|(?:\uD83D\uDC69)\u200D[\u2695\u2696\u2708])\uFE0F?|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC67)\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC69)\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D\uDC68)(?:\u200D(?:(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D[\uDC66\uDC67]))|(?:\uD83C[\uDFFB-\uDFFF]))|(?:\uD83C\uDFF3)\uFE0F?\u200D(?:\uD83C\uDF08)|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC67)|(?:\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3])|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC66)|(?:\uD83C\uDDF6)(?:\uD83C\uDDE6)|(?:\uD83C\uDDFD)(?:\uD83C\uDDF0)|(?:\uD83C\uDDF4)(?:\uD83C\uDDF2)|(?:\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFF])|(?:\uD83C\uDDED)(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|(?:\uD83C\uDDEC)(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|(?:\uD83C\uDDEA)(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|(?:\uD83C\uDDE8)(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|(?:\uD83C\uDDF2)(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|(?:\uD83C\uDDF3)(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|(?:\uD83C\uDDFC)(?:\uD83C[\uDDEB\uDDF8])|(?:\uD83C\uDDFA)(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|(?:\uD83C\uDDF0)(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|(?:\uD83C\uDDEF)(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|(?:\uD83C\uDDF8)(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|(?:\uD83C\uDDEE)(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|(?:\uD83C\uDDFF)(?:\uD83C[\uDDE6\uDDF2\uDDFC])|(?:\uD83C\uDDEB)(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|(?:\uD83C\uDDF5)(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|(?:\uD83C\uDDE9)(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|(?:\uD83C\uDDF9)(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|(?:\uD83C\uDDE7)(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|[#\*0-9]\uFE0F?\u20E3|(?:\uD83C\uDDF1)(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|(?:\uD83C\uDDE6)(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|(?:\uD83C\uDDF7)(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|(?:\uD83C\uDDFB)(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|(?:\uD83C\uDDFE)(?:\uD83C[\uDDEA\uDDF9])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1F\uDD30-\uDD36\uDDB5\uDDB6\uDDD1-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDEEB\uDEEC\uDEF4-\uDEF9]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD70\uDD73-\uDD76\uDD7A\uDD7C-\uDDA2\uDDB0-\uDDB9\uDDC0-\uDDC2\uDDD0-\uDDFF])|(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEF9]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD70\uDD73-\uDD76\uDD7A\uDD7C-\uDDA2\uDDB0-\uDDB9\uDDC0-\uDDC2\uDDD0-\uDDFF])\uFE0F?|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC69\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDDB5\uDDB6\uDDB8\uDDB9\uDDD1-\uDDDD])/g,i=/\uFE0F?\uD83C[\uDFFB-\uDFFF]/,o={e29da4:/(\s|^)([0OО]:\))([\s\.,]|$)/g,f09f9887:/(\s|^)(;-\)+)([\s\.,]|$)/g,f09f9889:/(\s|^)([XХxх]-?D)([\s\.,]|$)/g,f09f9886:/(\s|^)(B-\))([\s\.,]|$)/g,f09f988e:/(\s|^)(3-\))([\s\.,]|$)/g,f09f988c:/(\s|^)(&gt;\()([\s\.,]|$)/g,f09f98a0:/(\s|^)(;[oоOО])([\s\.,]|$)/g,f09f98b0:/(\s|^)(8\|)([\s\.,]|$)/g,f09f98b3:/(\s|^)(8-?[oоOО])([\s\.,]|$)/g,f09f98b2:/(\s|^)(8-\))([\s\.,]|$)/g,f09f988d:/(\s|^)(:[XХ])([\s\.,]|$)/g,f09f98b7:/(\s|^)(:[oоOО])([\s\.,]|$)/g,f09f98a8:/(\s|^)(&lt;3)([\s\.,]|$)/g},a={f09f988a:/(:-\))([\s\.,]|$)/g,f09f9883:/(:-D)([\s\.,]|$)/g,f09f989c:/(;-[PР])([\s\.,]|$)/g,f09f988b:/(:-[pр])([\s\.,]|$)/g,f09f9892:/(:-\()([\s\.,]|$)/g,e298ba:/(:-?\])([\s\.,]|$)/g,f09f988f:/(;-\])([\s\.,]|$)/g,f09f9894:/(3-?\()([\s\.,]|$)/g,f09f98a2:/(:&#039;\()([\s\.,]|$)/g,f09f98ad:/(:_\()([\s\.,]|$)/g,f09f98a9:/(:\(\()([\s\.,]|$)/g,f09f9890:/(:\|)([\s\.,]|$)/g,f09f98a1:/(&gt;\(\()([\s\.,]|$)/g,f09f989a:/(:-\*)([\s\.,]|$)/g,f09f9888:/(\}:\))([\s\.,]|$)/g,f09f918d:/(:like:)([\s\.,]|$)/g,f09f918e:/(:dislike:)([\s\.,]|$)/g,e2989d:/(:up:)([\s\.,]|$)/g,e29c8c:/(:v:)([\s\.,]|$)/g,f09f918c:/(:ok:|:ок:)([\s\.,]|$)/g},n={e29da4:[0,"<3"],f09f988a:[1,":-)"],f09f9883:[2,":-D"],f09f9889:[3,";-)"],f09f9886:[4,"xD"],f09f989c:[5,";-P"],f09f988b:[6,":-p"],f09f988d:[7,"8-)"],f09f988e:[8,"B-)"],f09f9892:[9,":-("],f09f988f:[10,";-]"],f09f9894:[11,"3("],f09f98a2:[12,":'("],f09f98ad:[13,":_("],f09f98a9:[14,":(("],f09f98a8:[15,":o"],f09f9890:[16,":|"],f09f988c:[17,"3-)"],f09f98a0:[18,">("],f09f98a1:[19,">(("],f09f9887:[20,"O:)"],f09f98b0:[21,";o"],f09f98b3:[22,"8|"],f09f98b2:[23,"8o"],f09f98b7:[24,":X"],f09f989a:[25,":-*"],f09f9888:[26,"}:)"],f09f918d:[27,":like:"],f09f918e:[28,":dislike:"],e2989d:[29,":up:"],e29c8c:[30,":v:"],f09f918c:[31,":ok:"]}},"T/g7":function(e,t,s){"use strict";s.r(t),s.d(t,"getLang",function(){return a});var r=s("nAFc"),i=s("4+be"),o={};function a(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0,a="number"==typeof t,n=e+(t||a?".raw":"");if(void 0===o[n]){var l=t||a?Object(i.getLang)(e,"raw"):Object(i.getLang)(e);"string"==typeof l?o[n]=Object(r.decodeHTMLEntities)(l):Array.isArray(l)&&(o[n]=l.map(r.decodeHTMLEntities))}if(a){var c=t;return Object(i.langNumeric)(c,o[n],s)}return o[n]||""}t.default={getLang:a}},TBLV:function(e,t,s){"use strict";s.r(t);s("91GP"),s("ioFf"),s("rGqo"),s("Btvt");var r=s("q1tI"),i=(s("17x9"),s("pemR"));function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var s,r,i=function(e,t){if(null==e)return{};var s,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}var n=e=>{var t=e.className,s=e.children,n=a(e,["className","children"]),l=Object(i.classNames)("Radio",t,{"Radio--disabled":e.disabled});return r.createElement("label",{className:l},r.createElement("input",o({className:"Radio__input Radio__visuallyHidden",type:"radio"},n)),r.createElement("span",{className:"Radio__control"}),Boolean(s)&&r.createElement("span",{className:"Radio__text"},s))};n.defaultProps={className:"",name:void 0,onChange:void 0,checked:void 0,defaultChecked:void 0,autoFocus:!1,disabled:!1,children:null},t.default=n},"Tn+0":function(e,t,s){"use strict";s.r(t),s.d(t,"MODULE",function(){return r}),s.d(t,"REPORT_CLASS",function(){return i}),s.d(t,"BAN_PERIOD_FOREVER",function(){return o}),s.d(t,"_getReportRawIdByElement",function(){return a}),s.d(t,"_getReportDecisionRawIdByElement",function(){return n});s("pIFo");var r="sf",i="sf_report",o=1e3;function a(e){return gpeByClass(i,e).id.replace("report","")}function n(e){var t=gpeByClass(i,e),s=geByClass1("decision_result",t);return domData(s,"decision_raw_id")}},TxR4:function(e,t,s){"use strict";s.r(t),s.d(t,"emojiSymbolToByteHex",function(){return i}),s.d(t,"emojiByteHexToSymbol",function(){return o}),s.d(t,"emojiRemoveSkinToneModifiers",function(){return a});s("pIFo"),s("a1Th"),s("Btvt"),s("KKXr");var r=s("S6+Z");function i(e){var t=e.split("").map(e=>e.charCodeAt(0).toString(16)).filter(e=>"fe0f"!==e.toLowerCase()).map(e=>String.fromCodePoint(parseInt(e,16))).join("");return encodeURIComponent(t).replace(/%/gi,"").toLowerCase()}function o(e){var t,s=e.length%2==1,r=s?e.slice(0,1):"",i=s?e.slice(1):e,o="";try{o=decodeURIComponent("%"+(t=i,t.split("").reduce((e,t,s)=>e+t+((s+1)%2==0?" ":""),"").trim().split(/\s+/)).join("%"))}catch(e){}return r+o}function a(e){return e.replace(Object(r.emojiRegex)(),n)}function n(e){return e.replace(r.skinToneModifierRegex,"")}},UlUB:function(e,t,s){"use strict";function r(e,t){var s,r,i=!1;return function o(){if(i)return s=arguments,void(r=this);e.apply(this,arguments),i=!0,setTimeout(function(){i=!1,s&&(o.apply(r,s),s=r=null)},t)}}s.r(t),s.d(t,"default",function(){return r})},UuS6:function(e,t,s){"use strict";s.r(t),s.d(t,"StickersAnimation",function(){return r});s("a1Th"),s("Btvt");var r=function(){var e,t,s,i=!1,o=!1,a={},n={},l={},c={};function d(e){var t=p(e),s=1;if(t){hasClass(e,"animation_play")||(hide(geByClass1("sticker_img",e)),addClass(e,"animation_play")),t.play();var r=attr(e,"data-loop-count");r=parseInt(r),isNaN(r)&&(r=3),-1!==r&&(!t._cbs.loopComplete||t._cbs.loopComplete&&0===t._cbs.loopComplete.length)&&t.addEventListener("loopComplete",function i(o){var a=!0;r>=++s&&(a=!1),a&&(u(e,!1),""!==t._cbs.loopComplete&&t.removeEventListener("loopComplete",i),t.stop())})}}function h(e){var t=attr(e,"data-uid");return t||(t=attr(e,"data-uid",Math.random().toString(32).substr(2))),t}function u(e,t){c[h(e)]=t}function p(e){var t=attr(e,"data-uniq-id");if(!geByClass1("svg_sticker_animation",e))return!1;var s=n[t];return s||!1}function _(e,t){var r=p(e);if(r)"function"==typeof t&&t(r);else{var i=attr(e,"data-uniq-id");if(!c[h(e)]){u(e,!0);var o=attr(e,"data-animation-path"),l=attr(e,"data-sticker-id"),d=!1;if(l&&(d=a[l]?m(e):o&&m(e)),d){var _={container:e,renderer:"svg",loop:!0,autoplay:!1,name:i,rendererSettings:{scaleMode:"noScale",progressiveLoad:!0,hideOnTransparent:!0,className:"svg_sticker_animation"}};a[l]?_.animationData=a[l]:_.path=o;var v=geByClass1("svg_sticker_animation",e);if(v&&re(v),r=s.loadAnimation(_),!a[l])return void r.addEventListener("data_ready",function(){a[l]=r.animationData,n[i]=r,"function"==typeof t&&t(r)})}"function"==typeof t&&(n[i]=r,"function"==typeof t&&t(r))}}}function v(){return t().then(e=>(s=e,e))}return{init(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){var t=ge("fc_msg"+e),s=geByClass1("sticker_animation",t);r.loadAndPlaySticker(s)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){var t=$(`.msg_id_${e} .sticker_animation`);r.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){var s="_msg"+e;t&&(s="msg_id_"+e);var i=geByClass1("sticker_animation",geByClass1(s));r.loadAndPlayStickerWithTimer(i,500)},loadAutoplayAnimationStickers:function(e){if(s){if(e){if(o)return;o=!0}if(!i){i=!0;var t=geByClass("sticker_animation_autoplay");t&&each(t,function(e,t){_(t,function(){d(t)})}),i=!1}}else v().then(()=>{r.loadAutoplayAnimationStickers(e)})},loadAndPlaySticker:function(e){e&&(s?requestAnimationFrame(()=>{_(e,function(){d(e)})}):v().then(()=>{r.loadAndPlaySticker(e)}))},loadAndPlayStickerWithTimer:function(e,t){if(e&&!l[e]){t||(t=1e3);var s=ge(e);hasClass(s,"sticker_animation_disabled_timer")||(l[e]=setTimeout(function(){!s&&(s=ge(e),hasClass(s,"sticker_animation_disabled_timer"))||(r.loadAndPlaySticker(s),clearTimeout(l[e]),l[e]=!1)},t))}},reloadStickers:function(){n={}},touchStartSticker:function(t){t.addEventListener("contextmenu",r.preventContextMenu,!1),e=setTimeout(function(){r.loadAndPlaySticker(t)},500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){event.preventDefault(),event.stopPropagation()}};function m(e){var t=e.getBoundingClientRect().top,s=e.getBoundingClientRect().bottom;return t<window.innerHeight&&s>=0&&isVisible(e)}}()},WbBG:function(e,t,s){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},clTp:function(e,t,s){"use strict";function r(e){var t=e.getBoundingClientRect(),s=document.body,r=document.documentElement,i=window.pageYOffset||r.scrollTop||s.scrollTop,o=window.pageXOffset||r.scrollLeft||s.scrollLeft,a=r.clientTop||s.clientTop||0,n=r.clientLeft||s.clientLeft||0;return{top:Math.round(t.top+i-a),left:Math.round(t.left+o-n),width:e.offsetWidth,height:e.offsetHeight}}s.r(t),s.d(t,"default",function(){return r})},dLHM:function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return n});s("91GP"),s("ioFf"),s("rGqo"),s("Btvt");var r=s("q1tI"),i=(s("17x9"),s("pemR"));function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var s,r,i=function(e,t){if(null==e)return{};var s,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}class n extends r.Component{constructor(e){super(e),this.onChange=e=>{this.isControlledOutside||this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e)},this.getRef=e=>{this.element=e},void 0!==e.value||e.isControlledOutside?this.isControlledOutside=!0:this.state={value:e.initialValue||""}}render(){var e=this.props,t=e.alignment,s=e.value,n=(e.onChange,e.initialValue,e.className),l=(e.isControlledOutside,a(e,["alignment","value","onChange","initialValue","className","isControlledOutside"])),c={"Input--left":"left"===t,"Input--center":"center"===t,"Input--right":"right"===t};return r.createElement("input",o({},l,{className:Object(i.classNames)("Input",c,n),ref:this.getRef,value:this.isControlledOutside?s:this.state.value,onChange:this.onChange}))}}n.defaultProps={type:"text",initialValue:"",alignment:"left"}},mSoV:function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return l});var r=s("q1tI"),i=(s("17x9"),s("i8i4")),o=s("pemR"),a=s("dLHM"),n="Select...";class l extends r.Component{constructor(e){super(e),this.handleMouseDown=e=>{this.props.onFocus&&"function"==typeof this.props.onFocus&&this.props.onFocus(this.state.opened),"mousedown"===e.type&&0!==e.button||(e.stopPropagation(),e.preventDefault(),this.props.disabled||this.props.alwaysOpened||this.toggle(!this.state.opened))},this.setValue=(e,t)=>{"object"==typeof t&&this.props.searchable&&(t=t.props.title);var s={selected:{value:e,label:t},opened:this.props.alwaysOpened};this.fireChangeEvent(s),this.setState(s),this.toggle(!1)},this.fireChangeEvent=e=>{e.selected!==this.state.selected&&this.props.onChange&&this.props.onChange({name:this.props.name,selected:e.selected})},this.filterOptions=(e,t)=>{var s=e.toLowerCase();return t.filter(e=>"object"!=typeof e?e.toLowerCase().indexOf(s)>=0:"object"!=typeof e.label?e.label.toLowerCase().indexOf(s)>=0:e.label.props.title.toLowerCase().indexOf(s)>=0)},this.handleEditableType=e=>{this.setState({opened:!0}),this.props.onEdit&&this.props.onEdit(e.target.value)},this.handleDocumentClick=e=>{this.mounted&&this.state.opened&&!this.el.contains(e.target)&&this.toggle(!1)};var t=null;t=void 0!==e.value?e.editable&&e.customValue?{label:e.customValue,value:e.customValue}:this.getOptionByValue(e.options,e.value):{label:this.getLabel(e),value:""},this.state={filteredOptions:e.options,allOptions:e.options,selected:t,opened:e.alwaysOpened},this.mounted=!0}getLabel(e){return this.props.searchable?this.props.value||"":e.placeholder||n}componentWillReceiveProps(e){this.setState({filteredOptions:e.options,allOptions:e.options}),this.props.editable&&e.customValue?this.setState({selected:{label:e.customValue,value:e.customValue}}):void 0!==e.value&&e.value!==this.state.selected?this.setState({selected:this.getOptionByValue(e.options,e.value)}):void 0===e.value&&this.setState({selected:{label:this.getLabel(e),value:""}})}componentDidMount(){this.el=i.findDOMNode(this),document.addEventListener("click",this.handleDocumentClick,!1),document.addEventListener("touchend",this.handleDocumentClick,!1)}componentWillUnmount(){this.mounted=!1,document.removeEventListener("click",this.handleDocumentClick,!1),document.removeEventListener("touchend",this.handleDocumentClick,!1)}toggle(e){this.setState({opened:e},()=>{this.state.opened?this.props.onShow():this.props.onHide()})}getOptionByValue(e,t){return e.find(e=>"object"!=typeof e?e===t:e.value===t)||!1}renderOption(e){var t=Object(o.classNames)("Select__option",{"Select__option--selected":e===this.state.selected}),s=void 0!==e.value?e.value:e.label||e,i=void 0!==e.label?e.label:e;return r.createElement("div",{key:s,className:t,onMouseDown:()=>this.setValue(s,i),onClick:()=>this.setValue(s,i)},i)}buildMenu(){var e=this.state.filteredOptions.map(e=>"group"===e.type?r.createElement("div",{className:"Select__group",key:e.name},e.name&&r.createElement("div",{className:"Select__title"},e.name),e.items.map(e=>this.renderOption(e))):this.renderOption(e));return e.length?e:r.createElement("div",{className:"Select__noresults"},this.props.searchPlaceholder)}handleSearchType(e){var t=this.filterOptions(e.target.value,this.state.allOptions);this.setState({selected:{value:e.target.value,label:e.target.value},filteredOptions:t}),this.toggle(!0),this.props.onType&&this.props.onType(e.target.value)}buildControl(e){return this.props.searchable?r.createElement(a.default,{placeholder:this.props.placeholder,className:"Select__input",value:e||"",onClick:this.handleMouseDown,onChange:this.handleSearchType.bind(this),disabled:this.props.disabled,isControlledOutside:!0}):this.props.editable?r.createElement("div",{className:"Select__control",onClick:this.handleMouseDown},r.createElement(a.default,{placeholder:this.props.placeholder,className:"Select__input Select__input--editable",id:this.props.id,value:e||"",onChange:this.handleEditableType,onFocus:this.props.onInputFocus,onBlur:this.props.onInputBlur,disabled:this.props.disabled,isControlledOutside:!0,autoComplete:"off"}),r.createElement("span",{className:"Select__arrow"})):r.createElement("div",{className:"Select__control",onClick:this.handleMouseDown},r.createElement("div",{className:"Select__placeholder"},e),r.createElement("span",{className:"Select__arrow"}))}render(){var e=this.props,t=e.className,s=e.appearance,i=e.style,a=e.searchable,n=e.editable,l=a||n?"secondary":s,c=Object(o.classNames)("Select",`Select--${l}`,t,{"Select--opened":this.state.opened,"Select--disabled":this.props.disabled,"Select--empty":!this.state.selected.value}),d=this.state.selected;"string"!=typeof this.state.selected&&(d="string"!=typeof this.state.selected.label&&!1!==this.state.selected&&this.props.searchable?this.state.selected.label.props.title:this.state.selected.label);var h=this.buildControl(d);return r.createElement("div",{className:c,style:i},h,this.state.opened&&r.createElement("div",{className:"Select__menu"},this.buildMenu()))}}l.defaultProps={appearance:"primary",searchPlaceholder:"No options found",searchable:!1,editable:!1,onShow:()=>{},onHide:()=>{}}},nAFc:function(e,t,s){"use strict";s.r(t),s.d(t,"encodeHTMLEntities",function(){return n}),s.d(t,"escape",function(){return l}),s.d(t,"decodeHTMLEntities",function(){return c}),s.d(t,"prepareToWriting",function(){return d});s("a1Th"),s("Btvt"),s("rE2o"),s("ioFf"),s("rGqo"),s("Oyvg"),s("pIFo");var r=s("yqpO"),i=s("vkmG");function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var a=i.symbols,n=i.encodeHTMLEntities,l=i.escape;function c(e){return a.reduce((e,t)=>{var s=o(t,2),r=s[0],i=s[1];return e.replace(new RegExp(r,"ig"),i)},e).replace(/&#(\d+);/g,(e,t)=>String.fromCodePoint(t))}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=t.lineBreak,i=void 0!==s&&s,o=t.convertEmoji,a=void 0===o||o,n=c(e);return n=n.replace(/\n\r/gi,"\n"),"oneline"===i?n=n.replace(/<br>/gi," ").replace(/\n/gi," "):"html"===i&&(n=n.replace(/\n/gi,"<br>")),n=l(n),a&&(n=Object(r.emojiToHTML)(n,!0)),n}},ofcU:function(e,t,s){"use strict";s.r(t);s("a1Th"),s("rE2o"),s("ioFf"),s("rGqo"),s("Btvt"),s("KKXr");function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var i=new window.Map;function o(e){var t=i.get(e.currentTarget);if(t){var s=t[e.type];if(s)for(var o,a=0;a<s.length;a++){var n=r(s[a],2),l=n[0],c=n[1],d=void 0;if(hasClass(e.target,l)?d=c(e,e.target):(o=gpeByClass(l,e.target,e.currentTarget))&&(d=c(e,o)),!1===d)break}}}var a=s("Egk5");function n(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,t)}}}function l(e,t,s,r,a){!function(e,t,s,r){var a=i.get(e);a||(i.set(e,{}),a=i.get(e));for(var n=t.split(" "),l=0;l<n.length;l++){var c=n[l];a[c]||(a[c]=[],addEvent(e,c,o)),a[c].push([s,r])}}(t,s,r,a),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:s,selector:r,handler:a})}function c(e){var t={_registeredHandlers:[]};return e.handlers(function(e,t,s,r){Object(a.addEvent)(t,s,r),e._registeredHandlers.push({handlerType:"bind",elem:t,types:s,handler:r})}.bind(null,t),l.bind(null,t)),t}function d(e){e._registeredHandlers.forEach(function(e){var t,s,r,n,l;"delegate"===e.handlerType?(t=e.elem,s=e.types,r=e.selector,n=e.handler,(l=i.get(t))&&(s.split(" ").forEach(e=>{l[e]&&(l[e]=l[e].filter(e=>e[0]!==r||e[1]!==n),0===l[e].length&&removeEvent(t,e,o))}),0===Object.keys(l).map(e=>l[e].length).reduce((e,t)=>e+t)&&i.delete(t))):Object(a.removeEvent)(e.elem,e.types,e.handler)}),e._registeredHandlers=[]}s.d(t,"createMutations",function(){return n}),s.d(t,"createModule",function(){return c}),s.d(t,"destroyModule",function(){return d})},"p+C8":function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return n});s("91GP"),s("ioFf"),s("rGqo"),s("Btvt");var r=s("q1tI"),i=s("pemR");s("17x9");function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var s,r,i=function(e,t){if(null==e)return{};var s,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||(i[s]=e[s]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)s=o[r],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}function n(e){var t=e.icon,s=e.aside,n=e.chevron,l=e.selectable,c=e.border,d=e.className,h=e.children,u=e.active,p=e.canBeHovered,_=void 0===p||p,v=a(e,["icon","aside","chevron","selectable","border","className","children","active","canBeHovered"]),m={"ListItem--chevron":!!n,"ListItem--selectable":!!l,"ListItem--border":!!c,"ListItem--active":!!u,"ListItem--can-be-hovered":_};return r.createElement("li",o({},v,{className:Object(i.classNames)("ListItem",m,d)}),t&&r.createElement("div",{className:"ListItem__icon"},t),r.createElement("div",{className:"ListItem__main"},h),r.createElement("div",{className:"ListItem__aside"},s))}n.defaultProps={onClick:()=>{},icon:null,aside:null,chevron:!1,selectable:!0,border:!0}},r7nW:function(e,t,s){"use strict";s.r(t);var r=s("q1tI"),i=s("i8i4"),o=(s("17x9"),s("pemR"));class a extends r.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,s=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=`${parseFloat(this.calculatedPadding)+s}px`),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose;!e.disableBackdropClick&&t()}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,s=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),s&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,s=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),s&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(o.classNames)("BaseModal",e);return r.createElement("div",{className:t,"aria-modal":"true"},r.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),r.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return i.createPortal(this.renderModal(),document.body)}}a.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=a},rudk:function(e,t,s){"use strict";s.r(t),s.d(t,"parseFwd",function(){return a}),s.d(t,"convertKludgesToAttaches",function(){return n}),s.d(t,"isReservedPeer",function(){return l}),s.d(t,"isUserPeer",function(){return c}),s.d(t,"isChatPeer",function(){return d}),s.d(t,"convertAttachesToPhpMedia",function(){return h});var r=s("jE6c");function i(e,t){void 0===t&&(t=[]);var s=e.split("_");return[s[0],s[1],t]}var o={};function a(e){if(o[e])return o[e];for(var t=e?e.length:0,s=[],r=[],a="",n=0;n<t;n++){var l=e[n],c=l.charCodeAt(0);c>=48&&c<=57||"_"===l||"-"===l?a+=l:"("!==l&&")"!==l&&":"!==l&&","!==l||(""!==a&&(r.push(a),s.push("id"),a=""),r.push(l),s.push(l))}a.length>0&&(r.push(a),s.push("id"));var d=function e(t,s,r,o){if(void 0===r&&(r=0),void 0===o&&(o=0),o>50)return[[],t.length];for(var a=[],n="";r<t.length;){var l=t[r];if("id"===l)n=s[r];else if(","===l&&n)a.push(i(n)),n="";else if("("===l){var c=e(t,s,r+1,o+1),d=c[0];r=c[1],a.push(i(n,d)),n=""}else if(")"===l)return""!==n&&a.push(i(n)),[a,r];r++}return n&&a.push(i(n)),[a,r]}(s,r)[0];return Object.keys(o).length>300&&(o={}),o[e]=d,d}function n(e,t){var s=[];e.fwd_count?s.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&s.push({type:"mail",id:-t,object:{fwd_count:a(e.fwd).length}});for(var i=1;e["attach"+i+"_type"];++i)"call"===e["attach"+i+"_type"]?s.push({type:e["attach"+i+"_type"],id:e["attach"+i],initiatorId:Object(r.intval)(e["attach"+i+"_call_initiator_id"]),state:e["attach"+i+"_call_state"],duration:Object(r.intval)(e["attach"+i+"_call_duration"]),receiverId:Object(r.intval)(e["attach"+i+"_call_receiver_id"])}):s.push({type:e["attach"+i+"_type"],id:e["attach"+i],kind:e["attach"+i+"_kind"],productId:e["attach"+i+"_product_id"]});return e.geo&&s.push({type:"geo",id:e.geo}),s}function l(e){return 0==e}function c(e){return e>0&&e<2e9}function d(e){return e>2e9}function h(e){return e.map(function(e){var t="audiomsg"===e[2]?"audio_message":e[2];return e[0]+":"+e[1]+":"+t}).join(",")}},"uW+i":function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return o});s("rGqo"),s("Btvt"),s("hhXQ");var r=s("q1tI"),i=(s("17x9"),s("pemR"));class o extends r.Component{constructor(e){super(e),this.getActiveTab=()=>{var e=this.props.active,t=[],s=null;return this.props.children.forEach(r=>{r.key===e?s=r:t.push(r)}),s||(Number.isInteger(e)&&t.length>e?t[e]:t[0])},this.onClick=(e,t)=>{if(t!==this.state.active){var s=this.refsStore[t],r=this.getTransform(s);this.setState({active:t,isAnimating:!0,transform:r}),this.props.onTabClick(e,t)}},this.onTransitionEnd=e=>{"transform"===e.propertyName&&this.setState({isAnimating:!1})},this.getRef=(e,t)=>{this.refsStore[e]=t};var t=this.getActiveTab();this.refsStore={},this.state={isAnimating:!1,active:t.key}}static reactifyTabs(e){return(Array.isArray(e)?e:Object.values(e)).map(e=>r.createElement("a",{key:e[0],href:e[2],onClick:()=>{}},e[1]?unclean(e[1]):""))}componentDidUpdate(e,t,s){this.props.active!==e.active&&this.setState({active:this.props.active})}getTransform(e){var t=e.offsetWidth;return`translateX(${e.offsetLeft-50+.5*t}px) scaleX(${t/100})`}componentDidMount(){var e=this.refsStore[this.state.active];this.setState({transform:this.getTransform(e)})}render(){var e={"Tabs--animating":this.state.isAnimating};return r.createElement("nav",{className:Object(i.classNames)("Tabs",this.props.className,e),style:this.props.style},r.createElement("ul",{className:"Tabs__list"},this.props.children.map((e,t)=>r.createElement("li",{className:Object(i.classNames)("Tabs__item",{"Tabs__item--active":this.state.active===(e.key||t)}),onClick:s=>this.onClick(s,e.key||t),ref:s=>this.getRef(e.key||t,s),key:e.key||t},e))),r.createElement("div",{style:{transform:this.state.transform},className:"Tabs__divider",onTransitionEnd:this.onTransitionEnd}))}}o.defaultProps={onTabClick:()=>{},active:0}},vRp6:function(e,t,s){"use strict";s.r(t),s.d(t,"default",function(){return l});s("a1Th"),s("Btvt"),s("rE2o"),s("ioFf"),s("rGqo");var r=s("q1tI"),i=(s("17x9"),s("UlUB")),o=s("PjZB"),a=s("pemR");function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class l extends r.Component{constructor(e){super(e),this.checkLoad=Object(i.default)(e=>{var t=n(e,3),s=t[0],r=t[1],i=t[2];if(!this.loading)return this.props.virtualized||this.props.hasMore?void(r-s-i<=this.props.threshold&&(this.loading=!0,this.props.loadMore().then(()=>{this.loading=!1}))):this.detachListeners()},34),this.onScroll=e=>{var t=this.getScrollData();this.props.virtualized&&this.processChildren(this.props.children,t),this.props.hasMore&&this.checkLoad(t)},this.getRef=e=>{this.container=e,this.props.virtualized&&this.setState(this.getChildrenData(this.props.children,this.getScrollData()))},this.useWindowScroll=e.useWindowScroll,e.virtualized&&(this.state={before:0,after:e.children.length,start:0,end:0})}getScrollData(){var e=this.useWindowScroll?document.documentElement:this.container;return[this.getScrollTop(),e?e.scrollHeight:0,e?e.clientHeight:0]}getScrollTop(){var e=document.documentElement||document.body.parentNode||document.body;return this.useWindowScroll?void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop:this.container?this.container.scrollTop:0}attachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.addEventListener("scroll",this.onScroll,this.props.useCapture),e.addEventListener("resize",this.onScroll,this.props.useCapture))}detachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.removeEventListener("scroll",this.onScroll,this.props.useCapture),e.removeEventListener("resize",this.onScroll,this.props.useCapture))}processChildren(e,t){var s=this.state,r=this.getChildrenData(e,t||this.getScrollData()),i=r.start,o=r.end,a=r.before,n=r.after;i===s.start&&o===s.end&&a===s.before&&n===s.after||this.setState(r)}getChildrenData(e,t){var s=n(t,3),r=s[0],i=s[1],o=s[2],a=this.useWindowScroll?window:this.container,l=a&&a.offsetHeight;if(!a||0===i||0===o)return{start:0,end:0,before:0,after:e.length};o=Math.max(o,l);var c=e.length,d=Math.max(Math.floor(r/this.props.itemHeight)-1,0),h=Math.min(Math.floor((r+2*o)/this.props.itemHeight+1),c);return{start:d,end:h,before:d,after:c-h}}componentWillReceiveProps(e){this.props.virtualized&&this.processChildren(e.children)}componentDidMount(){this.attachListeners()}componentWillUnmount(){this.detachListeners()}render(){return r.createElement("div",{className:Object(a.classNames)("InfiniteScroll",this.props.className),ref:this.getRef,style:this.props.style},this.props.virtualized&&this.state.before>0&&r.createElement("div",{style:{height:this.state.before*this.props.itemHeight},key:"before"}),this.props.virtualized?[].concat(this.props.children).slice(this.state.start,this.state.end):this.props.children,this.props.virtualized&&this.state.after>0&&r.createElement("div",{style:{height:this.state.after*this.props.itemHeight},key:"after"}),this.props.hasMore&&(this.props.loader||r.createElement("div",{className:"InfiniteScroll__loader",key:"loader"},r.createElement(o.default,null))))}}l.defaultProps={useWindowScroll:!1,virtualized:!1,hasMore:!0,useCapture:!1,threshold:100,itemHeight:55}},vkmG:function(e,t,s){"use strict";s.r(t),s.d(t,"symbols",function(){return i}),s.d(t,"escape",function(){return o}),s.d(t,"encodeHTMLEntities",function(){return a});s("a1Th"),s("Btvt"),s("rE2o"),s("ioFf"),s("rGqo"),s("Oyvg"),s("pIFo");function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],r=!0,i=!1,o=void 0;try{for(var a,n=e[Symbol.iterator]();!(r=(a=n.next()).done)&&(s.push(a.value),!t||s.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(i)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var i=[["&amp;","&"],["&lt;","<"],["&gt;",">"],["&quot;",'"']];function o(e){return i.reduce((e,t)=>{var s=r(t,2),i=s[0],o=s[1];return e.replace(new RegExp(o,"ig"),i)},e)}function a(e){return o(e).replace(/[\u00A0-\u9999<>\&]/gim,e=>`&#${e.charCodeAt(0)};`)}},yqpO:function(e,t,s){"use strict";s.r(t),s.d(t,"emojiToHTML",function(){return a}),s.d(t,"getEmojiHTML",function(){return n}),s.d(t,"emojiReplace",function(){return l});s("rGqo"),s("Btvt"),s("pIFo");var r=s("S6+Z"),i=s("TxR4"),o=s("vkmG");function a(e,t){if(browser.ipad||browser.iphone)return e;e=(e+"").replace(/&nbsp;/g," ").replace(/<br>/g,"\n");for(var s=0;s<2;s++)Object.keys(r.EMOJI_PREFIXED_REPLACES).forEach(t=>{e.replace(r.EMOJI_PREFIXED_REPLACES[t],(e,s,r,i)=>(s||"")+n(t)+(i||""))});return Object.keys(r.EMOJI_REPLACES).forEach(t=>{e=e.replace(r.EMOJI_REPLACES[t],(e,s,r)=>n(t)+(r||""))}),e=e.replace(/\n/g,"<br>"),t&&(e=e.replace(/\uFE0F/g,"").replace(Object(r.emojiRegex)(),l)),e}function n(e,t,s,r){return!s&&t?t:r?`<i class="emoji @${e}" emoji="${e}"${t?` title="${t}"`:""}></i>`:`<img class="emoji" src="/emoji/e/${e}${window.devicePixelRatio>=2?"_2x":""}.png"${t?` alt="${t}"`:""}${browser.msie&&Number(browser.version)>8?' contenteditable="false"':""}>`}function l(e){return n(Object(i.emojiSymbolToByteHex)(e),Object(o.encodeHTMLEntities)(e),!0)}}});